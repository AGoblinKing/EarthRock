!function(){"use strict";const t=Object.values;
/* @license twgl.js 4.14.1 Copyright (c) 2015, Gregg Tavares All Rights Reserved.
	Available via the MIT license.
	see: http://github.com/greggman/twgl.js for details */
let n=Float32Array;var o=Object.freeze({__proto__:null,add:function(t,o,e){return(e=e||new n(3))[0]=t[0]+o[0],e[1]=t[1]+o[1],e[2]=t[2]+o[2],e},copy:function(t,o){return(o=o||new n(3))[0]=t[0],o[1]=t[1],o[2]=t[2],o},create:function(t,o,e){const i=new n(3);return t&&(i[0]=t),o&&(i[1]=o),e&&(i[2]=e),i},cross:function(t,o,e){e=e||new n(3);const i=t[2]*o[0]-t[0]*o[2],r=t[0]*o[1]-t[1]*o[0];return e[0]=t[1]*o[2]-t[2]*o[1],e[1]=i,e[2]=r,e},distance:function(t,n){const o=t[0]-n[0],e=t[1]-n[1],i=t[2]-n[2];return Math.sqrt(o*o+e*e+i*i)},distanceSq:function(t,n){const o=t[0]-n[0],e=t[1]-n[1],i=t[2]-n[2];return o*o+e*e+i*i},divide:function(t,o,e){return(e=e||new n(3))[0]=t[0]/o[0],e[1]=t[1]/o[1],e[2]=t[2]/o[2],e},divScalar:function(t,o,e){return(e=e||new n(3))[0]=t[0]/o,e[1]=t[1]/o,e[2]=t[2]/o,e},dot:function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]},lerp:function(t,o,e,i){return(i=i||new n(3))[0]=t[0]+e*(o[0]-t[0]),i[1]=t[1]+e*(o[1]-t[1]),i[2]=t[2]+e*(o[2]-t[2]),i},lerpV:function(t,o,e,i){return(i=i||new n(3))[0]=t[0]+e[0]*(o[0]-t[0]),i[1]=t[1]+e[1]*(o[1]-t[1]),i[2]=t[2]+e[2]*(o[2]-t[2]),i},length:function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])},lengthSq:function(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]},max:function(t,o,e){return(e=e||new n(3))[0]=Math.max(t[0],o[0]),e[1]=Math.max(t[1],o[1]),e[2]=Math.max(t[2],o[2]),e},min:function(t,o,e){return(e=e||new n(3))[0]=Math.min(t[0],o[0]),e[1]=Math.min(t[1],o[1]),e[2]=Math.min(t[2],o[2]),e},mulScalar:function(t,o,e){return(e=e||new n(3))[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e},multiply:function(t,o,e){return(e=e||new n(3))[0]=t[0]*o[0],e[1]=t[1]*o[1],e[2]=t[2]*o[2],e},negate:function(t,o){return(o=o||new n(3))[0]=-t[0],o[1]=-t[1],o[2]=-t[2],o},normalize:function(t,o){o=o||new n(3);const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=Math.sqrt(e);return i>1e-5?(o[0]=t[0]/i,o[1]=t[1]/i,o[2]=t[2]/i):(o[0]=0,o[1]=0,o[2]=0),o},setDefaultType:function(t){const o=n;return n=t,o},subtract:function(t,o,e){return(e=e||new n(3))[0]=t[0]-o[0],e[1]=t[1]-o[1],e[2]=t[2]-o[2],e}});const e=t=>o.add(t.position,t["!velocity"],t.position);var i=(n,i)=>{n.mass>0&&n["!force"]&&Array.isArray(n["!force"])&&o.add(n["!velocity"],n["!force"],n["!velocity"]);const r=o.length(n["!velocity"]);if(!1===Array.isArray(n["!velocity"])||0===n.mass||r<.01||r===1/0)return[!1,!1];let s=.9;s=n.mass>=0?s*n.mass:s/Math.abs(n.mass),e(n),o.mulScalar(n["!velocity"],s,n["!velocity"]);const c=[n.id],a=[];if(!n["!real"])return[c,[]];const u=[];return t(i).forEach(t=>{if(!((t,n)=>{if(t.id===n.id||!n["!real"]||!t["!real"])return!1;const[o,e]=[t.scale/2*.9,n.scale/2*.9];return t.position[0]-o<=n.position[0]+e&&t.position[0]+o>=n.position[0]-e&&t.position[1]-o<=n.position[1]+e&&t.position[1]+o>=n.position[1]-e&&t.position[2]-o<=n.position[2]+e&&t.position[2]+o>=n.position[2]-e})(n,t))return;if(a.push(t.id),0===t.mass)return;const i=o.mulScalar(o.subtract(n["!velocity"],t["!velocity"]),.5),r=o.mulScalar(o.normalize(o.negate(o.subtract(n.position,t.position))),.05),s=o.add(i,r);u.push(()=>{o.add(t["!velocity"],s,t["!velocity"]),o.add(n["!velocity"],o.negate(s),n["!velocity"]),e(t)}),c.push(t.id),((t,n)=>{const e=o.subtract(t.position,n.position);Math.abs(e[0])>Math.abs(e[1])?t["!velocity"][0]=-t["!velocity"][0]:t["!velocity"][1]=-t["!velocity"][1]})(n,t)}),u.forEach(t=>t()),[c,a]};const r={solve(t){const n={},o={};var e;(e=t,t=>Object.entries(e).forEach(t))(([e,r])=>{r.position=r.position||[0,0,0],r["!velocity"]=r["!velocity"]?r["!velocity"]:[0,0,0],r.scale=r.scale||1,r.mass="number"==typeof r.mass?r.mass:1;const[s,c]=i(r,t);s&&(o[e]||(o[e]=[]),o[e].push(...c),c.forEach(t=>{o[t]?o[t].push(e):o[t]=[e]}),s.forEach(o=>{n[o]={position:t[o].position,"!velocity":t[o]["!velocity"]}}))}),Object.entries(o).forEach(([t,o])=>{0!==o.length&&(n[t]||(n[t]={}),n[t]["!collide"]=[...new Set(o)])}),postMessage({type:"solve",bodies:n})}};onmessage=({data:{type:t,data:n=!1}})=>{r[t]&&r[t](n)}}();

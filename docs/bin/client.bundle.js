var app=function(e,t,n,s,r){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,n=n&&n.hasOwnProperty("default")?n.default:n,r=r&&r.hasOwnProperty("default")?r.default:r;const o=(e,t=!1)=>t?{__proto__:e,...t}:t=>o(e,t),a=e=>t=>Object.fromEntries(Object.entries(e).reduce((e,[n,s])=>{const r=t([n,s]);return r&&e.push(r),e},[])),i=e=>t=>Object.entries(e).forEach(t),l=e=>(t,n)=>Object.entries(e).reduce(t,n),c=Object.keys,u=Object.values,d=e=>l(e.get())((e,[t,n])=>"&"===t[0]?e:(e[t]=n.toJSON(),e),{}),h={toJSON(){switch(typeof this.value){case"undefined":case"number":case"string":return this.value;case"object":if(Array.isArray(this.value)||null===this.value)return this.value;if(this.value.toJSON)return this.value.toJSON()}return JSON.parse(JSON.stringify(this.value))}},p=new Set,f=()=>{requestAnimationFrame(f),p.clear()};f();const m=o(h,{get(){return this.value},notify(){if(this.subs){if(p.has(this))return requestAnimationFrame(()=>{p.has(this)||this.notify()});p.add(this),this.subs.forEach(e=>e(this.value))}},subscribe(e,t=!1){return this.subs||(this.subs=new Set),this.subs.add(e),t||e(this.value),()=>this.subs.delete(e)},listen(e){return this.subscribe(e)}}),g=(e,t)=>{const n=o(m,(e=>o(h,{value:e}))(e));return t&&t(e=>{n.value=e,n.notify(e)}),n},v=o(m,{set(e,t=!1){this.value=void 0===e?null:e,t||this.notify()},update(e){this.set(e(this.value))}}),$=e=>o(v,g(e)),w=o(v,{get(e=!1){const t=v.get.call(this);return!1===e?t:t[e]},set(e,t=!1){this.value=e;const{previous:n}=this,s=[];t||this.notify({add:c(e).filter(t=>{const r=void 0===n[t];return r||n[t]===e[t]||s.push(t),r}),remove:c(n).filter(t=>void 0===e[t]),modify:s,previous:n}),this.previous={__proto__:e.__proto__,...e}},subscribe(e){return e(this.value,{add:c(this.value),remove:[],modify:[],previous:this.value}),v.subscribe.call(this,e,!0)},notify(e){this.subs&&e&&this.subs.forEach(t=>t(this.value,e))}}),y=(e={})=>o(w,{...$(e),previous:{...e}}),_=o(w,{has(e){return void 0!==this.get(e)},get(e=!1){const t=w.get.call(this);return!1===e?t:t[e]},set(e,t=!1){const n={__proto__:e.__proto__,...a(e)(([e,t])=>[e,this.convert(t)])};w.set.call(this,n,t)},convert(e){return e&&"function"==typeof e.subscribe?e:this.fn?$(this.fn(e)):$(e)},add(e){return this.set(Object.assign(this.get(),e)),this},write(e){const t={};i(e)(([e,n])=>{const s=this.get()[e];s?s.set(n):t[e]="object"==typeof n&&null!==n&&n.get?n:$(n)}),Object.keys(t).length>0&&this.add(t)},remove(e){const t=this.get();delete t[e],w.set.call(this,t)},toJSON(){return d(this)}}),b=(e={},t=!1)=>{const n=o(_,{...y({}),fn:t});return n.set(e),n},x=o(v,{set(e){return v.set.call(this,this.transform(e)),this}}),k=e=>o(x,{...$(),transform:e}),E=$(100),O=g("/sheets/default_2.png"),S=g("localhost:5000"===window.location.host),j=$(!1),z=$({delay:100,duration:300}),N=$(!0),A=$(!1),M=$(10),T=$(.01),L=$(.1),C=g(1024),R=g(32),W=$("rgb(224, 168, 83)"),I=$("#033"),D=$("green"),P=$("#023d55"),F=$("/sys"),J=g("",t=>I.listen(n=>t(e(n).darkenByRatio(.5).toCSS()))),q=g("",e=>{let t="";J.listen(n=>{t=n,e([`border: 0.2rem solid ${t};`].join(""))})});var U=Object.freeze({__proto__:null,TIME_TICK_RATE:E,SPRITES:O,IS_DEV:S,SOUND_ON:j,SVELTE_ANIMATION:z,WEAVE_EXPLORE_OPEN:N,OMNI_LAST:A,INPUT_SCROLL_STRENGTH:M,INPUT_ZOOM_STRENGTH:T,INPUT_ZOOM_MIN:L,TILE_COUNT:C,TILE_COLUMNS:R,THEME_COLOR:W,THEME_BG:I,THEME_GLOW:D,CLEAR_COLOR:P,CURSOR:F,THEME_BORDER:J,THEME_STYLE:q});const B=e=>{if(!e)return"#111";let t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);let n="#";for(let e=0;e<3;e++){n+=("00"+(t>>8*e&255).toString(16)).substr(-2)}return n},Y=["groovy","cat","bird","dog","poop","cool","not","okay","great","terrible","wat","goblin","life","ferret","gregert","robert","zilla","red","shirt","pants","blue","luna","ember","embear","lunatic","boring","killa","notice","thank","tank","under","near","near","quaint","potato","egg","bacon","narwhal","lamp","stairs","king","tyrant","grave","dire","happy","amazing","terrific","terrible","good","boring","rip","hello","world","global","universal","television","computer"],H=e=>{let t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);return`${Math.abs(t)%C.get()}`},G=e=>Array.from(new Array(e)).map(()=>Y[Math.floor(Math.random()*Y.length)]).join(" "),X={listen(e){return this.value.listen(e)},get(){return this.value.get()},set(e){return this.value.set(e)},toJSON(){return{type:this.type.get(),value:this.value.toJSON()}}};var V=o({cancel(){const e=[...this.birds];requestAnimationFrame(()=>{this.weave.remove(...e)})},rez(){const{value:e,space:n,weave:s}=this;this.birds=[],this.value_cancel=e.listen(e=>{const r=e.split(" ");let o=1;r.length>1&&(o=parseInt(r[0]),e=r.slice(1).join(" ")),this.cancel();const a=Object.fromEntries([...Array(o)].map((s,r)=>[`&${t()}`,{type:"space",value:{"!clone":e,"!leader":`~/${n.value.get("!name").get()}`,"!bird":r}}]));requestAnimationFrame(()=>{this.birds=Object.values(s.write_ids(a)).map(e=>e.id.get()),this.weave.rez(...this.birds)})})},derez(){this.value_cancel(),this.cancel()}});const K={stream:e=>JSON.stringify(e.value.get()),math:e=>e.math.get().trim(),mail:e=>e.whom.get().trim(),default:e=>e.warp.get(),space:e=>`./${e.value.get("!name")}`,sprite:e=>`@${e.value.get()}`,color:e=>`#${e.value.get()}`},Z={color:e=>"#"===e[0],sprite:e=>"@"===e[0],mail:e=>{const t=e.match(Wheel.REG_ID);return!(!t||1!==t.length)&&t[0]===e},stream:e=>{try{return JSON.parse(e),!0}catch(e){return!1}}},Q={math:e=>({type:"math",math:e}),mail:e=>({type:"mail",whom:e}),stream:e=>({type:"stream",value:JSON.parse(e)}),color:e=>({type:"color",value:e.slice(1)}),sprite:e=>{let t=parseInt(e.slice(1));return isNaN(t)&&(t=66),{type:"sprite",value:t}}},ee=e=>{const t=(e=>{const t=Object.entries(Z);for(let n=0;n<t.length;n++){const[s,r]=t[n];if(r(e))return s}return"math"})(e);return Q[t](e)},te=(e,t)=>t.chain(e).slice(0,-1).map(e=>ne(e,t)).join(" => "),ne=(e,t)=>{if("{"===e[0])return e;const n=t.warps.get()[e];if(!n)return"space";const s=n.type.get();return K[s]?K[s](n):s},se=({code:e,weave:n,address:s,prefix:r=""})=>{const o=e.replace(/[\r\n]/g,"").split("=>").reverse(),a=n.wefts.get();n.remove(...n.chain(s).slice(0,-1));const i=n.get_id(s.split("/")[0]);let l=s;const c=o.map(e=>{if(""===(e=e.trim()))return;const s=ee(e);s.id=`${r}${t()}`;const o=n.add(s).id.get();return a[o]=l,l=o,o});return i.rezed&&n.rez(...c),n.wefts.set(a),c},re=e=>e=(e=(e=e.split(";")).map((t,n)=>(t=t.trim(),n!==e.length-1&&(t+=";"),n===e.length-2&&(t+="\r\n"),t)).join("\r\n")).split("=>").join("\r\n\r\n=>"),oe=(e,t)=>{const n=ne(e,t).split(";"),s=n.pop().trim();return n.length>0?`{${n.length}} ${s}`:s};var ae=o({grab_script(e,t){const n=e.weave,s=`${e.id.get()}/${t}`;if(0===n.chain(s).slice(0,-1).length)return;const{weave:r,id:o,space:a}=this,i=te(s,n),l=`${o}/${t}`,c=n.get_id(e.id.get()).value.get(t).get();a.value.has(t)||a.value.write({[t]:c}),requestAnimationFrame(()=>{this.scripts.push(...se({code:i,weave:r,address:l,prefix:"&"}))})},rez(){const{space:e,weave:t,value:n,id:s}=this;this.scripts=this.scripts||[],this.cancel=n.listen(n=>{this.weave.remove(...this.scripts);const r=Wheel.get(t.resolve(n,s));r||console.warn("Invid other for clone");const o=r?r.value.get():{};c(o).forEach(e=>{this.grab_script(r,e)}),e.set({...e.get(),__proto__:o},!0)})},derez(){this.cancel(),this.space.set({...this.space.get()},!0),this.weave.remove(...this.scripts)}}),ie=o({rez(){this.cancel=this.value.listen(e=>{const t=this.space.id.get(),n=Wheel.get(this.weave.resolve(e,t));if(!n)return void console.warn("leader not found");const s=n.value.get();if(!s["!birds"])return s["!birds"]=$(new Set([t])),void n.value.set(s);let r=s["!birds"].get();r.add||Array.isArray(r)||(r=new Set),Array.isArray(r)&&(r=new Set(r)),r.has(t)||(r.add(t),s["!birds"].set([...r]))})},derez(){const e=this.space.id.get();this.cancel();const t=Wheel.get(this.weave.resolve(this.value.get(),e));if(!t)return void console.warn("no leader");const n=t.value.get();if(!n)return void console.warn("no leader value");let s=n["!birds"].get();s.add||Array.isArray(s)||(s=new Set),Array.isArray(s)&&(s=new Set(s)),s.delete(e),n["!birds"].set([...s])}}),le=o({create(){this.cancel=this.value.listen(e=>{const t=this.weave.names.get();if(this.name_last){if(this.name_last===e)return;delete t[this.name_last]}t[e]=this.space,this.name_last=e,this.weave.names.set(t)})},destroy(){this.cancel(),this.weave.names.update(e=>(delete e[this.name_last],e))}}),ce=o({create(){requestAnimationFrame(()=>{this.value.set([])})}});let ue;const de=g(0,e=>{ue=e});let he=Date.now();const pe=g([0,0],e=>{let t;const n=[0,0],s=r=>{requestAnimationFrame(s),void 0===t&&(t=r),n[0]=r,n[1]=Math.round(r-t),t=r;const o=Date.now();o-he>=E.get()&&(he=o,ue(de.get()+1)),e(n)};requestAnimationFrame(s)});var fe=Object.freeze({__proto__:null,tick:de,frame:pe});const me=new Worker("/bin/physics.bundle.js"),ge=$({}),ve=()=>requestAnimationFrame(()=>{const e=a(ge.get())(([e,t])=>{const n=t.get();return[e,{id:e,position:we(n.position,[0,0,0]),"!velocity":we(n["!velocity"],[0,0,0]),scale:we(n.scale,1),"!real":we(n["!real"],!1),"!name":we(n["!name"],`id-${e}`),mass:we(n.mass,1),"!force":we(n["!force"],void 0)}]});me.postMessage({type:"solve",data:e})});let $e=()=>{ve()};me.onmessage=({data:e})=>{$e=()=>{const t=ge.get();i(e.bodies)(([e,n])=>{const s=t[e];s&&s.write(n)}),ve()}};const we=(e,t)=>e?e.get():t;de.listen(()=>{$e()});var ye=o({rez(){((...e)=>{const t=ge.get();e.forEach(e=>{t[e.id.get()]=e.value}),ge.set(t,!0)})(this.space)},derez(){((...e)=>{const t=ge.get();e.forEach(e=>{delete t[e.id.get()]}),ge.set(t,!0)})(this.space)}}),_e=o({create(){this.value.set(void 0,!0),this.cancel=this.value.listen(()=>{})}});const be={};var xe=o({rez(){be[this.space.id.get()]=this.space},derez(){delete be[this.space.id.get()]}}),ke=Object.freeze({__proto__:null,flock:V,clone:ae,leader:ie,name:le,birds:ce,velocity:ye,real:ye,collide:_e,visible:xe,force:ye});const Ee=g(""),Oe=g("space"),Se=o(X,{address(){return`/${this.weave.name.get()}/${this.name().get()||this.id.get()}`},name(){return this.value.get("!name")||Ee},create(){const e=this.id.get();this.twists={},this.cancel=this.value.listen((t,{add:n,remove:s})=>{(e=>(...t)=>Object.assign(e,...t))(this.twists)(n.reduce((e,n)=>{const s=ke[n.slice(1)];if(void 0===s)return e;const r=s({weave:this.weave,value:t[n],space:this,id:this.id.get()});return r.create&&r.create(),this.rezed&&r.rez&&requestAnimationFrame(()=>r.rez()),e[n]=r,e},{})),s.forEach(t=>{const n=this.twists[t];this.weave.remove(...this.weave.chain(`${e}/${t}`).slice(0,-1)),n&&(this.rezed&&n.derez&&n.derez(),n.destroy&&n.destroy(),delete this.twists[t])})})},destroy(){this.cancel(),i(this.twists)(([e,t])=>{this.rezed&&t.derez&&t.derez(),t.destroy&&t.destroy()}),this.twists={}},rez(){this.rezed=!0,i(this.twists)(([e,t])=>{t.rez&&t.rez()})},derez(){this.rezed=!1,i(this.twists)(([e,t])=>{t.derez&&t.derez()})},chain(){const e=this.value.get(),t=this.id.get();return c(e).reduce((e,n)=>(e.push(...this.weave.chain(`${t}/${n}`).slice(0,-1)),e),[])},get(e){return this.value.get(e)},gets(...e){return e.reduce((e,t)=>(e[t]=this.get(t),e),{})},get_value(e){const t=this.value.get(e);if(t)return t.get()},get_values(...e){return e.reduce((e,t)=>(e[t]=this.get_value(t),e),{})},write(e){return this.value.write(e)}});const je=e=>{if(-1===e.indexOf(".")){const t=parseInt(e);if("number"==typeof t&&!isNaN(t))return t}return JSON.parse(e)},ze=g("stream"),Ne=o(v,{set(e){try{v.set.call(this,je(e))}catch(t){v.set.call(this,e)}return this}});const Ae=g("sprite");const Me=t=>{const n=e(t);return void 0===n.red?16777215:n.red+255*n.green+255*n.blue},Te=g("color");s.v3.setDefaultType(Array);const Le={},Ce=new n.Parser({in:!0,assignment:!0});Ce.functions.stop=function(){throw new Error("stop")},Object.entries(s.v3).forEach(([e,t])=>{Ce.functions[`v3_${e}`]=function(...e){return t(...e)}}),Object.entries(s.m4).forEach(([e,t])=>{Ce.functions[`m4_${e}`]=function(...e){return t(...e)}}),Ce.functions.Color=e;const Re=()=>{},We=/[ .~%!&/^]/g,Ie=/[.*+?^${}()|[\]\\]/g,De=/\.\//g,Pe=/~\//g,Fe=/\$/g,Je=g("math"),qe=o(X,{run(e){const t=e.match(Wheel.REG_ID),n={},s=this.weave.chain(this.id.get(),!0).shift(),r=this.weave.to_address(s);new Set(t).forEach(t=>{const s="$"===t[0],o=t.replace(De,`${r}/`).replace(Pe,`/${this.weave.name.get()}/`).replace(Fe,"").trim(),a=Wheel.get(o);if(!a)return;const i=t.replace(De,"dot").replace(Pe,"weave").replace(We,"z");e=e.replace(new RegExp((e=>e.replace(Ie,"\\$&"))(t),"g"),i),n[i]={warp:a,shh:s}});try{this.fn=(e=>{let t=Le[e];return t||(t=Ce.parse(e),Le[e]=t),e=>t.evaluate(e)})(e),this.values.set(n)}catch(e){}},rez(){this.run(this.math.get()),this.cancels=new Set,this.cancel_vs=this.values.listen(e=>{this.cancels.forEach(e=>e()),this.cancels.clear(),Object.entries(e).forEach(([e,{warp:t,shh:n}])=>{n||this.cancels.add(t.listen(()=>{this.value.set(this.value.last)}))})})},derez(){this.cancel_vs(),this.cancels.forEach(e=>e())},toJSON(){return{type:this.type.get(),value:this.value.get(),math:this.math.get()}}}),Ue=o(v,{set(e){return this.warp.run(e),e}}),Be=o(v,{set(e){this.last=e;const t=this.warp.values.get();e=void 0===e?null:e;const n={...Object.fromEntries(Object.entries(t).map(([e,{warp:t}])=>[e,void 0===t.toJSON()?null:t.toJSON()])),value:e};try{const e=this.warp.fn(n);v.set.call(this,e)}catch(e){"stop"!==e.message&&console.warn("math error",e)}return this}});const Ye=g("mail"),He=o(X,{fix(e){return e.replace("$","").replace("~",`/${this.weave.name.get()}`).replace(".",this.weave.to_address(this.weave.chain(this.id.get(),!0).shift()))},clear(){this.cancels.forEach(e=>e()),this.cancels.clear()},derez(){this.cancel_whom(),this.clear()},rez(){this.cancels=new Set,this.cancel_whom=this.whom.listen(e=>{if(this.clear(),"$"===(e=this.weave.resolve(e,this.id.get()))[0]){e=e.replace("$","");const t=Wheel.get(e);return t?void this.set(t.get()):this.set(null)}let t=Wheel.get(e);t&&(t=t.type?t.value:t,this.cancels.add(t.listen(e=>{this.set(e)})))})},toJSON(){return{type:this.type.get(),value:this.value.get(),whom:this.whom.get()}},set(e){v.set.call(this.value,e)}}),Ge=o(v,{set(e){const t=this.mail.fix(this.mail.whom.get()),n=Wheel.get(t);n&&n.set&&(n.set(e),v.set.call(this,e))}});var Xe=Object.freeze({__proto__:null,space:({id:e,value:t={},weave:n})=>o(Se,{type:Oe,value:b(t),id:g(e),weave:n}),stream:({id:e,value:t=null})=>o(X,{type:ze,value:o(Ne,$()).set(t),id:g(e)}),sprite:({value:e=0,id:t})=>o(X,{type:Ae,value:$(e),id:g(t)}),color:({value:e="#FFFFFF",id:t})=>o(X,{type:Te,value:k(Me).set(e),id:g(t)}),math:({math:e="2+2",value:t,weave:n,id:s}=!1)=>{const r=o(qe,{type:Je,values:$({}),id:g(s),weave:n,fn:Re});return r.value=o(Be,{...$(t),warp:r}),r.math=o(Ue,{...$(e),warp:r}),requestAnimationFrame(()=>{r.math.set(e)}),r},mail:({whom:e="/sys/mouse/position",weave:t,id:n})=>{const s=o(He,{type:Ye,whom:$(e),id:g(n),weave:t});return s.value=o(Ge,{...$(),mail:s}),s}});const Ve={is_rezed(){return void 0!==Wheel.running.get()[this.name.get()]},add(e){e.id=e.id||t();const n=this.make(e);if(n)return this.warps.update(e=>(e[n.id.get()]=n,e)),n.create&&n.create(),n},remove_unnamed(){const e=this.warps.get(),t=[];return Object.keys(e).forEach(e=>{"&"===e[0]&&t.push(e)}),this.remove(...t),t.length},remove_name(e){const t=this.get_name(e);if(!t)return;const n=t.id.get();return this.remove(n)},remove(...e){this.warps.update(t=>{let n;const s=this.rezed.get(),r=this.is_rezed(),o=this.wefts.get();let a=!1;return e.forEach(e=>{o[e]&&(a=!0,delete o[e]);const i=t[e];i&&(r&&s[e]&&(n=!0,delete s[e],i.derez&&i.derez()),i.destroy&&i.destroy(),delete t[e])}),n&&this.rezed.set(s,!0),a&&this.wefts.set(o),t})},write_ids(e){const t=this.warps.get();return a(e)(([e,n])=>{const s=t[e];if(!s){n.value=n.value||{},n.id=e;const t=this.add(n);return t?[e,t]:[e,!1]}return i(n)(([e,t])=>{const n=s[e];"value"!==e?n.set&&n.set(t):n.set(Object.assign(n.get(),t))}),[e,s]})},write(e){const t=this.names.get();return a(e)(([e,n])=>{const s=t[e];if(!s){n.value=n.value||{},n.value["!name"]=e;const t=this.add(n);return t?[e,t]:[e,!1]}return i(n)(([e,t])=>{const n=s[e];"value"!==e?n.set&&n.set(t):n.set(Object.assign(n.get(),t))}),[e,s]})},exists(e){const[t,n]=e.split("/"),s=this.warps.get()[t];return!!s&&(void 0===n||void 0!==s.value.get()[n])},validate(){let e=!1;const t=this.wefts.get(),n=this.warps.get(),s=[];return i(n)(([e,t])=>{if("space"===t.type.get())return;const r=this.chain(t.id.get(),!0),o=r[r.length-1].split("/")[0],a=r[0].split("/")[0],i=n[o],l=n[a];i&&"space"===i.type.get()||l&&"space"===l.type.get()||s.push(t.id.get())}),s.length>0&&this.remove(...s),i(t)(([n,s])=>{this.exists(n)&&this.exists(s)||(e=!0,delete t[n])}),e?(this.wefts.set(t),s.length):s.length},chain(e,t=!1){const n=t?this.wefts.get()[e]:this.wefts_r.get()[e];return n?[...this.chain(n,t),e]:[e]},to_address(e){const[t]=e.split("/"),n=this.get_id(t);return`/${this.name.get()}/${n.id.get()}`},get_name(e){return this.names.get()[e]},get_id(e){if(!e)return;const[t,n]=e.split("/"),s=this.warps.get()[t];if(!n)return s;if(!s)return;const r=s.value.get();return r&&r[n]?{value:r[n]}:void 0},make(e){return(({id:e=t(),type:n,knot:s,...r}=!1)=>{return!n&&s&&(n=s),"stitch"===n&&(n="space",r.value=r.value||{},r.value["!name"]=r.name),Xe[n]?Xe[n]({...r,id:e}):(console.warn(`Invalid warp ${n}`),!1)})({...e,weave:this})},resolve(e,t){return e.replace(".",this.to_address(this.chain(t,!0).shift())).replace("~",this.name.get())},derez(...e){const t=this.rezed.get(),n=this.warps.get();e.forEach(e=>{const s=n[e];s&&"space"===s.type.get()&&this.derez(...n[e].chain()),delete t[e]}),this.rezed.set(t)},rez(...e){const t=this.rezed.get(),n=this.warps.get();e.forEach(e=>{const s=n[e];s&&("space"===s.type.get()&&this.rez(...s.chain()),t[e]=!0)}),this.rezed.set(t)},destroy(){this.destroys.forEach(e=>e())},toJSON(){return{id:this.id.toJSON(),name:this.name.toJSON(),wefts:this.wefts.toJSON(),warps:d(this.warps),rezed:this.rezed.toJSON()}}};var Ke=({name:e=G(2),id:n=t(),warps:s={},wefts:r={},rezed:a={},knots:c,threads:u}=!1)=>{c&&(s=c),u&&(r=u);const d=o(Ve,{id:g(n),name:$(e),wefts:y(r),rezed:y(a),names:$({}),spaces:$(new Map),destroys:[]}),h=l(s)((e,[t,n])=>{n.id!==t&&(n.id=t);const s=d.make(n);return s?(e[t]=s,e):e},{});return i(h)(([e,t])=>t.create&&t.create()),d.warps=$(h),d.wefts_r=g({},e=>{const t={};d.destroys.push(d.wefts.listen((n,{add:s,remove:r,modify:o,previous:a})=>{r.forEach(e=>{delete t[a[e]]}),s.forEach(e=>{t[n[e]]=e}),o.forEach(e=>{t[n[e]]=e}),e(t)}))}),d};const Ze=$({sys:Ke({name:"sys",id:"sys"})}),Qe=new Map;let et;const tt=g({sys:!0},e=>{et=e}),nt=$(),st=$(""),rt=e=>{const[t,n,s]=(e=>{let t=e.split("/");return""===t[0]&&(t=t.slice(1)),t})(e),r=Ze.get()[t];if(void 0===r)return;if(void 0===n)return r;let o=r.names.get()[n];if(void 0===o&&(o=r.warps.get()[n],!o))return;if(void 0===s)return o;const a=o.value.get();if(!a)return;const i=a[s];return void 0!==i?i:void 0},ot=e=>{if("sys"===e)return;const t=Qe.get(e);void 0!==t&&(t(),Qe.delete(e));const n=tt.get();delete n[e],et(n)},at=()=>{const e=Ze.get();c(e).forEach(e=>ot(e))};var it=Object.freeze({__proto__:null,SYSTEM:"sys",weaves:Ze,running:tt,trash:nt,del:e=>{const t=tt.get(),n=Ze.get();let s=!1;Object.keys(e).forEach(e=>{"sys"!==e&&(t[e]&&ot(e),n[e]&&(s=!0,n[e].destroy(),nt.set(n[e]),delete n[e]))}),s&&Ze.set(n)},name:st,get:rt,exists:e=>void 0!==rt(e),spawn:(e={})=>a(e)(([e,t])=>{if("sys"===e)return console.warn("tried to spawn sys"),[e,rt(e)];const n=Ze.get(),s=Ke({...t,name:e});return n[e]=s,Ze.set(n),[e,s]}),start:e=>{if("sys"===e)return;const t=rt(e);if(!t)return!1;const n=(e=>{const t={},n=e.wefts.listen((n,{add:s,remove:r,modify:o})=>{let a;[...s,...o].forEach(s=>{const r=n[s],o=e.get_id(s),i=e.get_id(r);if(!i||!o)return a=!0,void delete n[s];t[s]&&t[s](),t[s]=o.value.subscribe(e=>{o.rezed&&i.value.set(e)})}),r.forEach(e=>{const n=t[e];n&&(n(),delete t[e])}),a&&e.wefts.set(n,!0)});return()=>{n(),u(t).forEach(e=>e())}})(t),s=(e=>{const t=e.rezed.listen((t,{add:n,remove:s})=>{const r=[],o=e.warps.get();n.forEach(e=>{const n=o[e];if(!n)return delete t[e],r.push(e);n.rez&&n.rez(),n.rezed=!0,n.value.notify()}),s.forEach(e=>{const n=o[e];if(!n)return delete t[e],r.push(e);n.derez&&n.derez(),delete n.rezed}),r.length>0&&e.rezed.set(t,!0)});return()=>{t(),u(e.rezed.get()).forEach(e=>e&&e.derez&&e.derez())}})(t);Qe.set(e,()=>{n(),s()}),et({...tt.get(),[e]:!0})},stop:ot,stop_all:at,clear:()=>{at(),Ze.set({sys:Ze.get().sys})},restart:e=>{Wheel.stop(e),Wheel.start(e)},toJSON:()=>({name:st.get(),weaves:d(Ze),running:tt.toJSON()}),REG_ID:/\$?[~.]?\/[a-zA-Z 0-9!%&/]+/g,shared:{},decompile:te,translate:ne,compile:se,format:re,condense:oe});window.Wheel=it;const lt=g([0,0],e=>window.addEventListener("mousemove",({clientX:t,clientY:n})=>e([t,n]))),ct=g(null,e=>window.addEventListener("mouseup",t=>e(t))),ut=g([0,0,0],e=>window.addEventListener("wheel",t=>{e([-t.deltaX,-t.deltaY,0])}));var dt=Object.freeze({__proto__:null,position:lt,mouse_up:ct,scroll:ut});const ht=g(["#version 300 es\nprecision highp float;\n#define GLSLIFY 1\n\nuniform mat4 u_view_projection;\nuniform float u_sprite_size;\nuniform float u_sprite_columns;\nuniform float u_time;\nuniform float u_background_color;\n\nin vec3 translate;\nin vec3 translate_last;\n\nin float scale;\nin float scale_last;\n\nin float rotation;\nin float rotation_last;\n\nin float alpha;\nin float alpha_last;\n\nin float color;\nin float color_last;\n\nin float sprite;\n\nin vec2 position;\n\nout vec2 v_sprite;\nout vec4 v_color;\n\nvoid main() {\n\t// mix the last color and the new color\n\tint c_last = int(color_last);\n\tint c = int(color);\n\n\tv_color = mix(\n\t\tvec4((c_last>>16) &0x0ff, (c_last>>8) &0x0ff, (c_last) & 0x0ff, alpha_last),\n\t\tvec4((c>>16) &0x0ff, (c>>8) &0x0ff, (c) & 0x0ff, alpha),\n\t\tu_time\n\t);\n\n\t// mix the color with the background color\n\t// int ubc = int(u_background_color);\n\t// vec4 color_bg = vec4((ubc>>16) &0x0ff, (ubc>>8) &0x0ff, (ubc) & 0x0ff, alpha);\n\n\t// v_color = mix(color_bg, v_color, alpha);\n\n\t// scale\n\tfloat s = mix(scale_last, scale, u_time);\n\n\t// Grabbing the tile\n\tfloat x = mod(sprite, u_sprite_columns);\n\tfloat y = floor(sprite / u_sprite_columns);\n\n\tvec2 pos_scale = position * s;\n\tvec2 coords = (position + vec2(0.5, 0.5) + vec2(x, y))/u_sprite_columns;\n\tv_sprite = coords;\n\n\t// position\n\tvec3 t = mix(translate_last, translate, u_time);\n\n\tmat4 mv = u_view_projection;\n\tvec3 pos = vec3(pos_scale, 0.0) + t;\n\n\tgl_Position = mv * vec4(\n\t\tpos,\n\t\t1.0\n\t);\n}\n","#version 300 es\nprecision highp float;\n#define GLSLIFY 1\n\nuniform sampler2D u_map;\n\nin vec2 v_sprite;\nin vec4 v_color;\n\nout vec4 f_color;\n\nvoid main() {\n\tf_color = texture(u_map, v_sprite);\n\n\t// grayscale to remove any color from the image\n\tfloat gray = dot(f_color.rgb, vec3(0.299, 0.587, 0.114));\n\tf_color = gray * vec4(v_color.rgb, v_color.a);\n\n\t// super important, removes low opacity frags\n\tif(f_color.a < 0.1) discard;\n}"]),pt=e=>{const t=e.set.bind(e);return n=>{if(!Array.isArray(n))return n&&"number"==typeof n[0]&&"number"==typeof n[1]&&"number"==typeof n[2]?void e.set(n):void 0;t(n)}},ft=$(s.m4.identity()),mt=$([0,0,0]),gt=$([0,0,-1]);gt.set=pt(gt),mt.set=pt(mt);var vt=Object.freeze({__proto__:null,camera:ft,position:mt,look:gt});const $t=Object.entries({position:[0,0,0],sprite:[0],scale:[1],color:[16777215],rotation:[0],alpha:[1]}),wt=s.primitives.createXYQuadVertices(1);let yt=0;const _t={...a(wt)(([e,t])=>(t.divisor=0,[e,t])),translate_last:{divisor:1,data:[],numComponents:3},translate:{divisor:1,data:[],numComponents:3},rotation:{numComponents:1,data:[],divisor:1},rotation_last:{numComponents:1,data:[],divisor:1},alpha:{numComponents:1,data:[],divisor:1},alpha_last:{numComponents:1,data:[],divisor:1},color:{numComponents:1,data:[],divisor:1},color_last:{numComponents:1,data:[],divisor:1},sprite:{numComponents:1,data:[],divisor:1},scale:{numComponents:1,data:[],divisor:1},scale_last:{numComponents:1,data:[],divisor:1}},bt={position:{},scale:{},alpha:{},color:{},rotation:{}};let xt=Date.now();const kt=()=>({count:yt,buffer:_t,time:(Date.now()-xt)/E.get()});de.listen(()=>requestAnimationFrame(()=>{const e={sprite:[],position:[],position_last:[],scale:[],scale_last:[],color:[],color_last:[],alpha:[],alpha_last:[],rotation:[],rotation_last:[]},t=(t,n,s=1)=>{const r=bt[t][n]||e[t].slice(-s);bt[t][n]=e[t].slice(-s),e[`${t}_last`].push(...r)};u(be).forEach(n=>{const s=n.id.get(),r=n.value.get();$t.forEach(([t,n])=>{if(!r[t])return e[t].push(...n);let s=r[t].get();if("number"==typeof s&&(s=Array(n.length).fill(s)),!Array.isArray(s))return e[t].push(...n);const o=[];for(let e=0;e<n.length;e++){if("number"!=typeof s[e]||e>=s.length)return void o.push(n[e]);o.push(s[e])}e[t].push(...o)}),t("position",s,3),t("scale",s),t("alpha",s),t("rotation",s),t("color",s)}),Object.entries(e).forEach(([e,t])=>{"position"!==e?"position_last"!==e?_t[e].data=t:_t.translate_last.data=t:_t.translate.data=t}),yt=_t.sprite.data.length,xt=Date.now()}));let Et=[0,0,0,1];P.listen(t=>{const{red:n,green:s,blue:r}=e(t).toRGB();Et=[n,s,r,1]});const{m4:Ot}=s,St=[0,1,0];const jt=g([window.innerWidth,window.innerHeight],e=>{window.addEventListener("resize",()=>{e([window.innerWidth,window.innerHeight])})}),zt=$(1);jt.subscribe(([e,t])=>{const n=e>t?t:e;zt.set(n/100),window.document.documentElement.style.fontSize=`${Math.round(zt.get())}px`});const Nt=g((()=>{const e={last:[0,0,0],next:[0,0,0],future:[0,0,0],update(){e.last=[...e.next],e.next=mt.get()},get:t=>{const n=s.v3.lerp(e.last,e.next,t);return 1-t<.05&&e.update(),n}},t=document.createElement("canvas");t.width=1600,t.height=1600;const n=s.getContext(t);s.addExtensionsToContext(n);const r=s.createTextures(n,{map:{src:O.get(),mag:n.NEAREST,min:n.LINEAR}}),o=s.createProgramInfo(n,ht.get());t.snap=$(kt());const a=Ot.identity(),i=Ot.identity();return t.cancel=pe.listen(([l,c])=>{const u=kt();n.viewport(0,0,n.canvas.width,n.canvas.height),n.clearColor(...Et),n.clear(n.COLOR_BUFFER_BIT|n.GL_DEPTH_BUFFER_BIT),n.enable(n.DEPTH_TEST),n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA);const d=t.width/t.height,h=s.m4.ortho(-10*d,10*d,10,-10,-100,50),p=ft.get(),f=e.get(u.time);if(Ot.lookAt(f,s.v3.add(f,gt.get()),St,p),Ot.inverse(p,a),Ot.multiply(h,a,i),u.count<1)return;const m={u_map:r.map,u_time:u.time,u_sprite_size:16,u_sprite_columns:32,u_view_projection:i,u_background_color:Math.round(256*Et[0]*256)+Math.round(256*Et[1])+Et[2]};try{const e=s.createBufferInfoFromArrays(n,u.buffer),t=s.createVertexArrayInfo(n,o,e);n.useProgram(o.program),s.setBuffersAndAttributes(n,o,t),s.setUniforms(o,m),s.drawObjectList(n,[{programInfo:o,vertexArrayInfo:t,uniforms:m,instanceCount:u.count}])}catch(e){console.warn(`GPU ERROR ${e}`)}}),t})());var At=Object.freeze({__proto__:null,size:jt,scale:zt,main:Nt});const Mt=g("",e=>{window.addEventListener("keyup",t=>{"INPUT"!==t.target.tagName&&"TEXTAREA"!==t.target.tagName&&(t.preventDefault(),e(`${t.key.toLowerCase()}!`))}),window.addEventListener("keydown",t=>{"INPUT"!==t.target.tagName&&"TEXTAREA"!==t.target.tagName&&(t.preventDefault(),e(t.key.toLowerCase()))})}),Tt=g({},e=>{const t={};Mt.listen(n=>{t[n]=!0,n.length>1&&"!"===n[n.length-1]?t[n.slice(0,-1)]=!1:t[`${n}!`]=!1,e(t)})});var Lt=Object.freeze({__proto__:null,key:Mt,keys:Tt});
/* @license twgl.js 4.14.1 Copyright (c) 2015, Gregg Tavares All Rights Reserved.
	Available via the MIT license.
	see: http://github.com/greggman/twgl.js for details */let Ct=Float32Array;var Rt=Object.freeze({__proto__:null,add:function(e,t,n){return(n=n||new Ct(3))[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n},copy:function(e,t){return(t=t||new Ct(3))[0]=e[0],t[1]=e[1],t[2]=e[2],t},create:function(e,t,n){const s=new Ct(3);return e&&(s[0]=e),t&&(s[1]=t),n&&(s[2]=n),s},cross:function(e,t,n){n=n||new Ct(3);const s=e[2]*t[0]-e[0]*t[2],r=e[0]*t[1]-e[1]*t[0];return n[0]=e[1]*t[2]-e[2]*t[1],n[1]=s,n[2]=r,n},distance:function(e,t){const n=e[0]-t[0],s=e[1]-t[1],r=e[2]-t[2];return Math.sqrt(n*n+s*s+r*r)},distanceSq:function(e,t){const n=e[0]-t[0],s=e[1]-t[1],r=e[2]-t[2];return n*n+s*s+r*r},divide:function(e,t,n){return(n=n||new Ct(3))[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n},divScalar:function(e,t,n){return(n=n||new Ct(3))[0]=e[0]/t,n[1]=e[1]/t,n[2]=e[2]/t,n},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},lerp:function(e,t,n,s){return(s=s||new Ct(3))[0]=e[0]+n*(t[0]-e[0]),s[1]=e[1]+n*(t[1]-e[1]),s[2]=e[2]+n*(t[2]-e[2]),s},lerpV:function(e,t,n,s){return(s=s||new Ct(3))[0]=e[0]+n[0]*(t[0]-e[0]),s[1]=e[1]+n[1]*(t[1]-e[1]),s[2]=e[2]+n[2]*(t[2]-e[2]),s},length:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},lengthSq:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},max:function(e,t,n){return(n=n||new Ct(3))[0]=Math.max(e[0],t[0]),n[1]=Math.max(e[1],t[1]),n[2]=Math.max(e[2],t[2]),n},min:function(e,t,n){return(n=n||new Ct(3))[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n[2]=Math.min(e[2],t[2]),n},mulScalar:function(e,t,n){return(n=n||new Ct(3))[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n},multiply:function(e,t,n){return(n=n||new Ct(3))[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n},negate:function(e,t){return(t=t||new Ct(3))[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},normalize:function(e,t){t=t||new Ct(3);const n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.sqrt(n);return s>1e-5?(t[0]=e[0]/s,t[1]=e[1]/s,t[2]=e[2]/s):(t[0]=0,t[1]=0,t[2]=0),t},setDefaultType:function(e){const t=Ct;return Ct=e,t},subtract:function(e,t,n){return(n=n||new Ct(3))[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}});const{length:Wt,add:It,mulScalar:Dt}=Rt,Pt=$(.75),Ft=g([0,0,0],e=>{const t=[0,0,0];pe.listen(()=>{const{w:n,a:s,s:r,d:o,q:a,e:i}=Tt.get();t[0]=0,t[1]=0,t[2]=0,n&&(t[1]-=1),r&&(t[1]+=1),s&&(t[0]-=1),o&&(t[0]+=1),a&&(t[2]+=1),i&&(t[2]-=1),0!==Wt(t)&&e(t)})});let Jt=[0,0,0];const qt=k(e=>e.map(e=>Math.round(e)));qt.set([0,0,0]),de.listen(()=>{Math.abs(Wt(Jt))<1||(qt.set(It(qt.get(),Jt).map(e=>Math.round(e))),Jt=Dt(Jt,.25))}),ut.listen(e=>{Jt=It(Jt,e)});const Ut=$("");var Bt=Object.freeze({__proto__:null,zoom:Pt,translate:Ft,scroll:qt,focus:Ut});let Yt="";const Ht=k(e=>{if(window.history.pushState({page:1},"",`${Yt}${e}`),Array.isArray(e))return e;const t=e.split("/");return window.location.pathname,t});window.addEventListener("popstate",e=>{e.preventDefault(),e.stopPropagation(),Gt()});const Gt=()=>{window.location.search?(Yt="?",Ht.set(decodeURI(window.location.search.slice(1)))):Ht.set(decodeURI(window.location.pathname.slice(1)))};Gt();var Xt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var Vt=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e,t){!function(){function t(e,t,n){var s=new XMLHttpRequest;s.open("GET",e),s.responseType="blob",s.onload=function(){o(s.response,t,n)},s.onerror=function(){console.error("could not download file")},s.send()}function n(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function s(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var r="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof Xt&&Xt.global===Xt?Xt:void 0,o=r.saveAs||("object"!=typeof window||window!==r?function(){}:"download"in HTMLAnchorElement.prototype?function(e,o,a){var i=r.URL||r.webkitURL,l=document.createElement("a");o=o||e.name||"download",l.download=o,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?s(l):n(l.href)?t(e,o,a):s(l,l.target="_blank")):(l.href=i.createObjectURL(e),setTimeout((function(){i.revokeObjectURL(l.href)}),4e4),setTimeout((function(){s(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,r,o){if(r=r||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,o),r);else if(n(e))t(e,r,o);else{var a=document.createElement("a");a.href=e,a.target="_blank",setTimeout((function(){s(a)}))}}:function(e,n,s,o){if((o=o||open("","_blank"))&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,s);var a="application/octet-stream"===e.type,i=/constructor/i.test(r.HTMLElement)||r.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||a&&i)&&"object"==typeof FileReader){var c=new FileReader;c.onloadend=function(){var e=c.result;e=l?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=e:location=e,o=null},c.readAsDataURL(e)}else{var u=r.URL||r.webkitURL,d=u.createObjectURL(e);o?o.location=d:location.href=d,o=null,setTimeout((function(){u.revokeObjectURL(d)}),4e4)}});r.saveAs=o.saveAs=o,e.exports=o}()}));const Kt=R.get(),Zt=C.get(),Qt=new Promise(e=>{const t=new Image;t.src="/sheets/default_2.png",t.onload=()=>{const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const s=n.getContext("2d");s.drawImage(t,0,0),e({ctx:s,canvas:n})}}),en=new Map,tn=(e,t)=>Math.floor(Math.random()*(Math.abs(e)+Math.abs(t))-Math.abs(e));var nn=async({width:e,height:t,data:n,random:s=!1})=>{const{canvas:r}=await Qt,o=`${e}:${t}:${n}`;if(!s&&en.has(o))return en.get(o);const a=document.createElement("canvas"),i=a.getContext("2d");if(a.width=16*e,a.height=16*t,s){let n,s,o,a;for(let l=0;l<e;l++)for(let e=0;e<t;e++)n=16*l,s=16*e,o=16*tn(0,Kt),a=16*tn(0,Zt/Kt),i.drawImage(r,o,a,16,16,n,s,16,16)}else if(n.length>0){let t,s;n.split(" ").forEach((n,o)=>{t=o%e,s=Math.floor(o/e);const a=parseInt(n,10),l=a%Kt,c=Math.floor(a/Kt),u=16*t,d=16*s,h=16*l,p=16*c;i.drawImage(r,h,p,16,16,u,d,16,16)})}const l=a.toDataURL("image/png");return s||en.set(o,l),l};const sn=e=>{try{const t=r.load(e);return JSON.parse(t["0th"][r.ImageIFD.Make])}catch(e){return!1}},rn=$(!1),on=async e=>{const t={"0th":{[r.ImageIFD.Make]:JSON.stringify(e),[r.ImageIFD.Software]:"isekai"},Exif:{},GPS:{}};Vt.saveAs(r.insert(r.dump(t),await cn(e.name.get())),`${e.name.get()}.jpg`),rn.set(e.name)},an=e=>new Promise(async t=>{const n=new Image;n.src=await nn(e),n.onload=()=>t(n)}),ln=an({width:4,height:4,data:["18 19 19 20","50 0 0 52","50 0 0 52","82 83 83 84"].join(" ")}),cn=async e=>{const t=H(`/${e}`),n=an({width:1,height:1,data:t}),s=document.createElement("canvas");s.width=64,s.height=64;const r=s.getContext("2d");return r.imageSmoothingEnabled=!1,r.filter="sepia(1) hue-rotate(90deg)",r.drawImage(await ln,0,0,64,64,0,0,64,64),r.drawImage(await n,0,0,16,16,16,16,32,32),s.toDataURL("image/jpeg",.95)},un=async(e,t=!1)=>{const n=`https://raw.githubusercontent.com/${e[0]}/${e[1]}/master/${e[2]}.jpg`,s=new FileReader,r=await fetch(n).then(e=>e.blob());return s.readAsDataURL(r),new Promise((n,r)=>{s.addEventListener("load",()=>{const o=sn(s.result);if(!o)return r(new Error(404));Wheel.spawn({[o.name]:o}),Wheel.get(o.name).write({"!info":{type:"space",value:{from:e.join("/"),url:`https://github.com/${e[0]}/${e[1]}/blob/master/${e[2]}.jpg`}}}),t&&Wheel.start(o.name),n(o.name)})})};IDBKeyRange.upperBound(Date.now()-6e4);let dn;const hn=$(!1),pn=new Promise(e=>{const t=window.indexedDB.open("isekai",2);t.onupgradeneeded=async e=>{dn=e.target.result,await dn.createObjectStore("wheel",{keyPath:"name"})},t.onsuccess=t=>{dn=t.target.result,e(dn)}}),fn=({store:e="wheel",action:t="get",args:n=[],foronly:s="readwrite"}=!1)=>new Promise((r,o)=>{pn.then(()=>{const a=dn.transaction([e],s);a.onerror=o,a.objectStore(e)[t](...n).onsuccess=e=>r(e.target.result)})});window.query=fn;const mn=async e=>{hn.set(!1);const t=await fn({action:"get",args:[e]}).catch(e=>console.warn("DB",e.target.error));if(t){const{weaves:n,running:s}=t;delete n[Wheel.SYSTEM],Wheel.name.set(e),Wheel.spawn(n),Object.keys(s).forEach(e=>{e!==Wheel.SYSTEM&&Wheel.get(e)&&Wheel.start(e)})}hn.set(!0);const n=de.listen(e=>{e%10==0&&void 0!==dn&&hn.get()&&(async()=>{const e=Wheel.toJSON();e.date=Date.now(),await fn({action:"put",args:[e],foronly:"readwrite"})})()});return()=>{Wheel.clear(),Wheel.name.set("loading"),n()}};let gn=!1;Ht.listen(async e=>{gn&&gn.then(e=>e()),1===e.length&&(Wheel.name.set(e[0]),gn=mn(e[0])),3===e.length&&(await hn,Wheel.name.set("loading"),await un(e,!0),Wheel.name.set(e.join("/")),gn=mn(e.join("/")))});const vn={mouse:dt,time:fe,screen:At,input:Bt,key:Lt,flag:a(U)(([e,t])=>[e.replace(/_/g," ").toLowerCase(),t]),camera:vt};var $n,wn=Ke({name:"sys",id:"sys",warps:($n=vn,l($n)((e,[t,n])=>({...e,[t]:{type:"space",value:{...n,"!name":t}}}),{})),rezed:vn});function yn(){}function _n(e){return e()}function bn(){return Object.create(null)}function xn(e){e.forEach(_n)}function kn(e){return"function"==typeof e}function En(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function On(e,t){const n=e.subscribe(t);return n.unsubscribe?()=>n.unsubscribe():n}function Sn(e,t,n){e.$$.on_destroy.push(On(t,n))}function jn(e,t,n,s){if(e){const r=zn(e,t,n,s);return e[0](r)}}function zn(e,t,n,s){return e[1]&&s?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](s(t))):n.ctx}function Nn(e,t,n,s){if(e[2]&&s){const r=e[2](s(n));if("object"==typeof t.dirty){const e=[],n=Math.max(t.dirty.length,r.length);for(let s=0;s<n;s+=1)e[s]=t.dirty[s]|r[s];return e}return t.dirty|r}return t.dirty}function An(e){return e&&kn(e.destroy)?e.destroy:yn}function Mn(e,t){e.appendChild(t)}function Tn(e,t,n){e.insertBefore(t,n||null)}function Ln(e){e.parentNode.removeChild(e)}function Cn(e){return document.createElement(e)}function Rn(e){return document.createTextNode(e)}function Wn(){return Rn(" ")}function In(){return Rn("")}function Dn(e,t,n,s){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)}function Pn(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Fn(e,t){t=""+t,e.data!==t&&(e.data=t)}function Jn(e,t){(null!=t||e.value)&&(e.value=t)}function qn(e,t,n,s){e.style.setProperty(t,n,s?"important":"")}function Un(e,t,n){e.classList[n?"add":"remove"](t)}let Bn;function Yn(e){Bn=e}function Hn(){if(!Bn)throw new Error("Function called outside component initialization");return Bn}const Gn=[],Xn=[],Vn=[],Kn=[],Zn=Promise.resolve();let Qn=!1;function es(e){Vn.push(e)}function ts(){const e=new Set;do{for(;Gn.length;){const e=Gn.shift();Yn(e),ns(e.$$)}for(;Xn.length;)Xn.pop()();for(let t=0;t<Vn.length;t+=1){const n=Vn[t];e.has(n)||(n(),e.add(n))}Vn.length=0}while(Gn.length);for(;Kn.length;)Kn.pop()();Qn=!1}function ns(e){if(null!==e.fragment){e.update(),xn(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(es)}}const ss=new Set;let rs;function os(){rs={r:0,c:[],p:rs}}function as(){rs.r||xn(rs.c),rs=rs.p}function is(e,t){e&&e.i&&(ss.delete(e),e.i(t))}function ls(e,t,n,s){if(e&&e.o){if(ss.has(e))return;ss.add(e),rs.c.push(()=>{ss.delete(e),s&&(n&&e.d(1),s())}),e.o(t)}}function cs(e,t){const n=t.token={};function s(e,s,r,o){if(t.token!==n)return;t.resolved=o;let a=t.ctx;void 0!==r&&(a=a.slice(),a[r]=o);const i=e&&(t.current=e)(a);let l=!1;t.block&&(t.blocks?t.blocks.forEach((e,n)=>{n!==s&&e&&(os(),ls(e,1,1,()=>{t.blocks[n]=null}),as())}):t.block.d(1),i.c(),is(i,1),i.m(t.mount(),t.anchor),l=!0),t.block=i,t.blocks&&(t.blocks[s]=i),l&&ts()}if((r=e)&&"object"==typeof r&&"function"==typeof r.then){const n=Hn();if(e.then(e=>{Yn(n),s(t.then,1,t.value,e),Yn(null)},e=>{Yn(n),s(t.catch,2,t.error,e),Yn(null)}),t.current!==t.pending)return s(t.pending,0),!0}else{if(t.current!==t.then)return s(t.then,1,t.value,e),!0;t.resolved=e}var r}function us(e,t){ls(e,1,1,()=>{t.delete(e.key)})}function ds(e,t,n,s,r,o,a,i,l,c,u,d){let h=e.length,p=o.length,f=h;const m={};for(;f--;)m[e[f].key]=f;const g=[],v=new Map,$=new Map;for(f=p;f--;){const e=d(r,o,f),i=n(e);let l=a.get(i);l?s&&l.p(e,t):(l=c(i,e),l.c()),v.set(i,g[f]=l),i in m&&$.set(i,Math.abs(f-m[i]))}const w=new Set,y=new Set;function _(e){is(e,1),e.m(i,u),a.set(e.key,e),u=e.first,p--}for(;h&&p;){const t=g[p-1],n=e[h-1],s=t.key,r=n.key;t===n?(u=t.first,h--,p--):v.has(r)?!a.has(s)||w.has(s)?_(t):y.has(r)?h--:$.get(s)>$.get(r)?(y.add(s),_(t)):(w.add(r),h--):(l(n,a),h--)}for(;h--;){const t=e[h];v.has(t.key)||l(t,a)}for(;p;)_(g[p-1]);return g}function hs(e){e&&e.c()}function ps(e,t,n){const{fragment:s,on_mount:r,on_destroy:o,after_update:a}=e.$$;s&&s.m(t,n),es(()=>{const t=r.map(_n).filter(kn);o?o.push(...t):xn(t),e.$$.on_mount=[]}),a.forEach(es)}function fs(e,t){const n=e.$$;null!==n.fragment&&(xn(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ms(e,t){-1===e.$$.dirty[0]&&(Gn.push(e),Qn||(Qn=!0,Zn.then(ts)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function gs(e,t,n,s,r,o,a=[-1]){const i=Bn;Yn(e);const l=t.props||{},c=e.$$={fragment:null,ctx:null,props:o,update:yn,not_equal:r,bound:bn(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(i?i.$$.context:[]),callbacks:bn(),dirty:a};let u=!1;c.ctx=n?n(e,l,(t,n,s=n)=>(c.ctx&&r(c.ctx[t],c.ctx[t]=s)&&(c.bound[t]&&c.bound[t](s),u&&ms(e,t)),n)):[],c.update(),u=!0,xn(c.before_update),c.fragment=!!s&&s(c.ctx),t.target&&(t.hydrate?c.fragment&&c.fragment.l(function(e){return Array.from(e.childNodes)}(t.target)):c.fragment&&c.fragment.c(),t.intro&&is(e.$$.fragment),ps(e,t.target,t.anchor),ts()),Yn(i)}class vs{$destroy(){fs(this,1),this.$destroy=yn}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}function $s(e){let t,n;return{c(){t=Cn("input"),Pn(t,"type","text"),Pn(t,"class","omni svelte-brjjhm"),qn(t,"border","0.25rem solid "+e[2]),Pn(t,"placeholder",e[1]),n=[Dn(t,"input",e[11]),Dn(t,"keydown",e[12]),Dn(t,"blur",e[3])]},m(n,s){Tn(n,t,s),Jn(t,e[0])},p(e,[n]){4&n&&qn(t,"border","0.25rem solid "+e[2]),2&n&&Pn(t,"placeholder",e[1]),1&n&&t.value!==e[0]&&Jn(t,e[0])},i:yn,o:yn,d(e){e&&Ln(t),xn(n)}}}function ws(e,t,n){let s,r;Sn(e,de,e=>n(7,s=e)),Sn(e,J,e=>n(2,r=e));let{command:o=(()=>{})}=t,{system:a=!1}=t,i="";const l=a?"!":"! > + -";let c=l;const u=(e,t)=>{if(t.length<20)return c;const n=Math.floor(e/2)%t.length;return t.slice(-n)+t.slice(0,-n)},d={"!":()=>{n(6,c=a?"SYSTEM CAN ONLY FILTER!!! ":"[ADD]+Name [MOVE]~Name/Name [DELETE]-Name")},undefined:()=>{n(6,c=l)}},h=()=>{const e=[i[0],...i.slice(1).split("/")];if(n(0,i=""),a)return d["!"]();d[e[0]]&&d[e[0]](e),o(e,e=>{n(6,c=e)})};let p;return e.$set=e=>{"command"in e&&n(4,o=e.command),"system"in e&&n(5,a=e.system)},e.$$.update=()=>{192&e.$$.dirty&&n(1,p=u(s,c))},[i,p,r,h,o,a,c,s,l,u,d,function(){i=this.value,n(0,i)},e=>{13===e.which&&h()}]}class ys extends vs{constructor(e){super(),gs(this,e,ws,$s,En,{command:4,system:5})}}function _s(e){return{c:yn,m:yn,p:yn,d:yn}}function bs(e){let t,n;return{c(){t=Cn("img"),Pn(t,"class","tileset svelte-1jo87w8"),Pn(t,"alt","tileset image"),t.src!==(n=e[7])&&Pn(t,"src",n)},m(e,n){Tn(e,t,n)},p(e,s){1&s&&t.src!==(n=e[7])&&Pn(t,"src",n)},d(e){e&&Ln(t)}}}function xs(e){return{c:yn,m:yn,p:yn,d:yn}}function ks(e){let t,n,s={ctx:e,current:null,token:null,pending:xs,then:bs,catch:_s,value:7};return cs(n=e[0],s),{c(){t=In(),s.block.c()},m(e,n){Tn(e,t,n),s.block.m(e,s.anchor=n),s.mount=()=>t.parentNode,s.anchor=t},p(t,[r]){if(e=t,s.ctx=e,1&r&&n!==(n=e[0])&&cs(n,s));else{const t=e.slice();t[7]=s.resolved,s.block.p(t,r)}},i:yn,o:yn,d(e){e&&Ln(t),s.block.d(e),s.token=null,s=null}}}function Es(e,t,n){let s,r,{data:o=""}=t,{width:a=10}=t,{height:i=7}=t,{random:l=!1}=t,{text:c=!1}=t;return e.$set=e=>{"data"in e&&n(1,o=e.data),"width"in e&&n(2,a=e.width),"height"in e&&n(3,i=e.height),"random"in e&&n(4,l=e.random),"text"in e&&n(5,c=e.text)},e.$$.update=()=>{34&e.$$.dirty&&n(6,s=c?H(c):o),92&e.$$.dirty&&n(0,r=nn({width:a,height:i,data:s,random:l}))},[r,o,a,i,l,c]}class Os extends vs{constructor(e){super(),gs(this,e,Es,ks,En,{data:1,width:2,height:3,random:4,text:5})}}function Ss(e){let t,n;const s=new Os({props:{width:1,height:1,text:e[0]}});return{c(){t=Cn("div"),hs(s.$$.fragment),Pn(t,"class","postage svelte-1qad2nn"),Un(t,"isrunning",e[4]),Un(t,"isrezed",e[6]),Un(t,"issystem",e[5])},m(e,r){Tn(e,t,r),ps(s,t,null),n=!0},p(e,[n]){const r={};1&n&&(r.text=e[0]),s.$set(r),16&n&&Un(t,"isrunning",e[4]),64&n&&Un(t,"isrezed",e[6]),32&n&&Un(t,"issystem",e[5])},i(e){n||(is(s.$$.fragment,e),n=!0)},o(e){ls(s.$$.fragment,e),n=!1},d(e){e&&Ln(t),fs(s)}}}function js(e,t,n){let s,r,o,a=yn,i=yn,l=yn;e.$$.on_destroy.push(()=>a()),e.$$.on_destroy.push(()=>i()),e.$$.on_destroy.push(()=>l());let{address:c=""}=t;const[,u,d]=c.split("/");let h,p,f,m,g,v,$,w,y;return e.$set=e=>{"address"in e&&n(0,c=e.address)},e.$$.update=()=>{128&e.$$.dirty&&(n(2,f=p.names),a(),a=On(f,e=>n(9,s=e))),128&e.$$.dirty&&(n(3,m=p.rezed),l(),l=On(m,e=>n(12,o=e))),512&e.$$.dirty&&n(8,g=s[d]),256&e.$$.dirty&&n(10,v=g?g.id.get():""),2048&e.$$.dirty&&n(4,$=!0===r[u]),5120&e.$$.dirty&&n(6,y=o[v])},n(1,h=Wheel.running),i(),i=On(h,e=>n(11,r=e)),n(7,p=Wheel.get(u)||Wheel.get(Wheel.SYSTEM)),n(5,w=u===Wheel.SYSTEM),[c,h,f,m,$,w,y]}class zs extends vs{constructor(e){super(),gs(this,e,js,Ss,En,{address:0})}}function Ns(e){let t,n,s,r={ctx:e,current:null,token:null,pending:Ts,then:Ms,catch:As,value:11};return cs(n=cn(e[0].name.get()),r),{c(){t=Cn("div"),r.block.c(),Pn(t,"class","save svelte-93xhmj"),s=Dn(t,"click",e[5])},m(e,n){Tn(e,t,n),r.block.m(t,r.anchor=null),r.mount=()=>t,r.anchor=null},p(t,s){if(e=t,r.ctx=e,1&s&&n!==(n=cn(e[0].name.get()))&&cs(n,r));else{const t=e.slice();t[11]=r.resolved,r.block.p(t,s)}},d(e){e&&Ln(t),r.block.d(),r.token=null,r=null,s()}}}function As(e){return{c:yn,m:yn,p:yn,d:yn}}function Ms(e){let t,n;return{c(){t=Cn("img"),t.src!==(n=e[11])&&Pn(t,"src",n),Pn(t,"alt","save"),Pn(t,"class","svelte-93xhmj")},m(e,n){Tn(e,t,n)},p(e,s){1&s&&t.src!==(n=e[11])&&Pn(t,"src",n)},d(e){e&&Ln(t)}}}function Ts(e){return{c:yn,m:yn,p:yn,d:yn}}function Ls(e){let t,n,s,r,o;const a=new zs({props:{address:`/${e[3]}`}});let i=e[3]!==Wheel.SYSTEM&&Ns(e);return{c(){t=Cn("div"),n=Cn("div"),hs(a.$$.fragment),s=Wn(),i&&i.c(),Pn(n,"class","postage svelte-93xhmj"),Pn(t,"class","controls svelte-93xhmj"),o=Dn(n,"click",e[4])},m(e,o){Tn(e,t,o),Mn(t,n),ps(a,n,null),Mn(t,s),i&&i.m(t,null),r=!0},p(e,[n]){const s={};8&n&&(s.address=`/${e[3]}`),a.$set(s),e[3]!==Wheel.SYSTEM?i?i.p(e,n):(i=Ns(e),i.c(),i.m(t,null)):i&&(i.d(1),i=null)},i(e){r||(is(a.$$.fragment,e),r=!0)},o(e){ls(a.$$.fragment,e),r=!1},d(e){e&&Ln(t),fs(a),i&&i.d(),o()}}}function Cs(e,t,n){let s,r,o,a,i=yn,l=yn;Sn(e,J,e=>n(9,o=e)),Sn(e,I,e=>n(10,a=e)),e.$$.on_destroy.push(()=>i()),e.$$.on_destroy.push(()=>l());let{weave:c}=t;let u,d,h;return e.$set=e=>{"weave"in e&&n(0,c=e.weave)},e.$$.update=()=>{1&e.$$.dirty&&(n(1,u=c.name),l(),l=On(u,e=>n(3,r=e))),129&e.$$.dirty&&(h=s[c.name.get()]),e.$$.dirty},n(2,d=Wheel.running),i(),i=On(d,e=>n(7,s=e)),[c,u,d,r,e=>{e.stopPropagation(),e.preventDefault(),h?Wheel.stop(r):Wheel.start(r),h=!h},e=>{e.preventDefault(),e.stopPropagation(),on(c)}]}class Rs extends vs{constructor(e){super(),gs(this,e,Cs,Ls,En,{weave:0})}}var Ws=e=>([t,...n],s)=>{const[r,o]=n,a=e.names.get(),l=a[r];switch(t){case">":return l?a[o]?s(`${o} already exists`):void 0:s(`Couldn't find ${r}`);case"~":return void 0;case"+":return o?e.write({[r]:{type:"space",value:{[o]:$(1)}}}):void e.write({[r]:{type:"space"}});case"-":if(-1!==r.indexOf("*")){const t=r.replace("*",""),n=e.names.get(),s=[];i(n)(([e,n])=>{e.slice(0,t.length)===t&&s.push(n.id.get())}),e.remove(...s)}if(o){const t=e.get_name(r);if(!t)return;return void t.value.remove(o)}e.remove_name(r)}},Is=(t,n)=>{const s={update:n=>{const s=e(I.get()),r=e(B(JSON.stringify(n))).blend(s,.8);t.style.backgroundColor=r.toCSS()}};return s.update(n),s};const Ds=(t,n)=>{const s=()=>{t.style.backgroundColor=e(B(JSON.stringify(n))).blend(e(I.get()),.8).darkenByRatio(.2)};return s(),{update:s}};function Ps(e){let t,n,s,r,o,a,i,l,c,u,d,h,p,f,m,g=e[1]+1+"",v=e[2].length+"";const $=e[11].default,w=jn($,e,e[10],null);return{c(){t=Cn("div"),n=Cn("div"),s=Cn("div"),s.textContent="<",o=Wn(),a=Cn("div"),i=Rn(g),l=Rn(" : "),c=Rn(v),u=Wn(),d=Cn("div"),d.textContent=">",p=Wn(),w&&w.c(),Pn(s,"class","button svelte-jxbzei"),Pn(a,"class","flex svelte-jxbzei"),Pn(d,"class","button svelte-jxbzei"),Pn(n,"class","navigation svelte-jxbzei"),qn(n,"border-bottom","0.25rem solid "+e[4]),qn(n,"background-color",e[4]),Pn(t,"class","sub_space svelte-jxbzei"),m=[Dn(s,"click",e[12]),An(r=Is.call(null,s,e[5])),An(h=Is.call(null,d,e[5])),Dn(d,"click",e[13])]},m(e,r){Tn(e,t,r),Mn(t,n),Mn(n,s),Mn(n,o),Mn(n,a),Mn(a,i),Mn(a,l),Mn(a,c),Mn(n,u),Mn(n,d),Mn(t,p),w&&w.m(t,null),f=!0},p(e,[t]){r&&kn(r.update)&&32&t&&r.update.call(null,e[5]),(!f||2&t)&&g!==(g=e[1]+1+"")&&Fn(i,g),(!f||4&t)&&v!==(v=e[2].length+"")&&Fn(c,v),h&&kn(h.update)&&32&t&&h.update.call(null,e[5]),(!f||16&t)&&qn(n,"border-bottom","0.25rem solid "+e[4]),(!f||16&t)&&qn(n,"background-color",e[4]),w&&w.p&&1024&t&&w.p(zn($,e,e[10],null),Nn($,e[10],t,null))},i(e){f||(is(w,e),f=!0)},o(e){ls(w,e),f=!1},d(e){e&&Ln(t),w&&w.d(e),xn(m)}}}function Fs(e,t,n){let s,r,o,a=yn,i=()=>(a(),a=On(u,e=>n(2,s=e)),u),l=yn;Sn(e,J,e=>n(4,r=e)),e.$$.on_destroy.push(()=>a()),e.$$.on_destroy.push(()=>l());let{weave:c}=t,{birds:u=g([])}=t;i();let{set_bird:d}=t,h=0,p=!1,{$$slots:f={},$$scope:m}=t;let v,$;return e.$set=e=>{"weave"in e&&n(6,c=e.weave),"birds"in e&&i(n(0,u=e.birds)),"set_bird"in e&&n(7,d=e.set_bird),"$$scope"in e&&n(10,m=e.$$scope)},e.$$.update=()=>{70&e.$$.dirty&&n(9,v=c.get_id(s[h])),966&e.$$.dirty&&(!1===p&&n(8,p=v),v&&v!==p&&(n(9,v.birdex=h,v),d(v),n(8,p=v)),v||requestAnimationFrame(()=>{n(9,v=c.get_id(s[h]))})),512&e.$$.dirty&&(n(3,$=v?v.name():g("")),l(),l=On($,e=>n(5,o=e)))},[u,h,s,$,r,o,c,d,p,v,m,f,()=>{let e=h-1;e<0&&(e=s.length-1),void 0===s.length&&(e=0),n(1,h=e)},()=>{let e=h+1;void 0===s.length&&(e=0),e>=s.length&&(e=0),n(1,h=e)}]}class Js extends vs{constructor(e){super(),gs(this,e,Fs,Ps,En,{weave:6,birds:0,set_bird:7})}}function qs(e){let t,n,s,r;return{c(){t=Cn("div"),n=Cn("div"),Pn(n,"class","cursor svelte-19zzj9f"),qn(n,"transform","translate("+e[2]+"px,"+e[3]+"px)"),Pn(t,"class","edit svelte-19zzj9f"),Pn(t,"style",s=[`background-image: url('${e[4]}');`,`background-color: ${e[5]};`,`border: 1rem solid ${e[6]};`].join("")),r=[Dn(t,"click",e[14]),Dn(t,"mousemove",e[8])]},m(e,s){Tn(e,t,s),Mn(t,n)},p(e,r){12&r&&qn(n,"transform","translate("+e[2]+"px,"+e[3]+"px)"),112&r&&s!==(s=[`background-image: url('${e[4]}');`,`background-color: ${e[5]};`,`border: 1rem solid ${e[6]};`].join(""))&&Pn(t,"style",s)},d(e){e&&Ln(t),xn(r)}}}function Us(e){let t;const n=new Os({props:{width:1,height:1,data:JSON.stringify(e[7])}});return{c(){hs(n.$$.fragment)},m(e,s){ps(n,e,s),t=!0},p(e,t){const s={};128&t&&(s.data=JSON.stringify(e[7])),n.$set(s)},i(e){t||(is(n.$$.fragment,e),t=!0)},o(e){ls(n.$$.fragment,e),t=!1},d(e){fs(n,e)}}}function Bs(e){let t,n,s,r,o=e[0]&&qs(e),a=e[1]&&Us(e);return{c(){o&&o.c(),t=Wn(),n=Cn("div"),a&&a.c(),Pn(n,"class","tile svelte-19zzj9f"),r=[Dn(window,"click",e[10]),Dn(n,"click",e[15])]},m(e,r){o&&o.m(e,r),Tn(e,t,r),Tn(e,n,r),a&&a.m(n,null),s=!0},p(e,[s]){e[0]?o?o.p(e,s):(o=qs(e),o.c(),o.m(t.parentNode,t)):o&&(o.d(1),o=null),e[1]?a?(a.p(e,s),is(a,1)):(a=Us(e),a.c(),is(a,1),a.m(n,null)):a&&(os(),ls(a,1,1,()=>{a=null}),as())},i(e){s||(is(a),s=!0)},o(e){ls(a),s=!1},d(e){o&&o.d(e),e&&Ln(t),e&&Ln(n),a&&a.d(),xn(r)}}}function Ys(e,t,n){let s,r,o,a,i,l=yn,c=()=>(l(),l=On(u,e=>n(7,i=e)),u);Sn(e,R,e=>n(11,s=e)),Sn(e,O,e=>n(4,r=e)),Sn(e,I,e=>n(5,o=e)),Sn(e,J,e=>n(6,a=e)),e.$$.on_destroy.push(()=>l());let{value:u}=t;c();let{editing:d=!1}=t,h=0,p=0;const f=(e,t)=>{const n=Math.round((e-t)/t);return Math.max(0,Math.min(n,s-1))},m=e=>{const[t,n]=[e.target.clientWidth/2,e.target.clientHeight/2];return[e.layerX+t,e.layerY+n]},g=e=>{const t=e.target.clientWidth/s,[r,o]=m(e);u.set(f(r,t)+f(o,t)*s),n(0,d=!1)};return e.$set=e=>{"value"in e&&c(n(1,u=e.value)),"editing"in e&&n(0,d=e.editing)},[d,u,h,p,r,o,a,i,e=>{const t=e.target.clientWidth/s,[r,o]=m(e);n(2,h=f(r,t)*t),n(3,p=f(o,t)*t)},g,()=>{d&&n(0,d=!1)},s,f,m,e=>{e.preventDefault(),e.stopPropagation(),g(e)},e=>{e.preventDefault(),e.stopPropagation(),n(0,d=!d)}]}class Hs extends vs{constructor(e){super(),gs(this,e,Ys,Bs,En,{value:1,editing:0})}}function Gs(e){let t,n;return{c(){t=Cn("div"),Pn(t,"class","dopick svelte-e0axn4"),qn(t,"background-color",e[3](e[2])),n=[Dn(t,"click",e[7]),Dn(t,"mousemove",e[5])]},m(e,n){Tn(e,t,n)},p(e,n){4&n&&qn(t,"background-color",e[3](e[2]))},d(e){e&&Ln(t),xn(n)}}}function Xs(e){let t,n,s,r=e[1]&&Gs(e);return{c(){r&&r.c(),t=Wn(),n=Cn("div"),Pn(n,"type","color"),qn(n,"background-color",e[3](e[2])),Pn(n,"class","picker svelte-e0axn4"),s=[Dn(window,"click",e[6]),Dn(n,"click",e[4])]},m(e,s){r&&r.m(e,s),Tn(e,t,s),Tn(e,n,s)},p(e,[s]){e[1]?r?r.p(e,s):(r=Gs(e),r.c(),r.m(t.parentNode,t)):r&&(r.d(1),r=null),4&s&&qn(n,"background-color",e[3](e[2]))},i:yn,o:yn,d(e){r&&r.d(e),e&&Ln(t),e&&Ln(n),xn(s)}}}function Vs(t,n,s){let r,o=yn,a=()=>(o(),o=On(i,e=>s(2,r=e)),i);t.$$.on_destroy.push(()=>o());let{value:i}=n;a();let l=!1;return t.$set=e=>{"value"in e&&a(s(0,i=e.value))},[i,l,r,t=>e([t>>16&255,t>>8&255,255&t]).toCSS(),e=>{e.preventDefault(),e.stopPropagation(),s(1,l=!0)},({x:t,y:n,target:s})=>{const{top:r,left:o,width:a,height:i}=s.getBoundingClientRect(),l=(t-o)/a,c=(n-r)/i,{red:u,green:d,blue:h}=e({hue:l,lightness:c,saturation:1}).toRGB(),p=[u,d,h].map(e=>Math.round(255*e));console.log(p)},()=>{l&&s(1,l=!1)},e=>{e.preventDefault(),e.stopPropagation(),s(1,l=!1)}]}class Ks extends vs{constructor(e){super(),gs(this,e,Vs,Xs,En,{value:0})}}function Zs(e){let t,n,s,r;return{c(){t=Cn("textarea"),Pn(t,"spellcheck","false"),Pn(t,"class","edit svelte-18o22ik"),Pn(t,"type","text"),Pn(t,"style",n=`background-color: ${e[1]}; border:0.5rem solid ${e[2]};`),r=[An(s=e[3].call(null,t)),Dn(t,"input",e[9]),Dn(t,"click",Qs),Dn(t,"keydown",e[10]),Dn(t,"blur",e[11])]},m(n,s){Tn(n,t,s),Jn(t,e[0])},p(e,[s]){6&s&&n!==(n=`background-color: ${e[1]}; border:0.5rem solid ${e[2]};`)&&Pn(t,"style",n),1&s&&Jn(t,e[0])},i:yn,o:yn,d(e){e&&Ln(t),xn(r)}}}const Qs=e=>e.stopPropagation();function er(e,t,n){let s,r;Sn(e,I,e=>n(1,s=e)),Sn(e,J,e=>n(2,r=e));let{code:o}=t,{weave:a}=t,{address:i}=t,{ondone:l=(()=>{})}=t;let c=!0;const u=()=>{c&&(c=!1,se({code:o,weave:a,address:i}),l())};return e.$set=e=>{"code"in e&&n(0,o=e.code),"weave"in e&&n(5,a=e.weave),"address"in e&&n(6,i=e.address),"ondone"in e&&n(7,l=e.ondone)},[o,s,r,e=>requestAnimationFrame(()=>e.focus()),u,a,i,l,c,function(){o=this.value,n(0,o)},e=>{e.ctrlKey&&13===e.which&&(u(),e.preventDefault(),e.stopPropagation())},e=>{u()}]}class tr extends vs{constructor(e){super(),gs(this,e,er,Zs,En,{code:0,weave:5,address:6,ondone:7})}}function nr(e){let t,n,s=oe(e[0],e[1])+"";return{c(){t=Cn("div"),n=Rn(s),Pn(t,"data:type",e[4]),Pn(t,"class","pad svelte-59p353")},m(e,s){Tn(e,t,s),Mn(t,n)},p(e,r){3&r&&s!==(s=oe(e[0],e[1])+"")&&Fn(n,s),16&r&&Pn(t,"data:type",e[4])},i:yn,o:yn,d(e){e&&Ln(t)}}}function sr(e){let t,n;var s=e[5][e[4]];function r(e){return{props:{value:e[2].value}}}if(s)var o=new s(r(e));return{c(){o&&hs(o.$$.fragment),t=In()},m(e,s){o&&ps(o,e,s),Tn(e,t,s),n=!0},p(e,n){const a={};if(4&n&&(a.value=e[2].value),s!==(s=e[5][e[4]])){if(o){os();const e=o;ls(e.$$.fragment,1,0,()=>{fs(e,1)}),as()}s?(hs((o=new s(r(e))).$$.fragment),is(o.$$.fragment,1),ps(o,t.parentNode,t)):o=null}else s&&o.$set(a)},i(e){n||(o&&is(o.$$.fragment,e),n=!0)},o(e){o&&ls(o.$$.fragment,e),n=!1},d(e){e&&Ln(t),o&&fs(o,e)}}}function rr(e){let t,n,s,r;const o=[sr,nr],a=[];function i(e,t){return e[5][e[4]]?0:1}return t=i(e),n=a[t]=o[t](e),{c(){n.c(),s=In()},m(e,n){a[t].m(e,n),Tn(e,s,n),r=!0},p(e,[r]){let l=t;t=i(e),t===l?a[t].p(e,r):(os(),ls(a[l],1,1,()=>{a[l]=null}),as(),n=a[t],n||(n=a[t]=o[t](e),n.c()),is(n,1),n.m(s.parentNode,s))},i(e){r||(is(n),r=!0)},o(e){ls(n),r=!1},d(e){a[t].d(e),e&&Ln(s)}}}function or(e,t,n){let s,r=yn;e.$$.on_destroy.push(()=>r());let{id:o}=t,{weave:a}=t;const i={sprite:Hs,color:Ks};let l,c;return e.$set=e=>{"id"in e&&n(0,o=e.id),"weave"in e&&n(1,a=e.weave)},e.$$.update=()=>{3&e.$$.dirty&&n(2,l=a.get_id(o)),4&e.$$.dirty&&(n(3,c=l&&l.type||g("unknown")),r(),r=On(c,e=>n(4,s=e)))},[o,a,l,c,s,i]}class ar extends vs{constructor(e){super(),gs(this,e,or,rr,En,{id:0,weave:1})}}function ir(e,t,n){const s=e.slice();return s[22]=t[n],s}function lr(e){let t;const n=new tr({props:{code:e[5],ondone:e[10],weave:e[0],address:e[6]}});return{c(){hs(n.$$.fragment)},m(e,s){ps(n,e,s),t=!0},p(e,t){const s={};32&t&&(s.code=e[5]),1&t&&(s.weave=e[0]),64&t&&(s.address=e[6]),n.$set(s)},i(e){t||(is(n.$$.fragment,e),t=!0)},o(e){ls(n.$$.fragment,e),t=!1},d(e){fs(n,e)}}}function cr(e){let t,n,s,r,o=e[4].length>0&&dr(e);function a(e,t){return e[4].length>0?fr:pr}let i=a(e),l=i(e);return{c(){o&&o.c(),t=Wn(),n=Cn("div"),l.c(),Pn(n,"class","cap svelte-kaxf1j"),r=Dn(n,"click",e[11])},m(e,r){o&&o.m(e,r),Tn(e,t,r),Tn(e,n,r),l.m(n,null),s=!0},p(e,s){e[4].length>0?o?(o.p(e,s),is(o,1)):(o=dr(e),o.c(),is(o,1),o.m(t.parentNode,t)):o&&(os(),ls(o,1,1,()=>{o=null}),as()),i===(i=a(e))&&l?l.p(e,s):(l.d(1),l=i(e),l&&(l.c(),l.m(n,null)))},i(e){s||(is(o),s=!0)},o(e){ls(o),s=!1},d(e){o&&o.d(e),e&&Ln(t),e&&Ln(n),l.d(),r()}}}function ur(e){let t;function n(e,t){return e[4].length>0?gr:mr}let s=n(e),r=s(e);return{c(){t=Cn("div"),r.c(),Pn(t,"class","cap svelte-kaxf1j"),Un(t,"nothread",e[1])},m(e,n){Tn(e,t,n),r.m(t,null)},p(e,o){s===(s=n(e))&&r?r.p(e,o):(r.d(1),r=s(e),r&&(r.c(),r.m(t,null))),2&o&&Un(t,"nothread",e[1])},i:yn,o:yn,d(e){e&&Ln(t),r.d()}}}function dr(e){let t,n,s,r=e[4],o=[];for(let t=0;t<r.length;t+=1)o[t]=hr(ir(e,r,t));const a=e=>ls(o[e],1,1,()=>{o[e]=null});return{c(){t=Cn("div");for(let e=0;e<o.length;e+=1)o[e].c();Pn(t,"class","spot svelte-kaxf1j"),Un(t,"right",e[2]),s=Dn(t,"click",e[11])},m(e,s){Tn(e,t,s);for(let e=0;e<o.length;e+=1)o[e].m(t,null);n=!0},p(e,n){if(785&n){let s;for(r=e[4],s=0;s<r.length;s+=1){const a=ir(e,r,s);o[s]?(o[s].p(a,n),is(o[s],1)):(o[s]=hr(a),o[s].c(),is(o[s],1),o[s].m(t,null))}for(os(),s=r.length;s<o.length;s+=1)a(s);as()}4&n&&Un(t,"right",e[2])},i(e){if(!n){for(let e=0;e<r.length;e+=1)is(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)ls(o[e]);n=!1},d(e){e&&Ln(t),function(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}(o,e),s()}}}function hr(e){let t,n,s,r,o,a;const i=new ar({props:{weave:e[0],id:e[22]}});return{c(){t=Cn("div"),hs(i.$$.fragment),s=Wn(),r=Cn("div"),Pn(t,"class","thread svelte-kaxf1j"),Pn(t,"style",e[8]),Un(t,"active",e[9]),Pn(r,"class","after-thread svelte-kaxf1j"),Pn(r,"style",e[8]),Un(r,"active",e[9]),a=An(n=Is.call(null,t,oe(e[22],e[0])))},m(e,n){Tn(e,t,n),ps(i,t,null),Tn(e,s,n),Tn(e,r,n),o=!0},p(s,a){e=s;const l={};1&a&&(l.weave=e[0]),16&a&&(l.id=e[22]),i.$set(l),(!o||256&a)&&Pn(t,"style",e[8]),n&&kn(n.update)&&17&a&&n.update.call(null,oe(e[22],e[0])),512&a&&Un(t,"active",e[9]),(!o||256&a)&&Pn(r,"style",e[8]),512&a&&Un(r,"active",e[9])},i(e){o||(is(i.$$.fragment,e),o=!0)},o(e){ls(i.$$.fragment,e),o=!1},d(e){e&&Ln(t),fs(i),e&&Ln(s),e&&Ln(r),a()}}}function pr(e){let t;return{c(){t=Rn(" ")},m(e,n){Tn(e,t,n)},p:yn,d(e){e&&Ln(t)}}}function fr(e){let t,n=e[4].length+"";return{c(){t=Rn(n)},m(e,n){Tn(e,t,n)},p(e,s){16&s&&n!==(n=e[4].length+"")&&Fn(t,n)},d(e){e&&Ln(t)}}}function mr(e){let t;return{c(){t=Rn(" ")},m(e,n){Tn(e,t,n)},p:yn,d(e){e&&Ln(t)}}}function gr(e){let t,n=e[4].length+"";return{c(){t=Rn(n)},m(e,n){Tn(e,t,n)},p(e,s){16&s&&n!==(n=e[4].length+"")&&Fn(t,n)},d(e){e&&Ln(t)}}}function vr(e){let t,n,s,r,o,a=e[3]&&lr(e);const i=[ur,cr],l=[];function c(e,t){return e[1]?0:1}return n=c(e),s=l[n]=i[n](e),{c(){a&&a.c(),t=Wn(),s.c(),r=In()},m(e,s){a&&a.m(e,s),Tn(e,t,s),l[n].m(e,s),Tn(e,r,s),o=!0},p(e,[o]){e[3]?a?(a.p(e,o),is(a,1)):(a=lr(e),a.c(),is(a,1),a.m(t.parentNode,t)):a&&(os(),ls(a,1,1,()=>{a=null}),as());let u=n;n=c(e),n===u?l[n].p(e,o):(os(),ls(l[u],1,1,()=>{l[u]=null}),as(),s=l[n],s||(s=l[n]=i[n](e),s.c()),is(s,1),s.m(r.parentNode,r))},i(e){o||(is(a),is(s),o=!0)},o(e){ls(a),ls(s),o=!1},d(e){a&&a.d(e),e&&Ln(t),l[n].d(e),e&&Ln(r)}}}function $r(e,t,n){let s,r,o,a,i=yn;Sn(e,de,e=>n(17,r=e)),Sn(e,J,e=>n(18,o=e)),Sn(e,I,e=>n(19,a=e)),e.$$.on_destroy.push(()=>i());let l,{channel:c}=t,{space:u}=t,{weave:d}=t,{nothread:h}=t,{right:p=!1}=t,f=!1;const m=()=>p?d.chain($,p).slice(1):d.chain($).slice(0,-1),g=()=>{n(4,l=m())};let v="";let $,w,y,_,b;return e.$set=e=>{"channel"in e&&n(12,c=e.channel),"space"in e&&n(13,u=e.space),"weave"in e&&n(0,d=e.weave),"nothread"in e&&n(1,h=e.nothread),"right"in e&&n(2,p=e.right)},e.$$.update=()=>{12288&e.$$.dirty&&n(6,$=`${u.id.get()}/${c[0]}`),4096&e.$$.dirty&&(n(7,w=c[1]),i(),i=On(w,e=>n(14,s=e))),16384&e.$$.dirty&&g(),17&e.$$.dirty&&(y=l.map(e=>ne(e,d)).join(" => ")),e.$$.dirty,786432&e.$$.dirty&&n(8,_=[`border: 0.25rem solid ${o};`,`background-color: ${a};`].join(""))},n(9,b=!1),[d,h,p,f,l,v,$,w,_,!1,()=>{f&&(n(3,f=!1),g())},e=>{e.preventDefault(),e.stopPropagation(),d.name.get()!==Wheel.SYSTEM&&(f||(n(3,f=!0),n(5,v=re(m().map(e=>ne(e,d)).join(" => ")))))},c,u]}class wr extends vs{constructor(e){super(),gs(this,e,$r,vr,En,{channel:12,space:13,weave:0,nothread:1,right:2})}}var yr=(e,t)=>(e.id=t,{destroy:()=>{}});function _r(e){let t,n,s;return{c(){t=Cn("input"),Pn(t,"class","edit svelte-gvd7ce"),Pn(t,"type","text"),Pn(t,"placeholder","JSON PLZ"),s=[An(n=e[14].call(null,t)),Dn(t,"input",e[17]),Dn(t,"keydown",e[18]),Dn(t,"blur",e[19])]},m(n,s){Tn(n,t,s),Jn(t,e[5])},p(e,n){32&n&&t.value!==e[5]&&Jn(t,e[5])},i:yn,o:yn,d(e){e&&Ln(t),xn(s)}}}function br(e){let t,n,s,r,o,a,i;const l=[Er,kr,xr],c=[];function u(e,t){return"sprite"===e[6]?0:"color"===e[6]?1:2}return r=u(e),o=c[r]=l[r](e),{c(){t=Cn("div"),n=Rn(e[6]),s=Wn(),o.c(),a=In(),Pn(t,"class","key svelte-gvd7ce")},m(e,o){Tn(e,t,o),Mn(t,n),Tn(e,s,o),c[r].m(e,o),Tn(e,a,o),i=!0},p(e,t){(!i||64&t)&&Fn(n,e[6]);let s=r;r=u(e),r===s?c[r].p(e,t):(os(),ls(c[s],1,1,()=>{c[s]=null}),as(),o=c[r],o||(o=c[r]=l[r](e),o.c()),is(o,1),o.m(a.parentNode,a))},i(e){i||(is(o),i=!0)},o(e){ls(o),i=!1},d(e){e&&Ln(t),e&&Ln(s),c[r].d(e),e&&Ln(a)}}}function xr(e){let t,n,s=JSON.stringify(e[8])+"";return{c(){t=Cn("div"),n=Rn(s),Pn(t,"class","value svelte-gvd7ce")},m(e,s){Tn(e,t,s),Mn(t,n)},p(e,t){256&t&&s!==(s=JSON.stringify(e[8])+"")&&Fn(n,s)},i:yn,o:yn,d(e){e&&Ln(t)}}}function kr(e){let t,n,s;const r=new Ks({props:{value:e[7]}});return{c(){hs(r.$$.fragment),t=Wn(),n=Cn("div"),Pn(n,"class","flex svelte-gvd7ce")},m(e,o){ps(r,e,o),Tn(e,t,o),Tn(e,n,o),s=!0},p(e,t){const n={};128&t&&(n.value=e[7]),r.$set(n)},i(e){s||(is(r.$$.fragment,e),s=!0)},o(e){ls(r.$$.fragment,e),s=!1},d(e){fs(r,e),e&&Ln(t),e&&Ln(n)}}}function Er(e){let t,n,s;const r=new Hs({props:{value:e[7]}});return{c(){hs(r.$$.fragment),t=Wn(),n=Cn("gdiv"),Pn(n,"class","flex svelte-gvd7ce")},m(e,o){ps(r,e,o),Tn(e,t,o),Tn(e,n,o),s=!0},p(e,t){const n={};128&t&&(n.value=e[7]),r.$set(n)},i(e){s||(is(r.$$.fragment,e),s=!0)},o(e){ls(r.$$.fragment,e),s=!1},d(e){fs(r,e),e&&Ln(t),e&&Ln(n)}}}function Or(e){let t,n,s,r,o,a,i,l,c,u;const d=new wr({props:{channel:e[3],space:e[0],weave:e[2],nothread:e[1]}}),h=[br,_r],p=[];function f(e,t){return e[10]?1:0}s=f(e),r=p[s]=h[s](e);const m=new wr({props:{channel:e[3],space:e[0],weave:e[2],nothread:e[1],right:!0}});return{c(){t=Cn("div"),hs(d.$$.fragment),n=Wn(),r.c(),o=Wn(),hs(m.$$.fragment),Pn(t,"class",a="channel "+e[4]+" svelte-gvd7ce"),Pn(t,"style",e[12]),u=[An(i=Is.call(null,t,e[0].name().get())),An(l=yr.call(null,t,e[11])),Dn(t,"click",e[20])]},m(e,r){Tn(e,t,r),ps(d,t,null),Mn(t,n),p[s].m(t,null),Mn(t,o),ps(m,t,null),c=!0},p(e,[n]){const u={};8&n&&(u.channel=e[3]),1&n&&(u.space=e[0]),4&n&&(u.weave=e[2]),2&n&&(u.nothread=e[1]),d.$set(u);let g=s;s=f(e),s===g?p[s].p(e,n):(os(),ls(p[g],1,1,()=>{p[g]=null}),as(),r=p[s],r||(r=p[s]=h[s](e),r.c()),is(r,1),r.m(t,o));const v={};8&n&&(v.channel=e[3]),1&n&&(v.space=e[0]),4&n&&(v.weave=e[2]),2&n&&(v.nothread=e[1]),m.$set(v),(!c||16&n&&a!==(a="channel "+e[4]+" svelte-gvd7ce"))&&Pn(t,"class",a),(!c||4096&n)&&Pn(t,"style",e[12]),i&&kn(i.update)&&1&n&&i.update.call(null,e[0].name().get()),l&&kn(l.update)&&2048&n&&l.update.call(null,e[11])},i(e){c||(is(d.$$.fragment,e),is(r),is(m.$$.fragment,e),c=!0)},o(e){ls(d.$$.fragment,e),ls(r),ls(m.$$.fragment,e),c=!1},d(e){e&&Ln(t),fs(d),p[s].d(),fs(m),xn(u)}}}function Sr(e,t,n){let s,r,o=yn;Sn(e,q,e=>n(12,r=e)),e.$$.on_destroy.push(()=>o());let{space:a}=t,{nothread:i}=t,{weave:l}=t,{channel:c}=t,{side:u="in"}=t,{focus:d=!1}=t,{executed:h=(()=>{})}=t,p="";const f=()=>{n(10,$=!1);try{g.set(je(p))}catch(e){}n(5,p=""),h()};let m,g,v,$,w;return e.$set=e=>{"space"in e&&n(0,a=e.space),"nothread"in e&&n(1,i=e.nothread),"weave"in e&&n(2,l=e.weave),"channel"in e&&n(3,c=e.channel),"side"in e&&n(4,u=e.side),"focus"in e&&n(15,d=e.focus),"executed"in e&&n(16,h=e.executed)},e.$$.update=()=>{8&e.$$.dirty&&n(6,[m,g]=c,m,(n(7,g),o(),o=On(g,e=>n(9,s=e)),g)),512&e.$$.dirty&&n(8,v=s),32768&e.$$.dirty&&n(10,$=d),65&e.$$.dirty&&n(11,w=`${a.address()}/${m}`)},[a,i,l,c,u,p,m,g,v,s,$,w,r,f,e=>{requestAnimationFrame(()=>e.focus())},d,h,function(){p=this.value,n(5,p)},({which:e})=>{13===e&&f()},()=>{f()},()=>{n(10,$=!0),n(5,p=JSON.stringify(s))}]}class jr extends vs{constructor(e){super(),gs(this,e,Sr,Or,En,{space:0,nothread:1,weave:2,channel:3,side:4,focus:15,executed:16})}}function zr(e,t,n){const s=e.slice();return s[22]=t[n],s}function Nr(e){let t,n,s,r,o,a,i,l;const c=new zs({props:{address:`/${e[13]}/${e[11]}`}});return{c(){t=Cn("div"),n=Cn("div"),hs(c.$$.fragment),s=Wn(),r=Cn("div"),o=Rn(e[11]),Pn(n,"class","postage svelte-yy067"),Pn(r,"class","name svelte-yy067"),Pn(t,"class","space svelte-yy067"),qn(t,"border","0.25rem solid "+e[12]),Un(t,"open",Rr),l=[Dn(n,"click",e[15]),An(a=Is.call(null,t,e[11]))]},m(e,a){Tn(e,t,a),Mn(t,n),ps(c,n,null),Mn(t,s),Mn(t,r),Mn(r,o),i=!0},p(e,n){const s={};10240&n&&(s.address=`/${e[13]}/${e[11]}`),c.$set(s),(!i||2048&n)&&Fn(o,e[11]),(!i||4096&n)&&qn(t,"border","0.25rem solid "+e[12]),a&&kn(a.update)&&2048&n&&a.update.call(null,e[11]),0&n&&Un(t,"open",Rr)},i(e){i||(is(c.$$.fragment,e),i=!0)},o(e){ls(c.$$.fragment,e),i=!1},d(e){e&&Ln(t),fs(c),xn(l)}}}function Ar(e,t){let n,s;const r=new jr({props:{channel:t[22],space:t[0],weave:t[1],nothread:t[2]}});return{key:e,first:null,c(){n=In(),hs(r.$$.fragment),this.first=n},m(e,t){Tn(e,n,t),ps(r,e,t),s=!0},p(e,t){const n={};512&t&&(n.channel=e[22]),1&t&&(n.space=e[0]),2&t&&(n.weave=e[1]),4&t&&(n.nothread=e[2]),r.$set(n)},i(e){s||(is(r.$$.fragment,e),s=!0)},o(e){ls(r.$$.fragment,e),s=!1},d(e){e&&Ln(n),fs(r,e)}}}function Mr(e){let t;const n=new Js({props:{birds:e[8],weave:e[1],set_bird:e[21],$$slots:{default:[Lr]},$$scope:{ctx:e}}});return{c(){hs(n.$$.fragment)},m(e,s){ps(n,e,s),t=!0},p(e,t){const s={};256&t&&(s.birds=e[8]),2&t&&(s.weave=e[1]),33570818&t&&(s.$$scope={dirty:t,ctx:e}),n.$set(s)},i(e){t||(is(n.$$.fragment,e),t=!0)},o(e){ls(n.$$.fragment,e),t=!1},d(e){fs(n,e)}}}function Tr(e){let t;const n=new Ir({props:{weave:e[1],space:e[14],is_bird:!0}});return{c(){hs(n.$$.fragment)},m(e,s){ps(n,e,s),t=!0},p(e,t){const s={};2&t&&(s.weave=e[1]),16384&t&&(s.space=e[14]),n.$set(s)},i(e){t||(is(n.$$.fragment,e),t=!0)},o(e){ls(n.$$.fragment,e),t=!1},d(e){fs(n,e)}}}function Lr(e){let t,n,s=e[14]&&Tr(e);return{c(){s&&s.c(),t=In()},m(e,r){s&&s.m(e,r),Tn(e,t,r),n=!0},p(e,n){e[14]?s?(s.p(e,n),is(s,1)):(s=Tr(e),s.c(),is(s,1),s.m(t.parentNode,t)):s&&(os(),ls(s,1,1,()=>{s=null}),as())},i(e){n||(is(s),n=!0)},o(e){ls(s),n=!1},d(e){s&&s.d(e),e&&Ln(t)}}}function Cr(e){let t,n,s,r,o=!e[2]&&Nr(e),a=function(e){let t,n,s=[],r=new Map,o=e[9];const a=e=>e[22][0];for(let t=0;t<o.length;t+=1){let n=zr(e,o,t),i=a(n);r.set(i,s[t]=Ar(i,n))}return{c(){t=Cn("div");for(let e=0;e<s.length;e+=1)s[e].c();Pn(t,"class","chans svelte-yy067")},m(e,r){Tn(e,t,r);for(let e=0;e<s.length;e+=1)s[e].m(t,null);n=!0},p(e,n){const o=e[9];os(),s=ds(s,n,a,1,e,o,r,t,us,Ar,null,zr),as()},i(e){if(!n){for(let e=0;e<o.length;e+=1)is(s[e]);n=!0}},o(e){for(let e=0;e<s.length;e+=1)ls(s[e]);n=!1},d(e){e&&Ln(t);for(let e=0;e<s.length;e+=1)s[e].d()}}}(e),i=e[8]&&e[10]&&Mr(e);return{c(){o&&o.c(),t=Wn(),a&&a.c(),n=Wn(),i&&i.c(),s=In()},m(e,l){o&&o.m(e,l),Tn(e,t,l),a&&a.m(e,l),Tn(e,n,l),i&&i.m(e,l),Tn(e,s,l),r=!0},p(e,[n]){e[2]?o&&(os(),ls(o,1,1,()=>{o=null}),as()):o?(o.p(e,n),is(o,1)):(o=Nr(e),o.c(),is(o,1),o.m(t.parentNode,t)),a.p(e,n),e[8]&&e[10]?i?(i.p(e,n),is(i,1)):(i=Mr(e),i.c(),is(i,1),i.m(s.parentNode,s)):i&&(os(),ls(i,1,1,()=>{i=null}),as())},i(e){r||(is(o),is(a),is(i),r=!0)},o(e){ls(o),ls(a),ls(i),r=!1},d(e){o&&o.d(e),e&&Ln(t),a&&a.d(e),e&&Ln(n),i&&i.d(e),e&&Ln(s)}}}const Rr=!0;function Wr(e,t,n){let s,r,o,a,i,l,c,u=yn,d=yn,h=yn,p=yn,f=yn;Sn(e,J,e=>n(12,i=e)),e.$$.on_destroy.push(()=>u()),e.$$.on_destroy.push(()=>d()),e.$$.on_destroy.push(()=>h()),e.$$.on_destroy.push(()=>p()),e.$$.on_destroy.push(()=>f());let{space:m}=t,{weave:v}=t,{is_bird:w=!1}=t;const y=$(!1);Sn(e,y,e=>n(14,c=e));let _,b,x,k,E,O,S,j,z;return e.$set=e=>{"space"in e&&n(0,m=e.space),"weave"in e&&n(1,v=e.weave),"is_bird"in e&&n(2,w=e.is_bird)},e.$$.update=()=>{2&e.$$.dirty&&(n(3,_=v.name),f(),f=On(_,e=>n(13,l=e))),2&e.$$.dirty&&(n(4,b=v.rezed),d(),d=On(b,e=>n(19,r=e))),1&e.$$.dirty&&(n(5,x=m?m.value:g({"!name":g(""),"!birds":g([])})),u(),u=On(x,e=>n(17,s=e))),131072&e.$$.dirty&&(n(6,k=s["!name"]||g("")),p(),p=On(k,e=>n(11,a=e))),1&e.$$.dirty&&(n(7,E=m.id),h(),h=On(E,e=>n(20,o=e))),131072&e.$$.dirty&&n(8,O=s["!birds"]),131072&e.$$.dirty&&(S=s["!bird"]),131072&e.$$.dirty&&n(9,j=Object.entries(s).sort(([e],[t])=>e>t?1:t>e?-1:0)),1572864&e.$$.dirty&&n(10,z=r[o])},[m,v,w,_,b,x,k,E,O,j,z,a,i,l,c,e=>{e.preventDefault(),e.stopPropagation();const t=m.id.get();z?v.derez(t):v.rez(t)},y,s,S,r,o,e=>{y.set(e)}]}class Ir extends vs{constructor(e){super(),gs(this,e,Wr,Cr,En,{space:0,weave:1,is_bird:2})}}function Dr(e,t,n){const s=e.slice();return s[11]=t[n][0],s[12]=t[n][1],s}function Pr(e){let t,n,s,r=[],o=new Map;const a=new ys({props:{command:e[4],system:e[6]===Wheel.SYSTEM}});let i=e[5];const l=e=>e[11];for(let t=0;t<i.length;t+=1){let n=Dr(e,i,t),s=l(n);o.set(s,r[t]=Fr(s,n))}return{c(){t=Cn("div"),hs(a.$$.fragment),n=Wn();for(let e=0;e<r.length;e+=1)r[e].c();Pn(t,"class","spaces")},m(e,o){Tn(e,t,o),ps(a,t,null),Mn(t,n);for(let e=0;e<r.length;e+=1)r[e].m(t,null);s=!0},p(e,n){const s={};16&n&&(s.command=e[4]),64&n&&(s.system=e[6]===Wheel.SYSTEM),a.$set(s);const i=e[5];os(),r=ds(r,n,l,1,e,i,o,t,us,Fr,null,Dr),as()},i(e){if(!s){is(a.$$.fragment,e);for(let e=0;e<i.length;e+=1)is(r[e]);s=!0}},o(e){ls(a.$$.fragment,e);for(let e=0;e<r.length;e+=1)ls(r[e]);s=!1},d(e){e&&Ln(t),fs(a);for(let e=0;e<r.length;e+=1)r[e].d()}}}function Fr(e,t){let n,s;const r=new Ir({props:{space:t[12],weave:t[0]}});return{key:e,first:null,c(){n=In(),hs(r.$$.fragment),this.first=n},m(e,t){Tn(e,n,t),ps(r,e,t),s=!0},p(e,t){const n={};32&t&&(n.space=e[12]),1&t&&(n.weave=e[0]),r.$set(n)},i(e){s||(is(r.$$.fragment,e),s=!0)},o(e){ls(r.$$.fragment,e),s=!1},d(e){e&&Ln(n),fs(r,e)}}}function Jr(e){let t,n,s,r,o,a,i,l,c;const u=new Rs({props:{weave:e[0]}});let d=e[1]&&Pr(e);return{c(){t=Cn("div"),hs(u.$$.fragment),n=Wn(),s=Cn("div"),r=Rn(e[6]),a=Wn(),d&&d.c(),i=In(),Pn(s,"class","namezor svelte-ttw3ql"),Pn(t,"class","weave svelte-ttw3ql"),Pn(t,"style",e[7]),Un(t,"open",e[1]),c=[An(o=Ds.call(null,t,e[6])),Dn(t,"click",e[10])]},m(e,o){Tn(e,t,o),ps(u,t,null),Mn(t,n),Mn(t,s),Mn(s,r),Tn(e,a,o),d&&d.m(e,o),Tn(e,i,o),l=!0},p(e,[n]){const s={};1&n&&(s.weave=e[0]),u.$set(s),(!l||64&n)&&Fn(r,e[6]),(!l||128&n)&&Pn(t,"style",e[7]),o&&kn(o.update)&&64&n&&o.update.call(null,e[6]),2&n&&Un(t,"open",e[1]),e[1]?d?(d.p(e,n),is(d,1)):(d=Pr(e),d.c(),is(d,1),d.m(i.parentNode,i)):d&&(os(),ls(d,1,1,()=>{d=null}),as())},i(e){l||(is(u.$$.fragment,e),is(d),l=!0)},o(e){ls(u.$$.fragment,e),ls(d),l=!1},d(e){e&&Ln(t),fs(u),e&&Ln(a),d&&d.d(e),e&&Ln(i),xn(c)}}}function qr(e,t,n){let s,r,o,a=yn,i=yn;Sn(e,q,e=>n(7,o=e)),e.$$.on_destroy.push(()=>a()),e.$$.on_destroy.push(()=>i());let{weave:l}=t,c=l.name.get()!==Wheel.SYSTEM;let u,d,h,p,f;return e.$set=e=>{"weave"in e&&n(0,l=e.weave)},e.$$.update=()=>{1&e.$$.dirty&&(n(2,u=l.name),i(),i=On(u,e=>n(6,r=e))),1&e.$$.dirty&&(n(3,d=l.names),a(),a=On(d,e=>n(8,s=e))),1&e.$$.dirty&&n(4,h=Ws(l)),256&e.$$.dirty&&n(5,p=Object.entries(s).sort(([e],[t])=>e>t?1:t>e?-1:0)),1&e.$$.dirty&&(f=l.warps)},[l,c,u,d,h,p,r,o,s,f,()=>{n(1,c=!c)}]}class Ur extends vs{constructor(e){super(),gs(this,e,qr,Jr,En,{weave:0})}}function Br(e){let t,n,s,r,o,a,i,l,c,u,d,h,p,f,m={ctx:e,current:null,token:null,pending:Gr,then:Hr,catch:Yr,value:15};return cs(o=cn(e[2]),m),{c(){t=Cn("div"),n=Cn("h2"),n.textContent="Name It!",s=Wn(),r=Cn("div"),m.block.c(),a=Wn(),i=Cn("input"),l=Wn(),c=Cn("div"),u=Cn("div"),u.textContent="Cancel",d=Wn(),h=Cn("div"),h.textContent="Plant",Pn(r,"class","spirit svelte-vktjrt"),Pn(i,"class","nameit svelte-vktjrt"),Pn(i,"type","text"),Pn(i,"placeholder","Name it"),Pn(u,"class","false svelte-vktjrt"),Pn(h,"class","true svelte-vktjrt"),Pn(c,"class","controls svelte-vktjrt"),Pn(t,"class","nameprompt svelte-vktjrt"),f=[Dn(i,"keydown",e[10]),Dn(i,"input",e[11]),Dn(u,"click",e[12]),Dn(h,"click",e[5]),An(p=Is.call(null,t,`/${e[2]}`))]},m(o,p){Tn(o,t,p),Mn(t,n),Mn(t,s),Mn(t,r),m.block.m(r,m.anchor=null),m.mount=()=>r,m.anchor=null,Mn(t,a),Mn(t,i),Jn(i,e[2]),Mn(t,l),Mn(t,c),Mn(c,u),Mn(c,d),Mn(c,h)},p(t,n){if(e=t,m.ctx=e,4&n&&o!==(o=cn(e[2]))&&cs(o,m));else{const t=e.slice();t[15]=m.resolved,m.block.p(t,n)}4&n&&i.value!==e[2]&&Jn(i,e[2]),p&&kn(p.update)&&4&n&&p.update.call(null,`/${e[2]}`)},d(e){e&&Ln(t),m.block.d(),m.token=null,m=null,xn(f)}}}function Yr(e){return{c:yn,m:yn,p:yn,d:yn}}function Hr(e){let t,n;return{c(){t=Cn("img"),Pn(t,"class","flex svelte-vktjrt"),t.src!==(n=e[15])&&Pn(t,"src",n),Pn(t,"alt","fileicon")},m(e,n){Tn(e,t,n)},p(e,s){4&s&&t.src!==(n=e[15])&&Pn(t,"src",n)},d(e){e&&Ln(t)}}}function Gr(e){return{c:yn,m:yn,p:yn,d:yn}}function Xr(e){let t,n,s,r,o,a,i=e[1]&&Br(e);const l=e[9].default,c=jn(l,e,e[8],null);return{c(){i&&i.c(),t=Wn(),n=Cn("div"),c&&c.c(),s=Wn(),r=Cn("input"),Pn(n,"class","picker svelte-vktjrt"),Pn(r,"type","file"),Pn(r,"class","file svelte-vktjrt"),r.multiple="multiple",a=[Dn(n,"drop",e[3]),Dn(n,"dragover",e[4](!0)),Dn(n,"dragleave",e[4](!1)),Dn(r,"change",e[14])]},m(a,l){i&&i.m(a,l),Tn(a,t,l),Tn(a,n,l),c&&c.m(n,null),Tn(a,s,l),Tn(a,r,l),e[13](r),o=!0},p(e,[n]){e[1]?i?i.p(e,n):(i=Br(e),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null),c&&c.p&&256&n&&c.p(zn(l,e,e[8],null),Nn(l,e[8],n,null))},i(e){o||(is(c,e),o=!0)},o(e){ls(c,e),o=!1},d(o){i&&i.d(o),o&&Ln(t),o&&Ln(n),c&&c.d(o),o&&Ln(s),o&&Ln(r),e[13](null),xn(a)}}}function Vr(e,t,n){let s,r={},o=!1;const a=()=>{delete o.id,Wheel.spawn({[i]:o}),Wheel.get(i).write({"!info":{type:"space",value:{from:r.name,"save last":r.lastModified,size:r.size}}}),n(1,o=!1)};let i,{$$slots:l={},$$scope:c}=t;let u;return e.$set=e=>{"$$scope"in e&&n(8,c=e.$$scope)},u=Object.entries(Xe),[s,o,i,e=>{const t=e.dataTransfer.files;for(let e=0;e<t.length;e++){const s=new FileReader;s.onloadend=s=>{r=t[e],n(1,o=sn(s.target.result)),o&&n(2,i=`${o.name}`)},s.readAsDataURL(t[e])}e.preventDefault(),e.stopPropagation()},e=>e=>{e.dataTransfer.dropEffect="copy",e.preventDefault(),e.stopPropagation()},a,r,u,c,l,e=>{13===e.which&&a()},function(){i=this.value,n(2,i)},()=>{n(1,o=!1)},function(e){Xn[e?"unshift":"push"](()=>{n(0,s=e)})},e=>{console.log(e.dataTransfer,e.target)}]}class Kr extends vs{constructor(e){super(),gs(this,e,Vr,Xr,En,{})}}function Zr(e){let t,n,s,r;return{c(){t=Cn("div"),Pn(t,"class","main svelte-jdwyal"),Un(t,"full",e[0]),Un(t,"hidden",!e[1]),r=[An(n=e[3].call(null,t)),An(s=e[4].call(null,t)),Dn(t,"click",e[2])]},m(e,n){Tn(e,t,n)},p(e,[n]){1&n&&Un(t,"full",e[0]),2&n&&Un(t,"hidden",!e[1])},i:yn,o:yn,d(e){e&&Ln(t),xn(r)}}}function Qr(e,t,n){let{full:s=!1}=t,{hidden:r}=t;let o;return e.$set=e=>{"full"in e&&n(0,s=e.full),"hidden"in e&&n(1,r=e.hidden)},[s,r,()=>{n(0,s=!s)},e=>({destroy:Nt.subscribe(t=>{if(t&&t.style){for(o=t;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(t)}})}),e=>({destroy:jt.listen(([e,t])=>{o&&(o.width=e,o.height=t)})})]}class eo extends vs{constructor(e){super(),gs(this,e,Qr,Zr,En,{full:0,hidden:1})}}function to(e,t,n){const s=e.slice();return s[7]=t[n],s}function no(e){let t,n,s,r,o,a,i,l,c,u=[],d=new Map;const h=new ys({props:{command:e[5]}});let p=e[2];const f=e=>e[7].id.get();for(let t=0;t<p.length;t+=1){let n=to(e,p,t),s=f(n);d.set(s,u[t]=so(s,n))}return{c(){t=Cn("div"),n=Cn("div"),s=Cn("div"),r=Rn("[ I S E K A I ]"),o=Wn(),a=Cn("div"),hs(h.$$.fragment),i=Wn(),l=Cn("div");for(let e=0;e<u.length;e+=1)u[e].c();Pn(s,"class","logo svelte-50r9f5"),Pn(s,"style",e[4]),Pn(a,"class","events svelte-50r9f5"),Pn(l,"class","weaves svelte-50r9f5"),Pn(n,"class","partial svelte-50r9f5"),Pn(t,"class","explore svelte-50r9f5"),qn(t,"color",e[3])},m(e,d){Tn(e,t,d),Mn(t,n),Mn(n,s),Mn(s,r),Mn(n,o),Mn(n,a),ps(h,a,null),Mn(n,i),Mn(n,l);for(let e=0;e<u.length;e+=1)u[e].m(l,null);c=!0},p(e,n){(!c||16&n)&&Pn(s,"style",e[4]);const r=e[2];os(),u=ds(u,n,f,1,e,r,d,l,us,so,null,to),as(),(!c||8&n)&&qn(t,"color",e[3])},i(e){if(!c){is(h.$$.fragment,e);for(let e=0;e<p.length;e+=1)is(u[e]);c=!0}},o(e){ls(h.$$.fragment,e);for(let e=0;e<u.length;e+=1)ls(u[e]);c=!1},d(e){e&&Ln(t),fs(h);for(let e=0;e<u.length;e+=1)u[e].d()}}}function so(e,t){let n,s;const r=new Ur({props:{weave:t[7]}});return{key:e,first:null,c(){n=In(),hs(r.$$.fragment),this.first=n},m(e,t){Tn(e,n,t),ps(r,e,t),s=!0},p(e,t){const n={};4&t&&(n.weave=e[7]),r.$set(n)},i(e){s||(is(r.$$.fragment,e),s=!0)},o(e){ls(r.$$.fragment,e),s=!1},d(e){e&&Ln(n),fs(r,e)}}}function ro(e){let t,n,s=!e[0]&&no(e);return{c(){s&&s.c(),t=In()},m(e,r){s&&s.m(e,r),Tn(e,t,r),n=!0},p(e,n){e[0]?s&&(os(),ls(s,1,1,()=>{s=null}),as()):s?(s.p(e,n),is(s,1)):(s=no(e),s.c(),is(s,1),s.m(t.parentNode,t))},i(e){n||(is(s),n=!0)},o(e){ls(s),n=!1},d(e){s&&s.d(e),e&&Ln(t)}}}function oo(e){let t,n;const s=new eo({props:{hidden:e[0]}}),r=new Kr({props:{$$slots:{default:[ro]},$$scope:{ctx:e}}});return{c(){hs(s.$$.fragment),t=Wn(),hs(r.$$.fragment)},m(e,o){ps(s,e,o),Tn(e,t,o),ps(r,e,o),n=!0},p(e,[t]){const n={};1&t&&(n.hidden=e[0]),s.$set(n);const o={};1053&t&&(o.$$scope={dirty:t,ctx:e}),r.$set(o)},i(e){n||(is(s.$$.fragment,e),is(r.$$.fragment,e),n=!0)},o(e){ls(s.$$.fragment,e),ls(r.$$.fragment,e),n=!1},d(e){fs(s,e),e&&Ln(t),fs(r,e)}}}function ao(e,t,n){let s,r,o,a=yn;Sn(e,W,e=>n(3,r=e)),Sn(e,q,e=>n(4,o=e)),e.$$.on_destroy.push(()=>a()),Mt.listen(e=>{"`"===e&&n(0,i=!i)});let{hidden:i=-1===window.location.hash.indexOf("dev")}=t;let l,c;return e.$set=e=>{"hidden"in e&&n(0,i=e.hidden)},e.$$.update=()=>{64&e.$$.dirty&&n(2,c=Object.values(s))},n(1,l=Wheel.weaves),a(),a=On(l,e=>n(6,s=e)),[i,l,c,r,o,([e,...t],n)=>{switch(e){case"-":return void Wheel.del({[t[0]]:!0});case"+":1===t.length&&Wheel.spawn({[t[0]]:{}}),3===t.length&&un(t).then(e=>{n(`Added ${e} from Github. `)}).catch(e=>{n(`Couldn't add ${t.join("/")}. `)})}}]}class io extends vs{constructor(e){super(),gs(this,e,ao,oo,En,{hidden:0})}}function lo(e){let t;const n=new io({});return{c(){hs(n.$$.fragment)},m(e,s){ps(n,e,s),t=!0},p:yn,i(e){t||(is(n.$$.fragment,e),t=!0)},o(e){ls(n.$$.fragment,e),t=!1},d(e){fs(n,e)}}}return Wheel.weaves.get()[Wheel.SYSTEM]=wn,new class extends vs{constructor(e){super(),gs(this,e,null,lo,En,{})}}({target:document.body})}(Color,cuid,exprEval,twgl,EXT.piexifjs);

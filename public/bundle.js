var app=function(){"use strict";function t(){}const e=t=>t;function n(t,e){for(const n in e)t[n]=e[n];return t}function a(t){return t()}function r(){return Object.create(null)}function o(t){t.forEach(a)}function i(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function c(t,e,n){const a=e.subscribe(n);t.$$.on_destroy.push(a.unsubscribe?()=>a.unsubscribe():a)}let d="undefined"!=typeof window?()=>window.performance.now():()=>Date.now(),l=t=>requestAnimationFrame(t);const u=new Set;let f,h=!1;function g(){u.forEach(t=>{t[0](d())||(u.delete(t),t[1]())}),(h=u.size>0)&&l(g)}function m(t){let e;return h||(h=!0,l(g)),{promise:new Promise(n=>{u.add(e=[t,n])}),abort(){u.delete(e)}}}function p(t,e){t.appendChild(e)}function $(t,e,n){t.insertBefore(e,n||null)}function v(t){t.parentNode.removeChild(t)}function _(t){return document.createElement(t)}function k(t){return document.createTextNode(t)}function w(){return k(" ")}function y(){return k("")}function b(t,e,n,a){return t.addEventListener(e,n,a),()=>t.removeEventListener(e,n,a)}function x(t,e,n){null==n?t.removeAttribute(e):t.setAttribute(e,n)}function E(t,e){e=""+e,t.data!==e&&(t.data=e)}function S(t,e,n){t.style.setProperty(e,n)}function M(t,e,n){t.classList[n?"add":"remove"](e)}function C(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}let T,A=0,R={};function O(t,e){t.style.animation=(t.style.animation||"").split(", ").filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")).join(", "),e&&!--A&&l(()=>{if(A)return;let t=f.cssRules.length;for(;t--;)f.deleteRule(t);R={}})}function j(t){T=t}function L(t){(function(){if(!T)throw new Error("Function called outside component initialization");return T})().$$.on_mount.push(t)}function z(){const t=T;return(e,n)=>{const a=t.$$.callbacks[e];if(a){const r=C(e,n);a.slice().forEach(e=>{e.call(t,r)})}}}const I=[],N=[],P=[],U=[],W=Promise.resolve();let D,H=!1;function F(t){P.push(t)}function Y(){const t=new Set;do{for(;I.length;){const t=I.shift();j(t),q(t.$$)}for(;N.length;)N.pop()();for(let e=0;e<P.length;e+=1){const n=P[e];t.has(n)||(n(),t.add(n))}P.length=0}while(I.length);for(;U.length;)U.pop()();H=!1}function q(t){t.fragment&&(t.update(t.dirty),o(t.before_update),t.fragment.p(t.dirty,t.ctx),t.dirty=null,t.after_update.forEach(F))}function B(t,e,n){t.dispatchEvent(C(`${e?"intro":"outro"}${n}`))}const K=new Set;let X;function G(){X={remaining:0,callbacks:[]}}function J(){X.remaining||o(X.callbacks)}function Q(t,e){t&&t.i&&(K.delete(t),t.i(e))}function V(t,e,n,a){if(t&&t.o){if(K.has(t))return;K.add(t),X.callbacks.push(()=>{K.delete(t),a&&(n&&t.d(1),a())}),t.o(e)}}function Z(n,a,r){let s,c=a(n,r),l=!0;const u=X;function h(){const{delay:a=0,duration:r=300,easing:i=e,tick:h=t,css:g}=c;g&&(s=function(t,e,n,a,r,o,i,s=0){const c=16.666/a;let d="{\n";for(let t=0;t<=1;t+=c){const a=e+(n-e)*o(t);d+=100*t+`%{${i(a,1-a)}}\n`}const l=d+`100% {${i(n,1-n)}}\n}`,u=`__svelte_${function(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}(l)}_${s}`;if(!R[u]){if(!f){const t=_("style");document.head.appendChild(t),f=t.sheet}R[u]=!0,f.insertRule(`@keyframes ${u} ${l}`,f.cssRules.length)}const h=t.style.animation||"";return t.style.animation=`${h?`${h}, `:""}${u} ${a}ms linear ${r}ms 1 both`,A+=1,u}(n,1,0,r,a,i,g));const p=d()+a,$=p+r;F(()=>B(n,!1,"start")),m(t=>{if(l){if(t>=$)return h(0,1),B(n,!1,"end"),--u.remaining||o(u.callbacks),!1;if(t>=p){const e=i((t-p)/r);h(1-e,e)}}return l})}return u.remaining+=1,i(c)?(D||(D=Promise.resolve()).then(()=>{D=null}),D).then(()=>{c=c(),h()}):h(),{end(t){t&&c.tick&&c.tick(1,0),l&&(s&&O(n,s),l=!1)}}}function tt(t,e){V(t,1,1,()=>{e.delete(t.key)})}function et(t,e){const n={},a={},r={$$scope:1};let o=t.length;for(;o--;){const i=t[o],s=e[o];if(s){for(const t in i)t in s||(a[t]=1);for(const t in s)r[t]||(n[t]=s[t],r[t]=1);t[o]=s}else for(const t in i)r[t]=1}for(const t in a)t in n||(n[t]=void 0);return n}function nt(t){let e;const n=t.subscribe(t=>e=t);return n.unsubscribe?n.unsubscribe():n(),e}function at(t,e,n){const{fragment:r,on_mount:s,on_destroy:c,after_update:d}=t.$$;r.m(e,n),F(()=>{const e=s.map(a).filter(i);c?c.push(...e):o(e),t.$$.on_mount=[]}),d.forEach(F)}function rt(t,e){t.$$.fragment&&(o(t.$$.on_destroy),t.$$.fragment.d(e),t.$$.on_destroy=t.$$.fragment=null,t.$$.ctx={})}function ot(t,e){t.$$.dirty||(I.push(t),H||(H=!0,W.then(Y)),t.$$.dirty=r()),t.$$.dirty[e]=!0}function it(e,n,a,i,s,c){const d=T;j(e);const l=n.props||{},u=e.$$={fragment:null,ctx:null,props:c,update:t,not_equal:s,bound:r(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:[]),callbacks:r(),dirty:null};let f=!1;var h;u.ctx=a?a(e,l,(t,n)=>{u.ctx&&s(u.ctx[t],u.ctx[t]=n)&&(u.bound[t]&&u.bound[t](n),f&&ot(e,t))}):l,u.update(),f=!0,o(u.before_update),u.fragment=i(u.ctx),n.target&&(n.hydrate?u.fragment.l((h=n.target,Array.from(h.childNodes))):u.fragment.c(),n.intro&&Q(e.$$.fragment),at(e,n.target,n.anchor),Y()),j(d)}class st{$destroy(){rt(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}function ct(t){const e=t-1;return e*e*e+1}function dt(t,{delay:e=0,duration:n=400,easing:a=ct,x:r=0,y:o=0,opacity:i=0}){const s=getComputedStyle(t),c=+s.opacity,d="none"===s.transform?"":s.transform,l=c*(1-i);return{delay:e,duration:n,easing:a,css:(t,e)=>`\n\t\t\ttransform: ${d} translate(${(1-t)*r}px, ${(1-t)*o}px);\n\t\t\topacity: ${c-l*e}`}}function lt(n){var a,r,o,i,s,c,d,l,u,f,h;return{c(){a=_("div"),(r=_("h1")).textContent="EarthRock",o=w(),(i=_("h2")).textContent="The Uncollectable Card Game",s=w(),(c=_("button")).textContent="START",d=w(),(l=_("div")).textContent="We don't use cookies or store anything about you server side.",x(r,"class","title svelte-ai31ys"),x(i,"class","desc svelte-ai31ys"),x(c,"class","svelte-ai31ys"),x(l,"class","notice svelte-ai31ys"),x(a,"class","intro svelte-ai31ys"),h=b(c,"click",n.click_handler)},m(t,e){$(t,a,e),p(a,r),p(a,o),p(a,i),p(a,s),p(a,c),p(a,d),p(a,l),f=!0},p:t,i(t){f||(u&&u.end(1),f=!0)},o(t){u=Z(a,dt,{delay:100,duration:1e3,x:0,y:4e3,opacity:0,easing:e}),f=!1},d(t){t&&(v(a),u&&u.end()),h()}}}function ut(t){const e=z();return{dispatch:e,click_handler:function(){return e("start")}}}class ft extends st{constructor(t){super(),it(this,t,ut,lt,s,[])}}const ht="localhost:5000"===window.location.host;function gt(t){var e,n;return{c(){(e=_("div")).textContent="X",x(e,"class","svelte-1uluz44"),n=b(e,"click",t.click_handler)},m(t,n){$(t,e,n)},d(t){t&&v(e),n()}}}function mt(e){var n,a,r,o,i,s=e.audo_playing?"<>":">",c=e.playing&&gt(e);return{c(){n=_("div"),a=_("div"),r=k(s),o=w(),c&&c.c(),x(a,"class","svelte-1uluz44"),x(n,"class","tools svelte-1uluz44"),i=b(a,"click",e.toggle)},m(t,e){$(t,n,e),p(n,a),p(a,r),p(n,o),c&&c.m(n,null)},p(t,e){t.audo_playing&&s!==(s=e.audo_playing?"<>":">")&&E(r,s),e.playing?c||((c=gt(e)).c(),c.m(n,null)):c&&(c.d(1),c=null)},i:t,o:t,d(t){t&&v(n),c&&c.d(),i()}}}function pt(t,e,n){let{playing:a=!1}=e;const r=z(),o=new Audio("/music/earthrock-final-theme.mp3");o.loop=!0,o.volume=.5;let i=!1;const s=()=>{i?o.pause():o.play(),n("audo_playing",i=!i)};return ht||s(),t.$set=(t=>{"playing"in t&&n("playing",a=t.playing)}),{playing:a,dispatch:r,audo_playing:i,toggle:s,click_handler:function(){return r("end")}}}class $t extends st{constructor(t){super(),it(this,t,pt,mt,s,["playing"])}}function vt(e,n=t){let a;const r=[];function o(t){if(s(e,t)){if(e=t,!a)return;r.forEach(t=>t[1]()),r.forEach(t=>t[0](e))}}return{set:o,update:function(t){o(t(e))},subscribe:function(i,s=t){const c=[i,s];return r.push(c),1===r.length&&(a=n(o)||t),i(e),()=>{const t=r.indexOf(c);-1!==t&&r.splice(t,1),0===r.length&&(a(),a=null)}}}}const _t=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}),kt=t=>{const e=[];for(let n=0;n<t;n++)e.push(Math.floor(1024*Math.random()));return e.join(" ")},wt=()=>({id:_t(),name:kt(5),image:kt(25),cost:Math.floor(10*Math.random()),effect1:kt(3),effect2:kt(3),effect3:kt(3)}),yt=t=>{const e=[];for(let n=0;n<t;n++)e.push(wt());return e},bt={faked:!1,tasks:{STATE:new Set},state:{away_deck:vt([]),away_hand:vt([]),away_discard:vt([]),away_field:vt([]),away_back:vt(""),home_deck:vt([]),home_hand:vt([]),home_discard:vt([]),home_field:vt([]),home_back:vt("")},server_fake:()=>{bt.faked=(t=>{const e={away_deck:yt(30),home_deck:yt(30),away_hand:yt(5),home_hand:yt(5),away_back:kt(15),home_back:kt(15),home_discard:[],away_discard:[]},n={PLAY:({id:a})=>{const{home_hand:r,home_discard:o}=e;for(let i=0;i<e.home_hand.length;i++){const s=e.home_hand[i];if(s.id===a)return r.splice(i,1),o.unshift(s),t.do({task:"STATE",data:{home_hand:r,home_discard:o}}),n.SUCCESS()}},DRAW:()=>{const{home_deck:a,home_hand:r}=e;return r.push(a.pop()),t.do({task:"STATE",data:{home_deck:a,home_hand:r}}),n.SUCCESS()},SUCCESS:()=>({code:200,text:"SuCcEsS"}),ERROR_404:()=>({code:404,text:"TaSk NoT FoUnD"})};return t.do({task:"STATE",data:e}),({task:t,data:e})=>n[t]?n[t](e):n.ERROR_404()})(bt)},do:({task:t,data:e})=>{void 0!==bt.tasks[t]?bt.tasks[t].forEach(t=>t(e)):console.error(`Tried to call an undefined task ${t}`)},do_server:async t=>{if(bt.faked)return bt.faked(t);return(await fetch("/do",{method:"POST",mode:"same-origin",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()},when:(t,e)=>{if(void 0!==bt.tasks[t])return bt.tasks[t].add(e),()=>{bt.tasks[t].delete(e)};console.error(`Tried to wait for an undefined task ${t}`)}};bt.when("STATE",t=>Object.entries(t).forEach(([t,e])=>bt.state[t].set(e)));const xt=vt(1),Et=()=>{const[t,e]=[window.innerWidth,window.innerHeight],n=t>e?e:t;xt.set(n/1e3)};window.addEventListener("resize",Et),Et();const St=vt([0,0]),Mt=[0,0];window.addEventListener("mousemove",t=>{Mt[0]=t.clientX,Mt[1]=t.clientY,Mt[0]===nt(St)[0]&&Mt[1]===nt(St)[1]||St.set([...Mt])});const Ct=new Promise(t=>{const e=new Image;e.src="/sheets/default.png",e.onload=(()=>{const n=document.createElement("canvas");n.width=e.width,n.height=e.height;const a=n.getContext("2d");a.drawImage(e,0,0),t({ctx:a,canvas:n})})}),Tt=new Map,At=(t,e)=>Math.floor(Math.random()*(Math.abs(t)+Math.abs(e))-Math.abs(t));var Rt=async({width:t,height:e,data:n,random:a=!1})=>{const{canvas:r}=await Ct,o=`${t}:${e}:${n}`;if(!a&&Tt.has(o))return Tt.get(o);let i=document.createElement("canvas");const s=i.getContext("2d");if(i.width=16*t,i.height=16*e,a){let n,a,o,i;for(let c=0;c<t;c++)for(let t=0;t<e;t++)n=16*c,a=16*t,o=17*At(0,32),i=17*At(0,32),s.drawImage(r,o,i,16,16,n,a,16,16)}else if(n.length>0){let e,a;n.split(" ").forEach((n,o)=>{e=o%t,a=Math.floor(o/t);let i=parseInt(n,10),c=i%32,d=Math.floor(i/32),l=16*e,u=16*a,f=17*c,h=17*d;s.drawImage(r,f,h,16,16,l,u,16,16)})}const c=i.toDataURL("image/png");return a||Tt.set(KeyboardEvent,c),c};function Ot(e){var n;return{c(){x(n=_("img"),"class","tileset svelte-1bdmb53"),x(n,"alt","tileset image")},m(t,a){$(t,n,a),e.img_binding(n)},p:t,i:t,o:t,d(t){t&&v(n),e.img_binding(null)}}}function jt(t,e,n){let a,{data:r="",width:o=10,height:i=7,spacing:s=0,random:c=!1}=e;return L(async()=>{a.src=await Rt({width:o,height:i,data:r,random:c}),n("image",a)}),t.$set=(t=>{"data"in t&&n("data",r=t.data),"width"in t&&n("width",o=t.width),"height"in t&&n("height",i=t.height),"spacing"in t&&n("spacing",s=t.spacing),"random"in t&&n("random",c=t.random)}),{data:r,width:o,height:i,spacing:s,random:c,image:a,img_binding:function(t){N[t?"unshift":"push"](()=>{n("image",a=t)})}}}class Lt extends st{constructor(t){super(),it(this,t,jt,Ot,s,["data","width","height","spacing","random"])}}function zt(t,e,n){const a=Object.create(t);return a.line=e[n],a}function It(t){var e,n,a,r,o,i,s;return{c(){e=_("div"),n=w(),a=_("div"),r=w(),o=_("div"),i=w(),s=_("div"),x(e,"class","border border-top svelte-1k8whng"),x(a,"class","border border-bottom svelte-1k8whng"),x(o,"class","border border-left svelte-1k8whng"),x(s,"class","border border-right svelte-1k8whng")},m(t,c){$(t,e,c),$(t,n,c),$(t,a,c),$(t,r,c),$(t,o,c),$(t,i,c),$(t,s,c)},d(t){t&&(v(e),v(n),v(a),v(r),v(o),v(i),v(s))}}}function Nt(t){var e,n,a,r,o,i,s,c,d,l,u,f,h,g=t.vitals[0],m=t.vitals[1],y=new Lt({props:{width:1,height:1,random:!0}}),b=new Lt({props:{width:1,height:1,random:!0}}),S=new Lt({props:{width:1,height:1,random:!0}});return{c(){e=_("div"),n=_("div"),a=_("div"),y.$$.fragment.c(),r=w(),o=_("div"),i=_("div"),b.$$.fragment.c(),s=w(),c=k(g),d=w(),l=_("div"),S.$$.fragment.c(),u=w(),f=k(m),x(a,"class","tile svelte-1k8whng"),x(n,"class","icon svelte-1k8whng"),x(i,"class","tile svelte-1k8whng"),x(l,"class","tile svelte-1k8whng"),x(o,"class","vitals svelte-1k8whng"),x(e,"class","line svelte-1k8whng")},m(t,g){$(t,e,g),p(e,n),p(n,a),at(y,a,null),p(e,r),p(e,o),p(o,i),at(b,i,null),p(o,s),p(o,c),p(o,d),p(o,l),at(S,l,null),p(o,u),p(o,f),h=!0},p(t,e){h&&!t.vitals||g===(g=e.vitals[0])||E(c,g),h&&!t.vitals||m===(m=e.vitals[1])||E(f,m)},i(t){h||(Q(y.$$.fragment,t),Q(b.$$.fragment,t),Q(S.$$.fragment,t),h=!0)},o(t){V(y.$$.fragment,t),V(b.$$.fragment,t),V(S.$$.fragment,t),h=!1},d(t){t&&v(e),rt(y),rt(b),rt(S)}}}function Pt(t){for(var e,n,a,r,i,s,c,d,l,u,f,h,g,m,y,C,T,A,R,O,j,L,z,I=t.borders&&It(),N=new Lt({props:{width:3,height:5,data:t.back}}),P=new Lt({props:{data:t.name,width:5,height:1}}),U=new Lt({props:{width:5,height:5,data:t.image}}),W=t.lines,D=[],H=0;H<W.length;H+=1)D[H]=Nt(zt(t,W,H));const F=t=>V(D[t],1,1,()=>{D[t]=null});return{c(){e=_("div"),n=_("div"),I&&I.c(),a=w(),r=_("div"),N.$$.fragment.c(),i=w(),s=_("div"),c=_("div"),d=_("div"),P.$$.fragment.c(),l=w(),u=_("div"),f=w(),h=_("div"),g=k(t.cost),m=w(),y=_("div"),U.$$.fragment.c(),C=w(),T=_("div");for(var o=0;o<D.length;o+=1)D[o].c();A=w(),R=_("div"),O=w(),(j=_("div")).textContent="E A R T H R O C K",x(r,"class","back svelte-1k8whng"),S(r,"filter","sepia(1) hue-rotate("+t.color+"deg) brightness("+(t.fade?.5:1)+")"),x(d,"class","title svelte-1k8whng"),x(u,"class","flex svelte-1k8whng"),x(h,"class","cost svelte-1k8whng"),x(c,"class","header svelte-1k8whng"),x(y,"class","image svelte-1k8whng"),x(R,"class","flex svelte-1k8whng"),x(T,"class","details svelte-1k8whng"),x(j,"class","earthrock svelte-1k8whng"),x(s,"class","front svelte-1k8whng"),x(n,"class","contents svelte-1k8whng"),M(n,"flip",t.flip),x(e,"style",t.style),x(e,"class","card svelte-1k8whng"),M(e,"fade",t.fade),M(e,"dragging",t.dragging),z=[b(r,"click",t.beginInteract),b(s,"mousedown",t.beginInteract),b(e,"mouseenter",t.delay_hover.on),b(e,"mouseleave",t.delay_hover.off)]},m(t,o){$(t,e,o),p(e,n),I&&I.m(n,null),p(n,a),p(n,r),at(N,r,null),p(n,i),p(n,s),p(s,c),p(c,d),at(P,d,null),p(c,l),p(c,u),p(c,f),p(c,h),p(h,g),p(s,m),p(s,y),at(U,y,null),p(s,C),p(s,T);for(var v=0;v<D.length;v+=1)D[v].m(T,null);p(T,A),p(T,R),p(s,O),p(s,j),L=!0},p(t,o){o.borders?I||((I=It()).c(),I.m(n,a)):I&&(I.d(1),I=null);var i={};t.back&&(i.data=o.back),N.$set(i),(!L||t.color||t.fade)&&S(r,"filter","sepia(1) hue-rotate("+o.color+"deg) brightness("+(o.fade?.5:1)+")");var s={};t.name&&(s.data=o.name),P.$set(s),L&&!t.cost||E(g,o.cost);var c={};if(t.image&&(c.data=o.image),U.$set(c),t.vitals||t.lines){W=o.lines;for(var d=0;d<W.length;d+=1){const e=zt(o,W,d);D[d]?(D[d].p(t,e),Q(D[d],1)):(D[d]=Nt(e),D[d].c(),Q(D[d],1),D[d].m(T,A))}for(G(),d=W.length;d<D.length;d+=1)F(d);J()}t.flip&&M(n,"flip",o.flip),L&&!t.style||x(e,"style",o.style),t.fade&&M(e,"fade",o.fade),t.dragging&&M(e,"dragging",o.dragging)},i(t){if(!L){Q(N.$$.fragment,t),Q(P.$$.fragment,t),Q(U.$$.fragment,t);for(var e=0;e<W.length;e+=1)Q(D[e]);L=!0}},o(t){V(N.$$.fragment,t),V(P.$$.fragment,t),V(U.$$.fragment,t),D=D.filter(Boolean);for(let t=0;t<D.length;t+=1)V(D[t]);L=!1},d(t){t&&v(e),I&&I.d(),rt(N),rt(P),rt(U),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(D,t),o(z)}}}const Ut=.5;function Wt(t,e,n){let a;c(t,St,t=>{n("$mouse_pos",a=t)});const r=z();let{deck:o="",id:i="foobar",cost:s=0,name:d="16 55 33 44 55",image:l="",effect1:u="",effect2:f="",effect3:h="",back:g="",borders:m=!0,vitals:p=[1,1],invert:$=!1,interact:v=!0,drag:_=!1,position:k=[0,0],position_raw:w=!1,rotation:y=0,scale:b=1,color:x=90,card:E={},young:S=!0,fade:M=!1,anchor:C=[50,50]}=e;const T=[u,f,h];let A=!0;L(()=>{setTimeout(()=>{n("young",S=!1),n("flip",A=!v)},250)});let R=!1;const O=(({time:t=250,on:e=(()=>{}),off:n=(()=>{})})=>{let a;return{on:()=>{v&&(a&&clearTimeout(a),e())},off:()=>{v&&(a&&clearTimeout(a),a=setTimeout(()=>{a=0,n()},t))}}})({time:100,on:()=>{n("hover",F=!0)},off:()=>{const t=F=!1;return n("hover",F),t}});let j,I,N,P,U,W,D,H,F=!1;return t.$set=(t=>{"deck"in t&&n("deck",o=t.deck),"id"in t&&n("id",i=t.id),"cost"in t&&n("cost",s=t.cost),"name"in t&&n("name",d=t.name),"image"in t&&n("image",l=t.image),"effect1"in t&&n("effect1",u=t.effect1),"effect2"in t&&n("effect2",f=t.effect2),"effect3"in t&&n("effect3",h=t.effect3),"back"in t&&n("back",g=t.back),"borders"in t&&n("borders",m=t.borders),"vitals"in t&&n("vitals",p=t.vitals),"invert"in t&&n("invert",$=t.invert),"interact"in t&&n("interact",v=t.interact),"drag"in t&&n("drag",_=t.drag),"position"in t&&n("position",k=t.position),"position_raw"in t&&n("position_raw",w=t.position_raw),"rotation"in t&&n("rotation",y=t.rotation),"scale"in t&&n("scale",b=t.scale),"color"in t&&n("color",x=t.color),"card"in t&&n("card",E=t.card),"young"in t&&n("young",S=t.young),"fade"in t&&n("fade",M=t.fade),"anchor"in t&&n("anchor",C=t.anchor)}),t.$$.update=((t={hover:1,scale:1,rotation:1,invert:1,dragging:1,anchor:1,tru_anchor:1,$mouse_pos:1,tru_width:1,tru_height:1,position_raw:1,tru_rotation:1,tru_scale:1,position:1,tru_invert:1,transforms:1})=>{(t.hover||t.scale)&&n("tru_scale",j=F?1.168*b:b),(t.hover||t.rotation)&&n("tru_rotation",I=F?0:y),t.invert&&n("tru_invert",N=$?-1:1),(t.dragging||t.anchor)&&n("tru_anchor",P=R?[50,50]:C),t.tru_anchor&&n("tru_width",U=250*(P[0]<=50?-1:1)),t.tru_anchor&&n("tru_height",W=400*(P[1]<=50?-1:1)),(t.dragging||t.$mouse_pos||t.tru_width||t.tru_height||t.position_raw||t.tru_rotation||t.tru_scale||t.position||t.hover||t.tru_invert)&&n("transforms",D=R?`transform: translate(${a[0]-window.innerWidth/2+U}px, ${a[1]-window.innerHeight/2+W}px) rotate(0deg) scale(${Ut});z-index: 100`:w?`transform: translate(${w[0]-window.innerWidth/2-U}px, ${w[1]-window.innerHeight/2-W}px) rotate(${I}deg) scale(${j}) ; z-index: ${Math.round(100*j)}`:`transform: translate(${5*k[0]+U}px, ${8*(k[1]+(F?-5*N:0))+W}px) rotate(${I}deg) scale(${j}) ; z-index: ${Math.round(100*j)}`),(t.transforms||t.tru_anchor)&&n("style",H=[D,P[0]<=50?`left: ${P[0]}%`:`right: ${100-P[0]}%`,P[1]<=50?`top: ${P[1]}%`:`bottom: ${100-P[1]}%`].join(";"))}),{deck:o,id:i,cost:s,name:d,image:l,effect1:u,effect2:f,effect3:h,back:g,borders:m,vitals:p,invert:$,interact:v,drag:_,position:k,position_raw:w,rotation:y,scale:b,color:x,card:E,young:S,fade:M,anchor:C,lines:T,flip:A,dragging:R,beginInteract:()=>{if(r("click",E),_){n("dragging",R=!0);const t=window.addEventListener("mouseup",()=>{r("dragend",E),n("dragging",R=!1),window.removeEventListener("mouseup",t)})}},delay_hover:O,style:H}}class Dt extends st{constructor(t){super(),it(this,t,Wt,Pt,s,["deck","id","cost","name","image","effect1","effect2","effect3","back","borders","vitals","invert","interact","drag","position","position_raw","rotation","scale","color","card","young","fade","anchor"])}}function Ht(t,e,n){const a=Object.create(t);return a.card=e[n],a.index=n,a}function Ft(t){var e,a=[t.card,{scale:t.scale*t.$scaling},{invert:t.invert},{interact:t.interact},{color:t.color},{card:t.card},{drag:t.drag},{fade:t.fade},{anchor:t.anchor},{back:t.$back},{position:90===t.Math.abs(t.rotation)?[t.position[0],t.position[1]+t.tru_index(t.index)*t.tru_spread-t.tru_length/2*t.tru_spread]:[t.position[0]+t.tru_index(t.index)*t.tru_spread-t.tru_length/2*t.tru_spread,t.position[1]+(t.invert?-1:1)*t.Math.abs(t.tru_index(t.index)-t.tru_length/2)*t.spread_y]},{rotation:t.rotation+(t.tru_index(t.index)-t.tru_length/2)*t.tru_rotate*(t.invert?-1:1)+(t.invert?180:0)}];let r={};for(var o=0;o<a.length;o+=1)r=n(r,a[o]);var i=new Dt({props:r});return i.$on("dragend",t.dragend_handler),i.$on("click",t.click_handler),{c(){i.$$.fragment.c()},m(t,n){at(i,t,n),e=!0},p(t,e){var n=t.$cards||t.scale||t.$scaling||t.invert||t.interact||t.color||t.drag||t.fade||t.anchor||t.$back||t.Math||t.rotation||t.position||t.tru_index||t.tru_spread||t.tru_length||t.spread_y||t.tru_rotate?et(a,[t.$cards&&e.card,(t.scale||t.$scaling)&&{scale:e.scale*e.$scaling},t.invert&&{invert:e.invert},t.interact&&{interact:e.interact},t.color&&{color:e.color},t.$cards&&{card:e.card},t.drag&&{drag:e.drag},t.fade&&{fade:e.fade},t.anchor&&{anchor:e.anchor},t.$back&&{back:e.$back},(t.Math||t.rotation||t.position||t.tru_index||t.$cards||t.tru_spread||t.tru_length||t.invert||t.spread_y)&&{position:90===e.Math.abs(e.rotation)?[e.position[0],e.position[1]+e.tru_index(e.index)*e.tru_spread-e.tru_length/2*e.tru_spread]:[e.position[0]+e.tru_index(e.index)*e.tru_spread-e.tru_length/2*e.tru_spread,e.position[1]+(e.invert?-1:1)*e.Math.abs(e.tru_index(e.index)-e.tru_length/2)*e.spread_y]},(t.rotation||t.tru_index||t.$cards||t.tru_length||t.tru_rotate||t.invert)&&{rotation:e.rotation+(e.tru_index(e.index)-e.tru_length/2)*e.tru_rotate*(e.invert?-1:1)+(e.invert?180:0)}]):{};i.$set(n)},i(t){e||(Q(i.$$.fragment,t),e=!0)},o(t){V(i.$$.fragment,t),e=!1},d(t){rt(i,t)}}}function Yt(t,e){var n,a,r,o=e.tru_index(e.index)<e.max&&Ft(e);return{key:t,first:null,c(){n=y(),o&&o.c(),a=y(),this.first=n},m(t,e){$(t,n,e),o&&o.m(t,e),$(t,a,e),r=!0},p(t,e){e.tru_index(e.index)<e.max?o?(o.p(t,e),Q(o,1)):((o=Ft(e)).c(),Q(o,1),o.m(a.parentNode,a)):o&&(G(),V(o,1,1,()=>{o=null}),J())},i(t){r||(Q(o),r=!0)},o(t){V(o),r=!1},d(t){t&&v(n),o&&o.d(t),t&&v(a)}}}function qt(t){var e,n,a=[],r=new Map,o=t.$cards;const i=t=>t.card.id;for(var s=0;s<o.length;s+=1){let e=Ht(t,o,s),n=i(e);r.set(n,a[s]=Yt(n,e))}return{c(){for(s=0;s<a.length;s+=1)a[s].c();e=y()},m(t,r){for(s=0;s<a.length;s+=1)a[s].m(t,r);$(t,e,r),n=!0},p(t,n){const o=n.$cards;G(),a=function(t,e,n,a,r,o,i,s,c,d,l,u){let f=t.length,h=o.length,g=f;const m={};for(;g--;)m[t[g].key]=g;const p=[],$=new Map,v=new Map;for(g=h;g--;){const t=u(r,o,g),s=n(t);let c=i.get(s);c?a&&c.p(e,t):(c=d(s,t)).c(),$.set(s,p[g]=c),s in m&&v.set(s,Math.abs(g-m[s]))}const _=new Set,k=new Set;function w(t){Q(t,1),t.m(s,l),i.set(t.key,t),l=t.first,h--}for(;f&&h;){const e=p[h-1],n=t[f-1],a=e.key,r=n.key;e===n?(l=e.first,f--,h--):$.has(r)?!i.has(a)||_.has(a)?w(e):k.has(r)?f--:v.get(a)>v.get(r)?(k.add(a),w(e)):(_.add(r),f--):(c(n,i),f--)}for(;f--;){const e=t[f];$.has(e.key)||c(e,i)}for(;h;)w(p[h-1]);return p}(a,t,i,1,n,o,r,e.parentNode,tt,Yt,e,Ht),J()},i(t){if(!n){for(var e=0;e<o.length;e+=1)Q(a[e]);n=!0}},o(t){for(s=0;s<a.length;s+=1)V(a[s]);n=!1},d(t){for(s=0;s<a.length;s+=1)a[s].d(t);t&&v(e)}}}function Bt(t,e,n){let a,r,o;c(t,xt,t=>{n("$scaling",r=t)});const i=z();let{cards:s=vt([]),max:d=10,position:l=[0,0],anchor:u=[50,50],invert:f=!1,fade:h=!1,drag:g=!1,reverse:m=!1,scale:p=1,spread:$=10,spread_y:v=1,interact:_=!0,rotate:k=3,rotation:w=0,color:y=90}=e;c(t,s,t=>{n("$cards",a=t)});let{back:b=vt("")}=e;c(t,b,t=>{n("$back",o=t)});let x,E,S,M;return t.$set=(t=>{"cards"in t&&n("cards",s=t.cards),"max"in t&&n("max",d=t.max),"position"in t&&n("position",l=t.position),"anchor"in t&&n("anchor",u=t.anchor),"invert"in t&&n("invert",f=t.invert),"fade"in t&&n("fade",h=t.fade),"drag"in t&&n("drag",g=t.drag),"reverse"in t&&n("reverse",m=t.reverse),"scale"in t&&n("scale",p=t.scale),"spread"in t&&n("spread",$=t.spread),"spread_y"in t&&n("spread_y",v=t.spread_y),"interact"in t&&n("interact",_=t.interact),"rotate"in t&&n("rotate",k=t.rotate),"rotation"in t&&n("rotation",w=t.rotation),"color"in t&&n("color",y=t.color),"back"in t&&n("back",b=t.back)}),t.$$.update=((t={$cards:1,max:1,tru_length:1,spread:1,x_factor:1,$scaling:1,rotate:1})=>{(t.$cards||t.max)&&n("tru_length",x=a.length>d?d:a.length),(t.tru_length||t.max)&&n("x_factor",E=Math.max(x/d,.5)),(t.spread||t.x_factor||t.$scaling)&&n("tru_spread",S=$/E*r),(t.rotate||t.x_factor)&&n("tru_rotate",M=k/E)}),{dispatch:i,cards:s,max:d,position:l,anchor:u,invert:f,fade:h,drag:g,reverse:m,scale:p,spread:$,spread_y:v,interact:_,rotate:k,rotation:w,color:y,back:b,tru_index:t=>m?a.length-t:t,tru_length:x,$cards:a,Math:Math,tru_spread:S,$scaling:r,tru_rotate:M,$back:o,dragend_handler:function({detail:t}){return i("dragend",t)},click_handler:function({detail:t}){return i("click",t)}}}class Kt extends st{constructor(t){super(),it(this,t,Bt,qt,s,["cards","max","position","anchor","invert","fade","drag","reverse","scale","spread","spread_y","interact","rotate","rotation","color","back"])}}function Xt(t){var e,a,r,o,i,s,c,d,l=new Kt({props:{cards:bt.state.home_hand,scale:Gt,position:[0,0],back:bt.state.home_back,drag:!0,anchor:[50,90]}});l.$on("dragend",t.dragend_handler);var u=[t.deck,{anchor:[90,70]},{cards:bt.state.home_deck},{position:[0,0]},{back:bt.state.home_back}];let f={};for(var h=0;h<u.length;h+=1)f=n(f,u[h]);var g=new Kt({props:f});g.$on("click",t.click_handler);var m=[t.discard,{cards:bt.state.home_discard},{position:[0,0]},{anchor:[0,90]},{back:bt.state.home_back}];let k={};for(h=0;h<m.length;h+=1)k=n(k,m[h]);var y=new Kt({props:k}),b=new Kt({props:{cards:bt.state.away_hand,scale:Gt,anchor:[50,0],interact:!1,color:180,invert:!0,back:bt.state.away_back}}),E=[t.deck,{cards:bt.state.away_deck},{color:180},{anchor:[90,30]},{back:bt.state.away_back}];let S={};for(h=0;h<E.length;h+=1)S=n(S,E[h]);var M=new Kt({props:S}),C=[t.discard,{cards:bt.state.away_discard},{anchor:[0,10]},{back:bt.state.away_back}];let T={};for(h=0;h<C.length;h+=1)T=n(T,C[h]);var A=new Kt({props:T});return{c(){e=_("div"),l.$$.fragment.c(),a=w(),g.$$.fragment.c(),r=w(),y.$$.fragment.c(),o=w(),b.$$.fragment.c(),i=w(),M.$$.fragment.c(),s=w(),A.$$.fragment.c(),x(e,"class","game svelte-1bvhcmr")},m(t,n){$(t,e,n),at(l,e,null),p(e,a),at(g,e,null),p(e,r),at(y,e,null),p(e,o),at(b,e,null),p(e,i),at(M,e,null),p(e,s),at(A,e,null),d=!0},p(t,e){var n={};t.game&&(n.cards=bt.state.home_hand),t.scale&&(n.scale=Gt),t.game&&(n.back=bt.state.home_back),l.$set(n);var a=t.deck||t.game?et(u,[t.deck&&e.deck,{anchor:[90,70]},t.game&&{cards:bt.state.home_deck},{position:[0,0]},t.game&&{back:bt.state.home_back}]):{};g.$set(a);var r=t.discard||t.game?et(m,[t.discard&&e.discard,t.game&&{cards:bt.state.home_discard},{position:[0,0]},{anchor:[0,90]},t.game&&{back:bt.state.home_back}]):{};y.$set(r);var o={};t.game&&(o.cards=bt.state.away_hand),t.scale&&(o.scale=Gt),t.game&&(o.back=bt.state.away_back),b.$set(o);var i=t.deck||t.game?et(E,[t.deck&&e.deck,t.game&&{cards:bt.state.away_deck},{color:180},{anchor:[90,30]},t.game&&{back:bt.state.away_back}]):{};M.$set(i);var s=t.discard||t.game?et(C,[t.discard&&e.discard,t.game&&{cards:bt.state.away_discard},{anchor:[0,10]},t.game&&{back:bt.state.away_back}]):{};A.$set(s)},i(t){d||(Q(l.$$.fragment,t),Q(g.$$.fragment,t),Q(y.$$.fragment,t),Q(b.$$.fragment,t),Q(M.$$.fragment,t),Q(A.$$.fragment,t),c&&c.end(1),d=!0)},o(t){V(l.$$.fragment,t),V(g.$$.fragment,t),V(y.$$.fragment,t),V(b.$$.fragment,t),V(M.$$.fragment,t),V(A.$$.fragment,t),c=Z(e,dt,{delay:100,duration:1e3,x:0,y:1e3,opacity:0}),d=!1},d(t){t&&v(e),rt(l),rt(g),rt(y),rt(b),rt(M),rt(A),t&&c&&c.end()}}}const Gt=.25;function Jt(t){const e={scale:Gt,spread:0,max:4,reverse:!0,interact:!1},n={scale:Gt,spread:5,spread_y:0,rotate:0,rotation:90,fade:!0,drag:!0,max:10};return bt.server_fake(),{deck:e,discard:n,dragend_handler:function({detail:{id:t}}){bt.do_server({task:"PLAY",data:{id:t}})},click_handler:function(){bt.do_server({task:"DRAW"})}}}class Qt extends st{constructor(t){super(),it(this,t,Jt,Xt,s,[])}}function Vt(t){var e,n=new ft({});return n.$on("start",t.start),{c(){n.$$.fragment.c()},m(t,a){at(n,t,a),e=!0},i(t){e||(Q(n.$$.fragment,t),e=!0)},o(t){V(n.$$.fragment,t),e=!1},d(t){rt(n,t)}}}function Zt(t){var e,n=new Qt({});return n.$on("end",t.end),{c(){n.$$.fragment.c()},m(t,a){at(n,t,a),e=!0},i(t){e||(Q(n.$$.fragment,t),e=!0)},o(t){V(n.$$.fragment,t),e=!1},d(t){rt(n,t)}}}function te(t){var e,n,a,r,o,i,s=[Zt,Vt],c=[];function d(t){return t.playing?0:1}e=d(t),n=c[e]=s[e](t);var l=new $t({props:{playing:t.playing}});l.$on("end",t.end);var u=new Lt({props:{random:!0}});return{c(){n.c(),a=w(),l.$$.fragment.c(),r=w(),o=_("div"),u.$$.fragment.c(),x(o,"class","background svelte-135avyh")},m(t,n){c[e].m(t,n),$(t,a,n),at(l,t,n),$(t,r,n),$(t,o,n),at(u,o,null),i=!0},p(t,r){var o=e;(e=d(r))!==o&&(G(),V(c[o],1,1,()=>{c[o]=null}),J(),(n=c[e])||(n=c[e]=s[e](r)).c(),Q(n,1),n.m(a.parentNode,a));var i={};t.playing&&(i.playing=r.playing),l.$set(i)},i(t){i||(Q(n),Q(l.$$.fragment,t),Q(u.$$.fragment,t),i=!0)},o(t){V(n),V(l.$$.fragment,t),V(u.$$.fragment,t),i=!1},d(t){c[e].d(t),t&&v(a),rt(l,t),t&&(v(r),v(o)),rt(u)}}}function ee(t,e,n){let a="/play"===window.location.pathname;return{playing:a,start:()=>{n("playing",a=!0),history.pushState({page:1},"","/play")},end:()=>{n("playing",a=!1),history.pushState({page:1},"","/")}}}return new class extends st{constructor(t){super(),it(this,t,ee,te,s,[])}}({target:document.body,props:{name:"stage"}})}();

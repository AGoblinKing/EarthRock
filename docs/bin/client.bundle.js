var app=function(e,t,n,s,r,a,o){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,n=n&&n.hasOwnProperty("default")?n.default:n,s=s&&s.hasOwnProperty("default")?s.default:s,r=r&&r.hasOwnProperty("default")?r.default:r,a=a&&a.hasOwnProperty("default")?a.default:a;const i=(e,t=!1)=>t?{__proto__:e,...t}:t=>i(e,t),l=e=>t=>Object.fromEntries(Object.entries(e).reduce((e,[n,s])=>{const r=t([n,s]);return r&&e.push(r),e},[])),c=e=>t=>Object.entries(e).forEach(t),u=e=>(t,n)=>Object.entries(e).reduce(t,n),d=Object.keys,h=Object.values,p=e=>u(e.get())((e,[t,n])=>"&"===t[0]?e:(e[t]=n.toJSON(),e),{}),f={toJSON(){switch(typeof this.value){case"undefined":case"number":case"string":return this.value;case"object":if(Array.isArray(this.value)||null===this.value)return this.value;if(this.value.toJSON)return this.value.toJSON()}return JSON.parse(JSON.stringify(this.value))}},g=new Set,m=()=>{requestAnimationFrame(m),g.clear()};m();const v=i(f,{get(){return this.value},notify(){if(this.subs){if(g.has(this))return requestAnimationFrame(()=>{g.has(this)||this.notify()});g.add(this),this.subs.forEach(e=>e(this.value))}},subscribe(e,t=!1){return this.subs||(this.subs=new Set),this.subs.add(e),t||e(this.value),()=>this.subs.delete(e)},listen(e){return this.subscribe(e)}}),$=(e,t)=>{const n=i(v,(e=>i(f,{value:e}))(e));return t&&t(e=>{n.value=e,n.notify(e)}),n},w=i(v,{set(e,t=!1){this.value=void 0===e?null:e,t||this.notify()},update(e){this.set(e(this.value))}}),y=e=>i(w,$(e)),_=i(w,{get(e=!1){const t=w.get.call(this);return!1===e?t:t[e]},set(e,t=!1){this.value=e;const{previous:n}=this,s=[];t||this.notify({add:d(e).filter(t=>{const r=void 0===n[t];return r||n[t]===e[t]||s.push(t),r}),remove:d(n).filter(t=>void 0===e[t]),modify:s,previous:n}),this.previous={__proto__:e.__proto__,...e}},subscribe(e){return e(this.value,{add:d(this.value),remove:[],modify:[],previous:this.value}),w.subscribe.call(this,e,!0)},notify(e){this.subs&&e&&this.subs.forEach(t=>t(this.value,e))}}),b=(e={})=>i(_,{...y(e),previous:{...e}}),x=i(_,{has(e){return void 0!==this.get(e)},get(e=!1){const t=_.get.call(this);return!1===e?t:t[e]},set(e,t=!1){const n={__proto__:e.__proto__,...l(e)(([e,t])=>[e,this.convert(t)])};_.set.call(this,n,t)},convert(e){return e&&"function"==typeof e.subscribe?e:this.fn?y(this.fn(e)):y(e)},add(e,t){return this.set(Object.assign(this.get(),e),t),this},write(e,t){const n={};c(e)(([e,t])=>{const s=this.get()[e];s?s.set(t):n[e]="object"==typeof t&&null!==t&&t.get?t:y(t)}),Object.keys(n).length>0&&this.add(n,t)},remove(e){const t=this.get();delete t[e],_.set.call(this,t)},toJSON(){return p(this)}}),k=(e={},t=!1)=>{const n=i(x,{...b({}),fn:t});return n.set(e),n},E=i(w,{set(e){return w.set.call(this,this.transform(e)),this}}),z=e=>i(E,{...y(),transform:e}),O=y(100),S=$("/sheets/default_2.png"),j=$("localhost:5000"===window.location.host),A=y(!0),M=y({delay:100,duration:300}),N=y(!0),C=y(!1),L=y(10),T=y(.01),F=y(.1),I=$(1024),R=$(32),W=y("rgb(224, 168, 83)"),D=y("#033"),P=y("green"),q=y("#023d55"),J=y("/sys"),B=$("",t=>D.listen(n=>t(e(n).darkenByRatio(.5).toCSS()))),U=$("",e=>{let t="";B.listen(n=>{t=n,e([`border: 0.2rem solid ${t};`].join(""))})});var H=Object.freeze({__proto__:null,TIME_TICK_RATE:O,SPRITES:S,IS_DEV:j,SOUND_ON:A,SVELTE_ANIMATION:M,WEAVE_EXPLORE_OPEN:N,OMNI_LAST:C,INPUT_SCROLL_STRENGTH:L,INPUT_ZOOM_STRENGTH:T,INPUT_ZOOM_MIN:F,TILE_COUNT:I,TILE_COLUMNS:R,THEME_COLOR:W,THEME_BG:D,THEME_GLOW:P,CLEAR_COLOR:q,CURSOR:J,THEME_BORDER:B,THEME_STYLE:U});const G=e=>{if(!e)return"#111";let t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);let n="#";for(let e=0;e<3;e++){n+=("00"+(t>>8*e&255).toString(16)).substr(-2)}return n},Y=["groovy","cat","bird","dog","poop","cool","not","okay","great","terrible","wat","goblin","life","ferret","gregert","robert","zilla","red","shirt","pants","blue","luna","ember","embear","lunatic","boring","killa","notice","thank","tank","under","near","near","quaint","potato","egg","bacon","narwhal","lamp","stairs","king","tyrant","grave","dire","happy","amazing","terrific","terrible","good","boring","rip","hello","world","global","universal","television","computer"],V=e=>{let t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);return`${Math.abs(t)%I.get()}`},X=e=>Array.from(new Array(e)).map(()=>Y[Math.floor(Math.random()*Y.length)]).join(" "),K={get_space(){const e=this.id.get();let t;const n=e=>{if(-1!==e.indexOf("/"))return t=e.split("/")[0],!0};return this.weave.chain(e).some(n),void 0===t&&this.weave.chain(e,!0).some(n),this.weave.get_id(t)},listen(e){return this.value.listen(e)},get(){return this.value.get()},set(e){return this.value.set(e)},toJSON(){return{type:this.type.get(),value:this.value.toJSON()}}};var Z=i({cancel(){const e=[...this.birds];requestAnimationFrame(()=>{this.weave.remove(...e)})},rez(){const{value:e,space:n,weave:s}=this;this.birds=[],n.get("count")||n.write({count:1},!0);let r="",a=0;this.value_cancel=((...e)=>t=>{const n=e.map(e=>e.get()),s=e.map((e,s)=>e.listen((e,r)=>{n[s]=e,t(...n)}));return()=>s.forEach(e=>e())})(e,n.get("count"))((e,o)=>{if(r===e&&o===a)return;r=e,a=o,this.cancel();const i=Object.fromEntries([...Array(o)].map((s,r)=>[`&${t()}`,{type:"space",value:{"!clone":e,"!leader":`~/${n.value.get("!name").get()}`,"!bird":r}}]));requestAnimationFrame(()=>{this.birds=Object.values(s.write_ids(i)).map(e=>e.id.get()),this.weave.rez(...this.birds)})})},derez(){this.value_cancel(),this.cancel()}});const Q={stream:e=>JSON.stringify(e.value.get()),math:e=>e.math.get().trim(),mail:e=>e.whom.get().trim(),default:e=>e.warp.get(),space:e=>`./${e.value.get("!name")}`,sprite:e=>`@${e.value.get()}`,color:e=>`#${e.value.get()}`},ee={color:e=>"#"===e[0],sprite:e=>"@"===e[0],mail:e=>{const t=e.match(Wheel.REG_ID);return!(!t||1!==t.length)&&t[0]===e},stream:e=>{try{return JSON.parse(e),!0}catch(e){return!1}}},te={math:e=>({type:"math",math:e}),mail:e=>({type:"mail",whom:e}),stream:e=>({type:"stream",value:JSON.parse(e)}),color:e=>({type:"color",value:e.slice(1)}),sprite:e=>{let t=parseInt(e.slice(1));return isNaN(t)&&(t=66),{type:"sprite",value:t}}},ne=e=>{const t=(e=>{const t=Object.entries(ee);for(let n=0;n<t.length;n++){const[s,r]=t[n];if(r(e))return s}return"math"})(e);return te[t](e)},se=(e,t,n)=>n?e.chain(t,!0).slice(1):e.chain(t).slice(0,-1),re=({address:e,weave:t,right:n=!1})=>{const s=se(t,e,n).map(e=>ae(e,t));return n?s.reverse().join(" => "):s.join(" => ")},ae=(e,t)=>{if("{"===e[0])return e;const n=t.warps.get()[e];if(!n)return"space";const s=n.type.get();return Q[s]?Q[s](n):s},oe=({code:e,weave:n,address:s,prefix:r="",right:a=!1})=>{let o=e.replace(/[\r\n]/g,"").split("=>");a||(o=o.reverse());const i=n.wefts.get();n.remove(...se(n,s,a));const l=n.get_id(s.split("/")[0]);let c=s;const u=o.map(e=>{if(""===(e=e.trim()))return;const s=ne(e);s.id=`${r}${t()}`;const o=n.add(s).id.get();return a?i[c]=o:i[o]=c,c=o,o});return l.rezed&&n.rez(...u),n.wefts.set(i),u},ie=e=>e=(e=(e=e.split(";")).map((t,n)=>(t=t.trim(),n!==e.length-1&&(t+=";"),n===e.length-2&&(t+="\r\n"),t)).join("\r\n")).split("=>").join("\r\n\r\n=>"),le=(e,t)=>{const n=ae(e,t).split(";"),s=n.pop().trim();return n.length>0?`{${n.length}} ${s}`:s};var ce=i({grab_script(e,t,n){const s=e.weave,r=`${e.id.get()}/${t}`;if(0===s.chain(r,n).slice(0,-1).length)return;const{weave:a,id:o,space:i}=this,l=re({address:r,weave:s}),c=`${o}/${t}`,u=s.get_id(e.id.get()).value.get(t).get();i.value.has(t)||i.value.write({[t]:u}),requestAnimationFrame(()=>{this.scripts.push(...oe({code:l,weave:a,address:c,right:n,prefix:"&"}))})},rez(){const{space:e,weave:t,value:n,id:s}=this;this.scripts=this.scripts||[],this.cancel=n.listen(n=>{this.weave.remove(...this.scripts);const r=Wheel.get(t.resolve(n,s));r||console.warn("Invalid other for clone");const a=r?r.value.get():{};d(a).forEach(e=>{this.grab_script(r,e),this.grab_script(r,e,!0)}),e.set({...e.get(),__proto__:a},!0)})},derez(){this.cancel(),this.space.set({...this.space.get()},!0),this.weave.remove(...this.scripts)}}),ue=i({rez(){this.cancel=this.value.listen(e=>{const t=this.space.id.get(),n=Wheel.get(this.weave.resolve(e,t));if(!n)return void console.warn("leader not found");const s=n.value.get();if(!s["!birds"])return s["!birds"]=y(new Set([t])),void n.value.set(s);let r=s["!birds"].get();r.add||Array.isArray(r)||(r=new Set),Array.isArray(r)&&(r=new Set(r)),r.has(t)||(r.add(t),s["!birds"].set([...r]))})},derez(){const e=this.space.id.get();this.cancel();const t=Wheel.get(this.weave.resolve(this.value.get(),e));if(!t)return void console.warn("no leader");const n=t.value.get();if(!n)return void console.warn("no leader value");let s=n["!birds"].get();s.add||Array.isArray(s)||(s=new Set),Array.isArray(s)&&(s=new Set(s)),s.delete(e),n["!birds"].set([...s])}}),de=i({create(){this.cancel=this.value.listen(e=>{const t=this.weave.names.get();if(this.name_last){if(this.name_last===e)return;delete t[this.name_last]}t[e]=this.space,this.name_last=e,this.weave.names.set(t)})},destroy(){this.cancel(),this.weave.names.update(e=>(delete e[this.name_last],e))}}),he=i({create(){requestAnimationFrame(()=>{this.value.set([])})}});let pe;const fe=$(0,e=>{pe=e});let ge=Date.now();const me=$([0,0],e=>{let t;const n=[0,0],s=r=>{requestAnimationFrame(s),void 0===t&&(t=r),n[0]=r,n[1]=Math.round(r-t),t=r;const a=Date.now();a-ge>=O.get()&&(ge=a,pe(fe.get()+1)),e(n)};requestAnimationFrame(s)});var ve=Object.freeze({__proto__:null,tick:fe,frame:me});const $e=new Worker("/bin/physics.bundle.js"),we=y({}),ye=()=>requestAnimationFrame(()=>{const e=l(we.get())(([e,t])=>{const n=t.get();return[e,{id:e,position:be(n.position,[0,0,0]),"!velocity":n["!velocity"]&&Array.isArray(n["!velocity"].get())?n["!velocity"].get().map(e=>null===e?0:e):[0,0,0],scale:be(n.scale,1),"!real":be(n["!real"],!1),"!name":be(n["!name"],`id-${e}`),mass:be(n.mass,1),"!force":be(n["!force"],void 0)}]});$e.postMessage({type:"solve",data:e})});let _e=()=>{ye()};$e.onmessage=({data:e})=>{_e=()=>{const t=we.get();c(e.bodies)(([e,n])=>{const s=t[e];s&&s.write(n)}),ye()}};const be=(e,t)=>e?e.get():t;fe.listen(()=>{_e()});var xe=i({rez(){((...e)=>{const t=we.get();e.forEach(e=>{t[e.id.get()]=e.value}),we.set(t,!0)})(this.space)},derez(){((...e)=>{const t=we.get();e.forEach(e=>{delete t[e.id.get()]}),we.set(t,!0)})(this.space)}}),ke=i({create(){this.value.set(void 0,!0),this.cancel=this.value.listen(()=>{})}});const Ee={value:{},get:()=>Ee.value,add:[],update:{},remove:[],hey(){const{add:e,update:t,remove:n}=Ee;return Ee.add=[],Ee.update={},Ee.remove=[],{add:e,update:t,remove:n}}};var ze=i({rez(){const e=this.space.id.get();Ee.value[e]=this.space,Ee.add.push(e),this.cancel=(e=>{const t={},n=e.id.get(),s=e.value.listen((e,{add:s,remove:r})=>{s.forEach(s=>{t[s]=e[s].listen(e=>{Ee.update[n]||(Ee.update[n]={}),Ee.update[n][s]=e})}),r.forEach(e=>{Ee.update[n]&&void 0!==Ee.update[n][e]&&delete Ee.update[n][e],t[e](),delete t[e]})});return()=>{s(),h(t).forEach(e=>e())}})(this.space)},derez(){this.cancel();const e=this.space.id.get();delete Ee.value[e],Ee.remove.push(e)}}),Oe=i({play(){this.clip=n.clip({synth:"PolySynth",pattern:"[xx][xR]".repeat(4),notes:n.arp({chords:"Dm BbM Am FM BbM FM CM Gm",count:8,order:1022}),accent:"x-xx--xx"}),this.clip.start(),s.Transport.start()},stop(){this.clip&&this.clip.stop()},rez(){let e=!1;this.cancel=this.value.listen(t=>{e?(this.stop(),this.play()):e=!0})},derez(){this.cancel()}}),Se="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var je=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e,t){!function(){function t(e,t,n){var s=new XMLHttpRequest;s.open("GET",e),s.responseType="blob",s.onload=function(){a(s.response,t,n)},s.onerror=function(){console.error("could not download file")},s.send()}function n(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function s(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var r="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof Se&&Se.global===Se?Se:void 0,a=r.saveAs||("object"!=typeof window||window!==r?function(){}:"download"in HTMLAnchorElement.prototype?function(e,a,o){var i=r.URL||r.webkitURL,l=document.createElement("a");a=a||e.name||"download",l.download=a,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?s(l):n(l.href)?t(e,a,o):s(l,l.target="_blank")):(l.href=i.createObjectURL(e),setTimeout((function(){i.revokeObjectURL(l.href)}),4e4),setTimeout((function(){s(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,r,a){if(r=r||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,a),r);else if(n(e))t(e,r,a);else{var o=document.createElement("a");o.href=e,o.target="_blank",setTimeout((function(){s(o)}))}}:function(e,n,s,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,s);var o="application/octet-stream"===e.type,i=/constructor/i.test(r.HTMLElement)||r.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||o&&i)&&"object"==typeof FileReader){var c=new FileReader;c.onloadend=function(){var e=c.result;e=l?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=e:location=e,a=null},c.readAsDataURL(e)}else{var u=r.URL||r.webkitURL,d=u.createObjectURL(e);a?a.location=d:location.href=d,a=null,setTimeout((function(){u.revokeObjectURL(d)}),4e4)}});r.saveAs=a.saveAs=a,e.exports=a}()}));const Ae=R.get(),Me=I.get(),Ne=new Promise(e=>{const t=new Image;t.src="/sheets/default_2.png",t.onload=()=>{const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const s=n.getContext("2d");s.drawImage(t,0,0),e({ctx:s,canvas:n})}}),Ce=new Map,Le=(e,t)=>Math.floor(Math.random()*(Math.abs(e)+Math.abs(t))-Math.abs(e));var Te=async({width:e,height:t,data:n,random:s=!1})=>{const{canvas:r}=await Ne,a=`${e}:${t}:${n}`;if(!s&&Ce.has(a))return Ce.get(a);const o=document.createElement("canvas"),i=o.getContext("2d");if(o.width=16*e,o.height=16*t,s){let n,s,a,o;for(let l=0;l<e;l++)for(let e=0;e<t;e++)n=16*l,s=16*e,a=16*Le(0,Ae),o=16*Le(0,Me/Ae),i.drawImage(r,a,o,16,16,n,s,16,16)}else if(n.length>0){let t,s;n.split(" ").forEach((n,a)=>{t=a%e,s=Math.floor(a/e);const o=parseInt(n,10),l=o%Ae,c=Math.floor(o/Ae),u=16*t,d=16*s,h=16*l,p=16*c;i.drawImage(r,h,p,16,16,u,d,16,16)})}const l=o.toDataURL("image/png");return s||Ce.set(a,l),l};const Fe=e=>{try{const t=r.load(e);return JSON.parse(t["0th"][r.ImageIFD.Make])}catch(e){return!1}},Ie=y(!1),Re=async e=>{const t={"0th":{[r.ImageIFD.Make]:JSON.stringify(e),[r.ImageIFD.Software]:"isekai"},Exif:{},GPS:{}};je.saveAs(r.insert(r.dump(t),await Pe(e.name.get())),`${e.name.get()}.jpg`),Ie.set(e.name)},We=e=>new Promise(async t=>{const n=new Image;n.src=await Te(e),n.onload=()=>t(n)}),De=We({width:4,height:4,data:["18 19 19 20","50 0 0 52","50 0 0 52","82 83 83 84"].join(" ")}),Pe=async e=>{const t=V(`/${e}`),n=We({width:1,height:1,data:t}),s=document.createElement("canvas");s.width=64,s.height=64;const r=s.getContext("2d");return r.imageSmoothingEnabled=!1,r.filter="sepia(1) hue-rotate(90deg)",r.drawImage(await De,0,0,64,64,0,0,64,64),r.drawImage(await n,0,0,16,16,16,16,32,32),s.toDataURL("image/jpeg",.95)},qe=async(e,{autorun:t=!1}=!1)=>{const n=`https://raw.githubusercontent.com/${e[0]}/${e[1]}/master/${e[2]}.jpg`,s=new FileReader,r=await fetch(n).then(e=>e.blob());return s.readAsDataURL(r),new Promise((n,r)=>{s.addEventListener("load",()=>{const a=Fe(s.result);if(!a)return r(new Error(404));Wheel.spawn({[a.name]:a}),Wheel.get(a.name).write({"!info":{type:"space",value:{from:e.join("/"),url:`https://github.com/${e[0]}/${e[1]}/blob/master/${e[2]}.jpg`}}}),t&&Wheel.start(a.name),n(a.name)})})};var Je=i({create(){requestAnimationFrame(()=>{this.cancel=this.value.listen(e=>{(e=Array.isArray(e)?e:[e]).forEach(e=>{if("string"!=typeof e)return;const t=e.split("/");Wheel.get(t[t.length-1])||qe(t)})})})},destroy(){this.cancel&&this.cancel()}}),Be=Object.freeze({__proto__:null,flock:Z,clone:ce,leader:ue,name:de,birds:he,velocity:xe,real:xe,collide:ke,visible:ze,force:xe,sound:Oe,need:Je});const Ue=$(""),He=$("space"),Ge=i(K,{address(){return`${this.weave.name.get()}/${this.name().get()||this.id.get()}`},name(){return this.value.get("!name")||Ue},create(){const e=this.id.get();this.twists={},this.cancel=this.value.listen((t,{add:n,remove:s})=>{(e=>(...t)=>Object.assign(e,...t))(this.twists)(n.reduce((e,n)=>{const s=Be[n.slice(1)];if(void 0===s)return e;const r=s({weave:this.weave,value:t[n],space:this,id:this.id.get()});return r.create&&r.create(),this.rezed&&r.rez&&requestAnimationFrame(()=>r.rez()),e[n]=r,e},{})),s.forEach(t=>{const n=this.twists[t];this.weave.remove(...this.weave.chain(`${e}/${t}`).slice(0,-1)),this.weave.remove(...this.weave.chain(`${e}/${t}`,!0).slice(0,-1)),n&&(this.rezed&&n.derez&&n.derez(),n.destroy&&n.destroy(),delete this.twists[t])})})},remove(...e){const t=this.value.get();e.forEach(e=>{delete t[e]}),this.value.set(t)},destroy(){this.cancel(),c(this.twists)(([e,t])=>{this.rezed&&t.derez&&t.derez(),t.destroy&&t.destroy()}),this.twists={}},rez(){this.rezed=!0,c(this.twists)(([e,t])=>{t.rez&&t.rez()})},derez(){this.rezed=!1,c(this.twists)(([e,t])=>{t.derez&&t.derez()})},chain(){const e=this.value.get(),t=this.id.get();return d(e).reduce((e,n)=>(e.push(...this.weave.chain(`${t}/${n}`).slice(0,-1),...this.weave.chain(`${t}/${n}`,!0).slice(1)),e),[])},get(e){return this.value.get(e)},gets(...e){return e.reduce((e,t)=>(e[t]=this.get(t),e),{})},get_value(e){const t=this.value.get(e);if(t)return t.get()},get_values(...e){return e.reduce((e,t)=>(e[t]=this.get_value(t),e),{})},write(e,t){return this.value.write(e,t)}});const Ye=e=>{if("string"!=typeof e)return e;if(-1===e.indexOf(".")&&-1===e.indexOf(",")){const t=parseInt(e);if("number"==typeof t&&!isNaN(t))return t}return JSON.parse(e)},Ve=$("stream"),Xe=i(w,{set(e){try{w.set.call(this,Ye(e))}catch(t){w.set.call(this,e)}return this}});const Ke=$("sprite");const Ze=t=>{const n=e(t);return void 0===n.red?16777215:n.red+255*n.green+255*n.blue},Qe=$("color");o.v3.setDefaultType(Array);const et={},tt=new a.Parser({in:!0,assignment:!0});Object.entries(o.v3).forEach(([e,t])=>{tt.functions[`v3_${e}`]=function(...e){return t(...e)}}),Object.entries(o.m4).forEach(([e,t])=>{tt.functions[`m4_${e}`]=function(...e){return t(...e)}}),tt.functions.Color=e;const nt=()=>{},st=/[ .~%!&/^]/g,rt=/[.*+?^${}()|[\]\\]/g,at=/\.\//g,ot=/~\//g,it=/\$/g,lt=$("math"),ct=i(K,{run(e){const t=e.match(Wheel.REG_ID),n={},s=this.weave.chain(this.id.get(),!0).shift();let r=this.weave.to_address(s);if(!r)return;if("space"!==Wheel.get(r).type.get()){const e=this.weave.chain(this.id.get()).shift();r=this.weave.to_address(e)}new Set(t).forEach(t=>{const s="$"===t[0],a=t.replace(at,`${r}/`).replace(ot,`/${this.weave.name.get()}/`).replace(it,"").trim(),o=Wheel.get(a);if(!o)return;const i=t.replace(at,"dot").replace(ot,"weave").replace(st,"z");e=e.replace(new RegExp((e=>e.replace(rt,"\\$&"))(t),"g"),i),n[i]={warp:o,shh:s}});try{this.fn=(e=>{let t=et[e];return t||(t=tt.parse(e),et[e]=t),e=>{try{t.evaluate(e)}catch(t){console.warn("Math script error",t),console.log(e)}return e.return}})(e),this.values.set(n)}catch(e){console.warn("Math parse error",e)}},rez(){requestAnimationFrame(()=>{this.run(this.math.get())}),this.cancels=new Set,this.cancel_vs=this.values.listen(e=>{this.cancels.forEach(e=>e()),this.cancels.clear(),Object.entries(e).forEach(([e,{warp:t,shh:n}])=>{n||this.cancels.add(t.listen(()=>{this.value.set(this.value.last)}))})})},derez(){this.cancel_vs(),this.cancels.forEach(e=>e())},toJSON(){return{type:this.type.get(),value:null,math:this.math.get()}}}),ut=i(w,{set(e,t){w.set.call(this,e,t),t||this.warp.run(e)}}),dt=i(w,{set(e,t){this.last=e;const n=this.warp.values.get();e=void 0===e?null:e;const s={...Object.fromEntries(Object.entries(n).map(([e,{warp:t}])=>[e,void 0===t.toJSON()?null:t.toJSON()])),value:e};s.null=null,s.delay=!1;const r=this.warp.fn(s);if(null!=r)return s.delay?(requestAnimationFrame(()=>{w.set.call(this,r)}),this):(w.set.call(this,r,t),this)}});const ht=$("mail"),pt=i(K,{fix(e){const t=this.get_space();return e.replace("$","").replace("~",`/${this.weave.name.get()}`).replace(".",`${this.weave.name.get()}/${t?t.get_value("!name"):"not connected"}`)},clear(){this.cancels.forEach(e=>e()),this.cancels.clear()},derez(){this.cancel_whom(),this.clear()},rez(){this.cancels=new Set,this.cancel_whom=this.whom.listen(e=>{this.clear();const t=this.fix(e),n=Wheel.get(t);if("$"===e[0])return n?void this.set(n.get()):this.set(null);if(!n)return;const s=n.type?n.value:n;this.cancels.add(s.listen(e=>{this.set(e)}))})},toJSON(){return{type:this.type.get(),value:this.value.get(),whom:this.whom.get()}},set(e){w.set.call(this.value,e)}}),ft=i(w,{set(e,t){const n=this.mail.fix(this.mail.whom.get()),s=Wheel.get(n);s&&s.set&&(s.set(e),w.set.call(this,e,t))}});var gt=Object.freeze({__proto__:null,space:({id:e,value:t={},weave:n})=>i(Ge,{type:He,value:k(t),id:$(e),weave:n}),stream:({id:e,value:t=null})=>i(K,{type:Ve,value:i(Xe,y()).set(t),id:$(e)}),sprite:({value:e=0,id:t})=>i(K,{type:Ke,value:y(e),id:$(t)}),color:({value:e="#FFFFFF",id:t})=>i(K,{type:Qe,value:z(Ze).set(e),id:$(t)}),math:({math:e="2+2",value:t,weave:n,id:s}=!1)=>{const r=i(ct,{type:lt,values:y({}),id:$(s),weave:n,fn:nt});return r.value=i(dt,{...y(t),warp:r}),r.math=i(ut,{...y(e),warp:r}),requestAnimationFrame(()=>r.math.set(e,!0)),r},mail:({whom:e="/sys/mouse/position",weave:t,id:n})=>{const s=i(pt,{type:ht,whom:y(e),id:$(n),weave:t});return s.value=i(ft,{...y(),mail:s}),s}});const mt={is_rezed(){return void 0!==Wheel.running.get()[this.name.get()]},add(e){e.id=e.id||t();const n=this.make(e);if(n)return this.warps.update(e=>(e[n.id.get()]=n,e)),n.create&&n.create(),n},remove_unnamed(){const e=this.warps.get(),t=[];return Object.keys(e).forEach(e=>{"&"===e[0]&&t.push(e)}),this.remove(...t),t.length},remove_name(e){const t=this.get_name(e);if(!t)return;const n=t.id.get();return this.remove(n)},remove(...e){this.warps.update(t=>{let n;const s=this.rezed.get(),r=this.is_rezed(),a=this.wefts.get();let o=!1;return e.forEach(e=>{a[e]&&(o=!0,delete a[e]);const i=t[e];i&&(r&&s[e]&&(n=!0,delete s[e],i.derez&&i.derez()),i.destroy&&i.destroy(),delete t[e])}),n&&this.rezed.set(s,!0),o&&this.wefts.set(a),t})},write_ids(e){const t=this.warps.get();return l(e)(([e,n])=>{const s=t[e];if(!s){n.value=n.value||{},n.id=e;const t=this.add(n);return t?[e,t]:[e,!1]}return c(n)(([e,t])=>{const n=s[e];"value"!==e?n.set&&n.set(t):n.set(Object.assign(n.get(),t))}),[e,s]})},write(e){const t=this.names.get();return l(e)(([e,n])=>{const s=t[e];if(!s){n.value=n.value||{},n.value["!name"]=n.value["!name"]||e;const t=this.add(n);return t?[e,t]:[e,!1]}return c(n)(([e,t])=>{const n=s[e];"value"!==e?n.set&&n.set(t):n.set(Object.assign(n.get(),t))}),[e,s]})},exists(e){const[t,n]=e.split("/"),s=this.warps.get()[t];return!!s&&(void 0===n||void 0!==s.value.get()[n])},validate(){let e=!1;const t=this.wefts.get(),n=this.warps.get(),s=[];return c(n)(([e,t])=>{if("space"===t.type.get())return;const r=this.chain(t.id.get(),!0),a=r[r.length-1].split("/")[0],o=r[0].split("/")[0],i=n[a],l=n[o];i&&"space"===i.type.get()||l&&"space"===l.type.get()||s.push(t.id.get())}),s.length>0&&this.remove(...s),c(t)(([n,s])=>{this.exists(n)&&this.exists(s)||(e=!0,delete t[n])}),e?(this.wefts.set(t),s.length):s.length},chain(e,t=!1){const n=t?this.wefts.get()[e]:this.wefts_r.get()[e];return n?[...this.chain(n,t),e]:[e]},to_address(e){const[t]=e.split("/"),n=this.get_id(t);if(n)return`/${this.name.get()}/${n.id.get()}`},get_name(e){return this.names.get()[e]},get_id(e){if(!e)return;const[t,n]=e.split("/"),s=this.warps.get()[t];if(!n)return s;if(!s)return;const r=s.value.get();return r&&r[n]?{value:r[n]}:void 0},make(e){return(({id:e=t(),type:n,knot:s,...r}=!1)=>{return!n&&s&&(n=s),"stitch"===n&&(n="space",r.value=r.value||{},r.value["!name"]=r.name),gt[n]?gt[n]({...r,id:e}):(console.warn(`Invalid warp ${n}`),!1)})({...e,weave:this})},resolve(e,t){return e.replace(".",this.to_address(this.chain(t,!0).shift())).replace("~",this.name.get())},derez(...e){const t=this.rezed.get(),n=this.warps.get();e.forEach(e=>{const s=n[e];s&&"space"===s.type.get()&&this.derez(...n[e].chain()),delete t[e]}),this.rezed.set(t)},rez(...e){const t=this.rezed.get(),n=this.warps.get();e.forEach(e=>{const s=n[e];s&&("space"===s.type.get()&&this.rez(...s.chain()),t[e]=!0)}),this.rezed.set(t)},destroy(){this.destroys.forEach(e=>e())},toJSON(){return{id:this.id.toJSON(),name:this.name.toJSON(),wefts:this.wefts.toJSON(),warps:p(this.warps),rezed:this.rezed.toJSON()}}};var vt=({name:e=X(2),id:n=t(),warps:s={},wefts:r={},rezed:a={},knots:o,threads:l}=!1)=>{o&&(s=o),l&&(r=l);const d=i(mt,{id:$(n),name:y(e),wefts:b(r),rezed:b(a),names:y({}),destroys:[]}),h=u(s)((e,[t,n])=>{n.id!==t&&(n.id=t);const s=d.make(n);return s?(e[t]=s,e):e},{});return c(h)(([e,t])=>t.create&&t.create()),d.warps=y(h),d.wefts_r=$({},e=>{const t={};d.destroys.push(d.wefts.listen((n,{add:s,remove:r,modify:a,previous:o})=>{r.forEach(e=>{delete t[o[e]]}),s.forEach(e=>{t[n[e]]=e}),a.forEach(e=>{t[n[e]]=e}),e(t)}))}),d};const $t=y({sys:vt({name:"sys",id:"sys"})}),wt=new Map;let yt;const _t=$({sys:!0},e=>{yt=e}),bt=y(),xt=y(""),kt=e=>{const[t,n,s]=(e=>{let t=e.split("/");return""===t[0]&&(t=t.slice(1)),t})(e),r=$t.get()[t];if(void 0===r)return;if(void 0===n)return r;let a=r.names.get()[n];if(void 0===a&&(a=r.warps.get()[n],!a))return;if(void 0===s)return a;const o=a.value.get();if(!o)return;const i=o[s];return void 0!==i?i:void 0},Et=e=>{if("sys"===e)return;const t=wt.get(e);void 0!==t&&(t(),wt.delete(e));const n=_t.get();delete n[e],yt(n)},zt=()=>{const e=$t.get();d(e).forEach(e=>Et(e))};var Ot=Object.freeze({__proto__:null,SYSTEM:"sys",weaves:$t,running:_t,trash:bt,del:e=>{const t=_t.get(),n=$t.get();let s=!1;e.forEach(e=>{"sys"!==e&&(t[e]&&Et(e),n[e]&&(s=!0,n[e].destroy(),bt.set(n[e]),delete n[e]))}),s&&$t.set(n)},name:xt,get:kt,exists:e=>void 0!==kt(e),spawn:(e={})=>l(e)(([e,t])=>{if("sys"===e)return console.warn("tried to spawn sys"),[e,kt(e)];const n=$t.get(),s=vt({...t,name:e});return n[e]=s,$t.set(n),[e,s]}),start:e=>{if("sys"===e)return;const t=kt(e);if(!t)return!1;const n=(e=>{const t=e.rezed.listen((t,{add:n,remove:s})=>{const r=[],a=e.warps.get();n.forEach(e=>{const n=a[e];if(!n)return delete t[e],r.push(e);n.rezed=!0,n.rez&&n.rez(),n.value.notify()}),s.forEach(e=>{const n=a[e];if(!n)return delete t[e],r.push(e);delete n.rezed,n.derez&&n.derez()}),r.length>0&&e.rezed.set(t,!0)});return()=>{t(),h(e.rezed.get()).forEach(e=>e&&e.derez&&e.derez())}})(t),s=(e=>{const t={},n=e.wefts.listen((n,{add:s,remove:r,modify:a})=>{let o;[...s,...a].forEach(s=>{const r=n[s],a=e.get_id(s),i=e.get_id(r);if(!i||!a)return o=!0,void delete n[s];t[s]&&t[s]();const l=e.get_id(s.split("/")[0]);t[s]=a.value.subscribe(e=>{l.rezed&&i.value.set(e)})}),r.forEach(e=>{const n=t[e];n&&(n(),delete t[e])}),o&&e.wefts.set(n,!0)});return()=>{n(),h(t).forEach(e=>e())}})(t);wt.set(e,()=>{s(),n()}),yt({..._t.get(),[e]:!0})},stop:Et,stop_all:zt,clear:()=>{zt(),$t.set({sys:$t.get().sys})},restart:e=>{Wheel.stop(e),Wheel.start(e)},toJSON:()=>({name:xt.get(),weaves:p($t),running:_t.toJSON()}),REG_ID:/\$?[~.]?\/[a-zA-Z 0-9!%&/]+/g,shared:{},chain:se,decompile:re,translate:ae,compile:oe,format:ie,condense:le});window.Wheel=Ot;const St=$([0,0],e=>window.addEventListener("mousemove",({clientX:t,clientY:n})=>e([t,n]))),jt=$(null,e=>window.addEventListener("mouseup",t=>e(t))),At=$([0,0,0],e=>window.addEventListener("wheel",t=>{e([-t.deltaX,-t.deltaY,0])}));var Mt=Object.freeze({__proto__:null,position:St,mouse_up:jt,scroll:At});const Nt=$(["#version 300 es\nprecision lowp float;\n#define GLSLIFY 1\n\nuniform mat4 u_view_projection;\nuniform float u_sprite_size;\nuniform float u_sprite_columns;\nuniform float u_time;\nuniform float u_background_color;\n\nin vec3 translate;\nin vec3 translate_last;\n\nin float scale;\nin float scale_last;\n\nin float rotation;\nin float rotation_last;\n\nin float alpha;\nin float alpha_last;\n\nin int color;\nin int color_last;\n\nin float sprite;\n\nin vec2 position;\n\nin int flags;\n\nout vec2 v_sprite;\nout vec4 v_color;\n\nvoid main() {\n\t// mix the last color and the new color\n\tv_color = mix(\n\t\tvec4((color_last>>16) &0x0ff, (color_last>>8) &0x0ff, (color_last) & 0x0ff, alpha_last),\n\t\tvec4((color>>16) &0x0ff, (color>>8) &0x0ff, (color) & 0x0ff, alpha),\n\t\tu_time\n\t);\n\n\t// scale\n\tfloat s = mix(scale_last, scale, u_time);\n\n\t// Grabbing the tile\n\tfloat x = mod(sprite, u_sprite_columns);\n\tfloat y = floor(sprite / u_sprite_columns);\n\n\tvec2 pos_scale = position * s;\n\tvec2 coords = (position + vec2(0.5, 0.5) + vec2(x, y))/u_sprite_columns;\n\n\tif((flags & 0x1) == 1) {\n\t\tcoords[0] = -1.0 * coords[0];\n\t}\n\n\tif((flags & 0x2) == 2) {\n\t\tcoords[1] = 1.0 - coords[1];\n\t}\n\n\tv_sprite = coords;\n\n\t// position\n\tvec3 t = mix(translate_last, translate, u_time);\n\n\tmat4 mv = u_view_projection;\n\tvec3 pos = vec3(pos_scale, 0.0) + t;\n\n\tgl_Position = mv * vec4(\n\t\tpos,\n\t\t1.0\n\t);\n}\n","#version 300 es\nprecision lowp float;\n#define GLSLIFY 1\n\nuniform sampler2D u_map;\n\nin vec2 v_sprite;\nin vec4 v_color;\n\nout vec4 f_color;\n\nvoid main() {\n\tf_color = texture(u_map, v_sprite);\n\n\t// grayscale to remove any color from the image\n\tfloat gray = dot(f_color.rgb, vec3(0.299, 0.587, 0.114));\n\tf_color = gray * vec4(v_color.rgb, v_color.a);\n\n\t// super important, removes low opacity frags\n\tif(f_color.a < 0.1) discard;\n}\n"]),Ct=e=>{const t=e.set.bind(e);return n=>{if(!Array.isArray(n))return n&&"number"==typeof n[0]&&"number"==typeof n[1]&&"number"==typeof n[2]?void e.set(n):void 0;t(n)}},Lt=y(o.m4.identity()),Tt=y([0,0,0]),Ft=y([0,0,-1]);Ft.set=Ct(Ft),Tt.set=Ct(Tt);var It=Object.freeze({__proto__:null,camera:Lt,position:Tt,look:Ft});const Rt={position:[0,0,0],sprite:[0],scale:[1],color:[16777215],rotation:[0],alpha:[1],flags:[0]},Wt=o.primitives.createXYQuadVertices(1);let Dt=0;const Pt={...l(Wt)(([e,t])=>(t.divisor=0,[e,t])),translate_last:{divisor:1,data:new Float32Array(3),numComponents:3},translate:{divisor:1,data:new Float32Array(3),numComponents:3},rotation:{numComponents:1,data:new Float32Array(1),divisor:1},rotation_last:{numComponents:1,data:new Float32Array(1),divisor:1},alpha:{numComponents:1,data:new Float32Array(1),divisor:1},alpha_last:{numComponents:1,data:new Float32Array(1),divisor:1},color:{numComponents:1,data:new Int32Array(1),divisor:1},color_last:{numComponents:1,data:new Int32Array(1),divisor:1},sprite:{numComponents:1,data:new Float32Array(1),divisor:1},flags:{numComponents:1,data:new Int32Array(1),divisor:1},scale:{numComponents:1,data:new Float32Array(1),divisor:1},scale_last:{numComponents:1,data:new Float32Array(1),divisor:1}};let qt=Date.now();let Jt;const Bt=e=>Jt?(c(Pt)(([t,{data:n,divisor:s}])=>{1===s&&o.setAttribInfoBufferFromArray(e,Jt.attribs[t],n)}),Jt):(Jt=o.createBufferInfoFromArrays(e,Pt),Ut=!0,Jt);let Ut;const Ht=e=>{const t={count:Dt,buffer_info:Bt(e),time:(Date.now()-qt)/O.get(),dirty:Ut};return Ut&&(Ut=!1),t},Gt={};let Yt=0;const Vt=[],Xt=e=>(void 0===Gt[e]&&(0===Vt.length&&((e=100)=>{Jt=!1;const t=Yt+e;h(Pt).forEach(({divisor:e,data:n,numComponents:s})=>{1===e&&c(Pt)(([e,n])=>{const{data:s,numComponents:r,divisor:a}=n;1===a&&(n.data=new s.__proto__.constructor(r*t),n.data.set(s,0))})}),Vt.push(...[...Array(e)].map((e,t)=>Yt+t)),Yt=t})(),Gt[e]=Vt.shift()),Gt[e]);let Kt;fe.listen(()=>requestAnimationFrame(()=>{if(!Jt)return;const{update:e,remove:t,add:n}=Ee.hey();n.forEach(t=>{c(Rt)(([n,s])=>{if(Pt[`${n}_last`]){const e=Xt(t),{data:r,numComponents:a}=Pt[`${n}_last`];r.set([...s],e*a)}e[t]&&void 0!==e[t][n]||(e[t][n]=void 0===Ee.value[t][n]?Ee.value[t].get_value(n):[...s])})}),c(e)(([e,t])=>{const n=Xt(e);Kt.delete(e),c(Pt)(([e,{data:s,divisor:r,numComponents:a}])=>{if(1!==r||-1!==e.indexOf("_last"))return;const o=n*a,i="translate"===e?"position":e,l=t[i];let c;if("number"==typeof l)c=[...Array(a)].fill(l);else if(Array.isArray(l)){if(l.length<a)for(let e=a-l.length;e<l.length;e++)l[e]=Rt[i][e];c=l.slice(0,a)}else c=[...s.subarray(o,o+a)];if(void 0!==Pt[`${e}_last`]){const{data:t}=Pt[`${e}_last`];t.set([...s.subarray(o,o+a)],o)}return s.set(c,o)})}),t.forEach(e=>{Kt.delete(e),(e=>{const t=Gt[e];void 0!==t&&(Vt.push(t),c(Pt)(([e,{data:n,numComponents:s,divisor:r}])=>{1===r&&n.set([...Array(s)].fill(0),t*s)}))})(e)}),Kt&&Kt.forEach(e=>{const t=Xt(e);c(Pt)(([e,{data:n,divisor:s,numComponents:r}])=>{if(1!==s||-1!==e.indexOf("_last"))return;const a=t*r;if(void 0!==Pt[`${e}_last`]){const{data:t}=Pt[`${e}_last`];t.set([...n.subarray(a,a+r)],a)}})}),Dt=Yt,qt=Date.now(),Kt=new Set(d(e))}));let Zt=[0,0,0,1];q.listen(t=>{const{red:n,green:s,blue:r}=e(t).toRGB();Zt=[n,s,r,1]});const{m4:Qt}=o,en=[0,1,0];const tn=$([window.innerWidth,window.innerHeight],e=>{window.addEventListener("resize",()=>{e([window.innerWidth,window.innerHeight])})}),nn=y(1);tn.subscribe(([e,t])=>{const n=e>t?t:e;nn.set(n/100),window.document.documentElement.style.fontSize=`${Math.round(nn.get())}px`});const sn=$((()=>{const e={last:[0,0,0],next:[0,0,0],future:[0,0,0],update(){e.last=[...e.next],e.next=Tt.get()},get:t=>{const n=o.v3.lerp(e.last,e.next,t);return 1-t<.05&&e.update(),n}},t=document.createElement("canvas");t.width=1600,t.height=1600;const n=o.getContext(t);o.addExtensionsToContext(n);const s=o.createTextures(n,{map:{src:S.get(),mag:n.NEAREST,min:n.LINEAR}}),r=o.createProgramInfo(n,Nt.get());t.snap=y(Ht(n));const a=Qt.identity(),i=Qt.identity();const l=[{programInfo:r,vertexArrayInfo:void 0,uniforms:{},instanceCount:0}];return n.enable(n.DEPTH_TEST),n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.useProgram(r.program),t.cancel=me.listen(([c,u])=>{n.viewport(0,0,t.width,t.height),n.clearColor(...Zt),n.clear(n.COLOR_BUFFER_BIT|n.GL_DEPTH_BUFFER_BIT);const d=Ht(n);if(d.count<1)return;const h=t.width/t.height,p=o.m4.ortho(-10*h,10*h,10,-10,-100,50),f=Lt.get(),g=e.get(d.time);Qt.lookAt(g,o.v3.add(g,Ft.get()),en,f),Qt.inverse(f,a),Qt.multiply(p,a,i),l[0].vertexArrayInfo=o.createVertexArrayInfo(n,r,d.buffer_info),l[0].instanceCount=d.count,l[0].uniforms={u_map:s.map,u_time:d.time,u_sprite_size:16,u_sprite_columns:32,u_view_projection:i,u_background_color:Math.round(256*Zt[0]*256)+Math.round(256*Zt[1])+Zt[2]},o.drawObjectList(n,l)}),t})());var rn=Object.freeze({__proto__:null,size:tn,scale:nn,main:sn});const an=$("",e=>{window.addEventListener("keyup",t=>{if(t.preventDefault(),"ControlRight"===t.code)return e("enter!");e(`${t.key.toLowerCase()}!`)}),window.addEventListener("keydown",t=>{if("INPUT"!==t.target.tagName&&"TEXTAREA"!==t.target.tagName){if(t.preventDefault(),"ControlRight"===t.code)return e("enter");e(t.key.toLowerCase())}})}),on=$({},e=>{const t={},n=()=>{Object.entries(t).forEach(([e,n])=>{n&&"!"!==e[e.length-1]&&(t[e]=!1)}),e(t)};an.listen(n=>{t[n]=!0,n.length>1&&"!"===n[n.length-1]?t[n.slice(0,-1)]=!1:t[`${n}!`]=!1,e(t)}),window.addEventListener("blur",n),document.addEventListener("focus",n),document.addEventListener("visibilitychange",n,!1)});var ln=Object.freeze({__proto__:null,key:an,keys:on});const cn={};let un;window.addEventListener("gamepadconnected",({gamepad:e})=>{cn[e.id]=e}),window.addEventListener("gamepaddisconnected",({gamepad:e})=>{delete cn[e.id]});const dn=$({},e=>{un=e}),hn={0:"a",1:"b",2:"x",3:"y",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"up",13:"down",14:"left",15:"right"},pn={0:"lefthorizontal",1:"leftvertical",2:"righthorizontal",3:"rightvertical"},fn=$({},e=>{const t={};fe.listen(()=>{const n=navigator.getGamepads();for(let s=0;s<n.length;s++){const r=n[s];if(null===r)continue;r.buttons.forEach(({pressed:n},s)=>{const r=hn[s];r&&t[r]!==n&&(e(n?hn[s]:`${hn[s]}!`),t[r]=n)});const a=dn.get();r.axes.forEach((e,t)=>{const n=pn[e];n&&a[n]!==e&&(a[n]=e)}),un(a)}})}),gn=$({},e=>{const t={};fn.listen(n=>{"!"===n[n.length-1]?t[n.slice(0,-1)]=!1:t[n]=!0,e(t)})});var mn=Object.freeze({__proto__:null,axes:dn,button:fn,buttons:gn});
/* @license twgl.js 4.14.1 Copyright (c) 2015, Gregg Tavares All Rights Reserved.
	Available via the MIT license.
	see: http://github.com/greggman/twgl.js for details */let vn=Float32Array;var $n=Object.freeze({__proto__:null,add:function(e,t,n){return(n=n||new vn(3))[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n},copy:function(e,t){return(t=t||new vn(3))[0]=e[0],t[1]=e[1],t[2]=e[2],t},create:function(e,t,n){const s=new vn(3);return e&&(s[0]=e),t&&(s[1]=t),n&&(s[2]=n),s},cross:function(e,t,n){n=n||new vn(3);const s=e[2]*t[0]-e[0]*t[2],r=e[0]*t[1]-e[1]*t[0];return n[0]=e[1]*t[2]-e[2]*t[1],n[1]=s,n[2]=r,n},distance:function(e,t){const n=e[0]-t[0],s=e[1]-t[1],r=e[2]-t[2];return Math.sqrt(n*n+s*s+r*r)},distanceSq:function(e,t){const n=e[0]-t[0],s=e[1]-t[1],r=e[2]-t[2];return n*n+s*s+r*r},divide:function(e,t,n){return(n=n||new vn(3))[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n},divScalar:function(e,t,n){return(n=n||new vn(3))[0]=e[0]/t,n[1]=e[1]/t,n[2]=e[2]/t,n},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},lerp:function(e,t,n,s){return(s=s||new vn(3))[0]=e[0]+n*(t[0]-e[0]),s[1]=e[1]+n*(t[1]-e[1]),s[2]=e[2]+n*(t[2]-e[2]),s},lerpV:function(e,t,n,s){return(s=s||new vn(3))[0]=e[0]+n[0]*(t[0]-e[0]),s[1]=e[1]+n[1]*(t[1]-e[1]),s[2]=e[2]+n[2]*(t[2]-e[2]),s},length:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},lengthSq:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},max:function(e,t,n){return(n=n||new vn(3))[0]=Math.max(e[0],t[0]),n[1]=Math.max(e[1],t[1]),n[2]=Math.max(e[2],t[2]),n},min:function(e,t,n){return(n=n||new vn(3))[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n[2]=Math.min(e[2],t[2]),n},mulScalar:function(e,t,n){return(n=n||new vn(3))[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n},multiply:function(e,t,n){return(n=n||new vn(3))[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n},negate:function(e,t){return(t=t||new vn(3))[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},normalize:function(e,t){t=t||new vn(3);const n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.sqrt(n);return s>1e-5?(t[0]=e[0]/s,t[1]=e[1]/s,t[2]=e[2]/s):(t[0]=0,t[1]=0,t[2]=0),t},setDefaultType:function(e){const t=vn;return vn=e,t},subtract:function(e,t,n){return(n=n||new vn(3))[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}});const{length:wn,add:yn,mulScalar:_n}=$n,bn=y(.75),xn=$([0,0,0],e=>{const t=[0,0,0];me.listen(()=>{const{w:n,a:s,s:r,d:a,q:o,e:i}=on.get();t[0]=0,t[1]=0,t[2]=0,n&&(t[1]-=1),r&&(t[1]+=1),s&&(t[0]-=1),a&&(t[0]+=1),o&&(t[2]+=1),i&&(t[2]-=1),0!==wn(t)&&e(t)})});let kn=[0,0,0];const En=z(e=>e.map(e=>Math.round(e)));En.set([0,0,0]),fe.listen(()=>{Math.abs(wn(kn))<1||(En.set(yn(En.get(),kn).map(e=>Math.round(e))),kn=_n(kn,.25))}),At.listen(e=>{kn=yn(kn,e)});const zn=y(""),On={home:({home:e},{start:t})=>e||t,up:({arrowup:e,tab:t,shift:n},{up:s})=>e||t&&n||s,down:({arrowdown:e,tab:t,shift:n},{down:s})=>e||t&&n||s,pagedown:({pagedown:e},{righttrigger:t})=>e||t,pageup:({pageup:e},{rightshoulder:t})=>e||t,insert:({insert:e},{x:t})=>e||t,delete:({delete:e},{y:t})=>e||t,left:({arrowleft:e},{left:t})=>e||t,right:({arrowright:e},{right:t})=>e||t,confirm:({enter:e},{a:t})=>t||e,cancel:({end:e,escape:t},{b:n})=>e||n||t,editor:({pause:e,tilde:t},{select:n})=>t||e||n,avatar_up:({w:e})=>e,avatar_down:({s:e})=>e,avatar_left:({a:e})=>e,avatar_right:({d:e})=>e,avatar_jump:({" ":e})=>e,avatar_sprint:({shift:e})=>e,avatar_left_arm:({q:e})=>e,avatar_right_arm:({e:e})=>e,undo:({control:e,z:t,backspace:n})=>e&&t||n,redo:({shift:e,control:t,z:n,backspace:s})=>e&&t&&n||e&&s},Sn=$({},e=>{const t={};fe.listen(()=>{const n=on.get(),s=gn.get();Object.entries(On).forEach(([e,r])=>{t[e]=r(n,s)}),e(t)})});var jn=Object.freeze({__proto__:null,zoom:bn,translate:xn,scroll:En,focus:zn,buttons:Sn});const An=z(e=>Array.isArray(e)?e:e.split("/"));window.addEventListener("popstate",e=>{e.preventDefault(),e.stopPropagation(),Mn()});const Mn=()=>{const e=window.location.search?window.location.search.slice(1):window.location.pathname.slice(1);An.set(decodeURI(e))};Mn();IDBKeyRange.upperBound(Date.now()-6e4);let Nn;const Cn=y(!1),Ln=new Promise(e=>{const t=window.indexedDB.open("isekai",2);t.onupgradeneeded=async e=>{Nn=e.target.result,await Nn.createObjectStore("wheel",{keyPath:"name"})},t.onsuccess=t=>{Nn=t.target.result,e(Nn)}}),Tn=({store:e="wheel",action:t="get",args:n=[],foronly:s="readwrite"}=!1)=>new Promise((r,a)=>{Ln.then(()=>{const o=Nn.transaction([e],s);o.onerror=a,o.objectStore(e)[t](...n).onsuccess=e=>r(e.target.result)})});window.query=Tn;const Fn=async e=>{Cn.set(!1);const t=await Tn({action:"get",args:[e]}).catch(e=>console.warn("DB",e.target.error));if(t){const{weaves:n,running:s}=t;delete n[Wheel.SYSTEM],Wheel.name.set(e),Wheel.spawn(n),Object.keys(s).forEach(e=>{e!==Wheel.SYSTEM&&Wheel.get(e)&&Wheel.start(e)})}Cn.set(!0);const n=fe.listen(e=>{e%10==0&&void 0!==Nn&&Cn.get()&&(async()=>{const e=Wheel.toJSON();e.date=Date.now(),await Tn({action:"put",args:[e],foronly:"readwrite"})})()});return()=>{Wheel.clear(),Wheel.name.set("loading"),n()}};let In=!1;An.listen(async e=>{In&&In.then(e=>e()),1===e.length&&(Wheel.name.set(e[0]),In=Fn(e[0])),3===e.length&&(await Cn,Wheel.name.set("loading"),await qe(e,{autorun:!0}),Wheel.name.set(e.join("/")),In=Fn(e.join("/")))});const Rn={mouse:Mt,time:ve,screen:rn,input:jn,key:ln,gamepad:mn,flag:l(H)(([e,t])=>[e.replace(/_/g," ").toLowerCase(),t]),camera:It};var Wn,Dn=vt({name:"sys",id:"sys",warps:(Wn=Rn,u(Wn)((e,[t,n])=>({...e,[t]:{type:"space",value:{...n,"!name":t}}}),{})),rezed:Rn});function Pn(){}function qn(e){return e()}function Jn(){return Object.create(null)}function Bn(e){e.forEach(qn)}function Un(e){return"function"==typeof e}function Hn(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function Gn(e,t){const n=e.subscribe(t);return n.unsubscribe?()=>n.unsubscribe():n}function Yn(e,t,n){e.$$.on_destroy.push(Gn(t,n))}function Vn(e,t,n,s){if(e){const r=Xn(e,t,n,s);return e[0](r)}}function Xn(e,t,n,s){return e[1]&&s?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](s(t))):n.ctx}function Kn(e,t,n,s){if(e[2]&&s){const r=e[2](s(n));if("object"==typeof t.dirty){const e=[],n=Math.max(t.dirty.length,r.length);for(let s=0;s<n;s+=1)e[s]=t.dirty[s]|r[s];return e}return t.dirty|r}return t.dirty}function Zn(e){return e&&Un(e.destroy)?e.destroy:Pn}function Qn(e,t){e.appendChild(t)}function es(e,t,n){e.insertBefore(t,n||null)}function ts(e){e.parentNode.removeChild(e)}function ns(e){return document.createElement(e)}function ss(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function rs(e){return document.createTextNode(e)}function as(){return rs(" ")}function os(){return rs("")}function is(e,t,n,s){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)}function ls(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function cs(e,t){t=""+t,e.data!==t&&(e.data=t)}function us(e,t){(null!=t||e.value)&&(e.value=t)}function ds(e,t,n,s){e.style.setProperty(t,n,s?"important":"")}function hs(e,t,n){e.classList[n?"add":"remove"](t)}let ps;function fs(e){ps=e}function gs(){if(!ps)throw new Error("Function called outside component initialization");return ps}const ms=[],vs=[],$s=[],ws=[],ys=Promise.resolve();let _s=!1;function bs(e){$s.push(e)}function xs(){const e=new Set;do{for(;ms.length;){const e=ms.shift();fs(e),ks(e.$$)}for(;vs.length;)vs.pop()();for(let t=0;t<$s.length;t+=1){const n=$s[t];e.has(n)||(n(),e.add(n))}$s.length=0}while(ms.length);for(;ws.length;)ws.pop()();_s=!1}function ks(e){if(null!==e.fragment){e.update(),Bn(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(bs)}}const Es=new Set;let zs;function Os(){zs={r:0,c:[],p:zs}}function Ss(){zs.r||Bn(zs.c),zs=zs.p}function js(e,t){e&&e.i&&(Es.delete(e),e.i(t))}function As(e,t,n,s){if(e&&e.o){if(Es.has(e))return;Es.add(e),zs.c.push(()=>{Es.delete(e),s&&(n&&e.d(1),s())}),e.o(t)}}function Ms(e,t){const n=t.token={};function s(e,s,r,a){if(t.token!==n)return;t.resolved=a;let o=t.ctx;void 0!==r&&(o=o.slice(),o[r]=a);const i=e&&(t.current=e)(o);let l=!1;t.block&&(t.blocks?t.blocks.forEach((e,n)=>{n!==s&&e&&(Os(),As(e,1,1,()=>{t.blocks[n]=null}),Ss())}):t.block.d(1),i.c(),js(i,1),i.m(t.mount(),t.anchor),l=!0),t.block=i,t.blocks&&(t.blocks[s]=i),l&&xs()}if((r=e)&&"object"==typeof r&&"function"==typeof r.then){const n=gs();if(e.then(e=>{fs(n),s(t.then,1,t.value,e),fs(null)},e=>{fs(n),s(t.catch,2,t.error,e),fs(null)}),t.current!==t.pending)return s(t.pending,0),!0}else{if(t.current!==t.then)return s(t.then,1,t.value,e),!0;t.resolved=e}var r}function Ns(e,t){As(e,1,1,()=>{t.delete(e.key)})}function Cs(e,t,n,s,r,a,o,i,l,c,u,d){let h=e.length,p=a.length,f=h;const g={};for(;f--;)g[e[f].key]=f;const m=[],v=new Map,$=new Map;for(f=p;f--;){const e=d(r,a,f),i=n(e);let l=o.get(i);l?s&&l.p(e,t):(l=c(i,e),l.c()),v.set(i,m[f]=l),i in g&&$.set(i,Math.abs(f-g[i]))}const w=new Set,y=new Set;function _(e){js(e,1),e.m(i,u),o.set(e.key,e),u=e.first,p--}for(;h&&p;){const t=m[p-1],n=e[h-1],s=t.key,r=n.key;t===n?(u=t.first,h--,p--):v.has(r)?!o.has(s)||w.has(s)?_(t):y.has(r)?h--:$.get(s)>$.get(r)?(y.add(s),_(t)):(w.add(r),h--):(l(n,o),h--)}for(;h--;){const t=e[h];v.has(t.key)||l(t,o)}for(;p;)_(m[p-1]);return m}function Ls(e){e&&e.c()}function Ts(e,t,n){const{fragment:s,on_mount:r,on_destroy:a,after_update:o}=e.$$;s&&s.m(t,n),bs(()=>{const t=r.map(qn).filter(Un);a?a.push(...t):Bn(t),e.$$.on_mount=[]}),o.forEach(bs)}function Fs(e,t){const n=e.$$;null!==n.fragment&&(Bn(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Is(e,t){-1===e.$$.dirty[0]&&(ms.push(e),_s||(_s=!0,ys.then(xs)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Rs(e,t,n,s,r,a,o=[-1]){const i=ps;fs(e);const l=t.props||{},c=e.$$={fragment:null,ctx:null,props:a,update:Pn,not_equal:r,bound:Jn(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(i?i.$$.context:[]),callbacks:Jn(),dirty:o};let u=!1;c.ctx=n?n(e,l,(t,n,s=n)=>(c.ctx&&r(c.ctx[t],c.ctx[t]=s)&&(c.bound[t]&&c.bound[t](s),u&&Is(e,t)),n)):[],c.update(),u=!0,Bn(c.before_update),c.fragment=!!s&&s(c.ctx),t.target&&(t.hydrate?c.fragment&&c.fragment.l(function(e){return Array.from(e.childNodes)}(t.target)):c.fragment&&c.fragment.c(),t.intro&&js(e.$$.fragment),Ts(e,t.target,t.anchor),xs()),fs(i)}class Ws{$destroy(){Fs(this,1),this.$destroy=Pn}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}const Ds={},Ps=e=>{qs.set(Ds[e])},qs=y(!1);let Js;window.addEventListener("contextmenu",e=>(e.preventDefault(),!1));let Bs,Us={};const Hs={home:{repeat:!0,fn:()=>Js.home||Bs},up:{repeat:!0},down:{repeat:!0},pagedown:{repeat:!0,alias:"page_down"},pageup:{repeat:!0,alias:"page_up"},cancel:{},insert:{},delete:{alias:"del"},left:{},right:{},confirm:{alias:"click"}};fe.listen(()=>{if(!Js)return;const e=Sn.get();let t;if(Object.entries(Hs).forEach(([n,{repeat:s,fn:r,alias:a}])=>{a=a||n,e[n]&&Js[a]&&(!s&&Us[n]||(t=r?r():"function"!=typeof Js[a]?Js[a]:Js[a]()))}),Us={...e},!t)return;const n=Ds[t];n&&(n.scrollIntoView({block:"center"}),qs.set(n))});qs.listen(e=>{Js&&(Js.classList&&Js.classList.remove("nav"),Js=!1),e&&(Js=e,e.focus&&(e.focus(),e.classList.add("nav")))});var Gs=(e,t)=>{const{id:n,origin:s=!1}=t;e.id=n;const r={update:({up:t,down:n,page_up:s,page_down:r,insert:a,del:o,left:i,right:l})=>{e.up=t||e.up,e.left=i||e.left,e.right=l||e.right,e.down=n||e.down,e.page_down=r||e.page_down,e.page_up=s||e.page_up,e.insert=a||e.insert,e.del=o||e.del},destroy:()=>{e.removeEventListener("mousedown",a),delete Ds[n]}};r.update(t),Ds[n]=e,"sys"===n&&!1===qs.get()&&qs.set(e),e.style.transition="all 250ms linear";const a=(t=!1)=>{if(qs.set(e),3===t.which)return t.preventDefault(),t.stopPropagation(),void(e.insert&&e.insert());2===t.which&&e.del&&e.del()};return e.addEventListener("mousedown",a),s&&(Bs=n,a()),r};function Ys(e){let t,n;return{c(){t=ns("input"),ls(t,"type","text"),ls(t,"class","omni svelte-brjjhm"),ds(t,"border","0.25rem solid "+e[2]),ls(t,"placeholder",e[1]),n=[is(t,"input",e[11]),is(t,"keydown",e[12]),is(t,"blur",e[3])]},m(n,s){es(n,t,s),us(t,e[0])},p(e,[n]){4&n&&ds(t,"border","0.25rem solid "+e[2]),2&n&&ls(t,"placeholder",e[1]),1&n&&t.value!==e[0]&&us(t,e[0])},i:Pn,o:Pn,d(e){e&&ts(t),Bn(n)}}}function Vs(e,t,n){let s,r;Yn(e,fe,e=>n(7,s=e)),Yn(e,B,e=>n(2,r=e));let{command:a=(()=>{})}=t,{system:o=!1}=t,i="";const l=o?"!":"! > + -";let c=l;const u=(e,t)=>{if(t.length<20)return c;const n=Math.floor(e/2)%t.length;return t.slice(-n)+t.slice(0,-n)},d={"!":()=>{n(6,c=o?"SYSTEM CAN ONLY FILTER!!! ":"[ADD]+Name [MOVE]~Name/Name [DELETE]-Name")},undefined:()=>{n(6,c=l)}},h=()=>{const e=[i[0],...i.slice(1).split("/")];if(n(0,i=""),o)return d["!"]();d[e[0]]&&d[e[0]](e),a(e,e=>{n(6,c=e)})};let p;return e.$set=e=>{"command"in e&&n(4,a=e.command),"system"in e&&n(5,o=e.system)},e.$$.update=()=>{192&e.$$.dirty&&n(1,p=u(s,c))},[i,p,r,h,a,o,c,s,l,u,d,function(){i=this.value,n(0,i)},e=>{13===e.which&&h()}]}class Xs extends Ws{constructor(e){super(),Rs(this,e,Vs,Ys,Hn,{command:4,system:5})}}function Ks(e){return{c:Pn,m:Pn,p:Pn,d:Pn}}function Zs(e){let t,n;return{c(){t=ns("img"),ls(t,"class","tileset svelte-1jo87w8"),ls(t,"alt","tileset image"),t.src!==(n=e[7])&&ls(t,"src",n)},m(e,n){es(e,t,n)},p(e,s){1&s&&t.src!==(n=e[7])&&ls(t,"src",n)},d(e){e&&ts(t)}}}function Qs(e){return{c:Pn,m:Pn,p:Pn,d:Pn}}function er(e){let t,n,s={ctx:e,current:null,token:null,pending:Qs,then:Zs,catch:Ks,value:7};return Ms(n=e[0],s),{c(){t=os(),s.block.c()},m(e,n){es(e,t,n),s.block.m(e,s.anchor=n),s.mount=()=>t.parentNode,s.anchor=t},p(t,[r]){if(e=t,s.ctx=e,1&r&&n!==(n=e[0])&&Ms(n,s));else{const t=e.slice();t[7]=s.resolved,s.block.p(t,r)}},i:Pn,o:Pn,d(e){e&&ts(t),s.block.d(e),s.token=null,s=null}}}function tr(e,t,n){let s,r,{data:a=""}=t,{width:o=10}=t,{height:i=7}=t,{random:l=!1}=t,{text:c=!1}=t;return e.$set=e=>{"data"in e&&n(1,a=e.data),"width"in e&&n(2,o=e.width),"height"in e&&n(3,i=e.height),"random"in e&&n(4,l=e.random),"text"in e&&n(5,c=e.text)},e.$$.update=()=>{34&e.$$.dirty&&n(6,s=c?V(c):a),92&e.$$.dirty&&n(0,r=Te({width:o,height:i,data:s,random:l}))},[r,a,o,i,l,c]}class nr extends Ws{constructor(e){super(),Rs(this,e,tr,er,Hn,{data:1,width:2,height:3,random:4,text:5})}}function sr(e){let t,n;const s=new nr({props:{width:1,height:1,text:e[0]}});return{c(){t=ns("div"),Ls(s.$$.fragment),ls(t,"class","postage svelte-1qad2nn"),hs(t,"isrunning",e[4]),hs(t,"isrezed",e[6]),hs(t,"issystem",e[5])},m(e,r){es(e,t,r),Ts(s,t,null),n=!0},p(e,[n]){const r={};1&n&&(r.text=e[0]),s.$set(r),16&n&&hs(t,"isrunning",e[4]),64&n&&hs(t,"isrezed",e[6]),32&n&&hs(t,"issystem",e[5])},i(e){n||(js(s.$$.fragment,e),n=!0)},o(e){As(s.$$.fragment,e),n=!1},d(e){e&&ts(t),Fs(s)}}}function rr(e,t,n){let s,r,a,o=Pn,i=Pn,l=Pn;e.$$.on_destroy.push(()=>o()),e.$$.on_destroy.push(()=>i()),e.$$.on_destroy.push(()=>l());let{address:c=""}=t;const[,u,d]=c.split("/");let h,p,f,g,m,v,$,w,y;return e.$set=e=>{"address"in e&&n(0,c=e.address)},e.$$.update=()=>{128&e.$$.dirty&&(n(2,f=p.names),o(),o=Gn(f,e=>n(9,s=e))),128&e.$$.dirty&&(n(3,g=p.rezed),l(),l=Gn(g,e=>n(12,a=e))),512&e.$$.dirty&&n(8,m=s[d]),256&e.$$.dirty&&n(10,v=m?m.id.get():""),2048&e.$$.dirty&&n(4,$=!0===r[u]),5120&e.$$.dirty&&n(6,y=a[v])},n(1,h=Wheel.running),i(),i=Gn(h,e=>n(11,r=e)),n(7,p=Wheel.get(u)||Wheel.get(Wheel.SYSTEM)),n(5,w=u===Wheel.SYSTEM),[c,h,f,g,$,w,y]}class ar extends Ws{constructor(e){super(),Rs(this,e,rr,sr,Hn,{address:0})}}function or(e){let t,n,s,r={ctx:e,current:null,token:null,pending:cr,then:lr,catch:ir,value:13};return Ms(n=Pe(e[0].name.get()),r),{c(){t=ns("div"),r.block.c(),ls(t,"class","save svelte-1gi8jdd"),s=is(t,"click",e[2])},m(e,n){es(e,t,n),r.block.m(t,r.anchor=null),r.mount=()=>t,r.anchor=null},p(t,s){if(e=t,r.ctx=e,1&s&&n!==(n=Pe(e[0].name.get()))&&Ms(n,r));else{const t=e.slice();t[13]=r.resolved,r.block.p(t,s)}},d(e){e&&ts(t),r.block.d(),r.token=null,r=null,s()}}}function ir(e){return{c:Pn,m:Pn,p:Pn,d:Pn}}function lr(e){let t,n;return{c(){t=ns("img"),t.src!==(n=e[13])&&ls(t,"src",n),ls(t,"alt","save"),ls(t,"class","svelte-1gi8jdd")},m(e,n){es(e,t,n)},p(e,s){1&s&&t.src!==(n=e[13])&&ls(t,"src",n)},d(e){e&&ts(t)}}}function cr(e){return{c:Pn,m:Pn,p:Pn,d:Pn}}function ur(e){let t,n,s,r,a,o;const i=new ar({props:{address:`/${e[5]}`}}),l=e[12].default,c=Vn(l,e,e[11],null);let u=e[5]!==Wheel.SYSTEM&&or(e);return{c(){t=ns("div"),n=ns("div"),Ls(i.$$.fragment),s=as(),c&&c.c(),r=as(),u&&u.c(),ls(n,"class","postage svelte-1gi8jdd"),ls(t,"class","controls svelte-1gi8jdd"),o=is(n,"click",e[1])},m(e,o){es(e,t,o),Qn(t,n),Ts(i,n,null),Qn(t,s),c&&c.m(t,null),Qn(t,r),u&&u.m(t,null),a=!0},p(e,[n]){const s={};32&n&&(s.address=`/${e[5]}`),i.$set(s),c&&c.p&&2048&n&&c.p(Xn(l,e,e[11],null),Kn(l,e[11],n,null)),e[5]!==Wheel.SYSTEM?u?u.p(e,n):(u=or(e),u.c(),u.m(t,null)):u&&(u.d(1),u=null)},i(e){a||(js(i.$$.fragment,e),js(c,e),a=!0)},o(e){As(i.$$.fragment,e),As(c,e),a=!1},d(e){e&&ts(t),Fs(i),c&&c.d(e),u&&u.d(),o()}}}function dr(e,t,n){let s,r,a,o,i=Pn,l=Pn;Yn(e,B,e=>n(9,a=e)),Yn(e,D,e=>n(10,o=e)),e.$$.on_destroy.push(()=>i()),e.$$.on_destroy.push(()=>l());let{weave:c}=t;let u,d,h,p,{$$slots:f={},$$scope:g}=t;return e.$set=e=>{"weave"in e&&n(0,c=e.weave),"$$scope"in e&&n(11,g=e.$$scope)},e.$$.update=()=>{1&e.$$.dirty&&(n(3,u=c.name),l(),l=Gn(u,e=>n(5,r=e))),129&e.$$.dirty&&(h=s[c.name.get()]),1536&e.$$.dirty&&(p=`border: 0.25rem solid ${a}; background-color: ${o};`)},n(4,d=Wheel.running),i(),i=Gn(d,e=>n(7,s=e)),[c,e=>{e&&(e.stopPropagation(),e.preventDefault()),h?Wheel.stop(r):Wheel.start(r),h=!h},e=>{e&&(e.preventDefault(),e.stopPropagation()),Re(c)},u,d,r,h,s,p,a,o,g,f]}class hr extends Ws{constructor(e){super(),Rs(this,e,dr,ur,Hn,{weave:0,toggle:1,save_it:2})}get toggle(){return this.$$.ctx[1]}get save_it(){return this.$$.ctx[2]}}var pr=(t,n)=>{const s={update:n=>{const s=e(D.get()),r=e(G(JSON.stringify(n))).blend(s,.8);t.style.backgroundColor=r.toCSS()}};return s.update(n),s};const fr=(t,n)=>{const s=()=>{t.style.backgroundColor=e(G(JSON.stringify(n))).blend(e(D.get()),.8).darkenByRatio(.2)};return s(),{update:s}};function gr(e){let t,n,s,r,a,o,i,l,c,u,d,h,p,f,g,m,v,$=`~~${e[5]}~~`+"",w=e[1]+1+"",y=e[2].length+"";const _=e[11].default,b=Vn(_,e,e[10],null);return{c(){t=ns("div"),n=ns("div"),s=ns("div"),s.textContent="<",a=as(),o=ns("div"),i=rs($),l=rs(" : "),c=rs(w),u=rs(" : "),d=rs(y),h=as(),p=ns("div"),p.textContent=">",g=as(),b&&b.c(),ls(s,"class","button svelte-8194ou"),ls(o,"class","flex svelte-8194ou"),ls(p,"class","button svelte-8194ou"),ls(n,"class","navigation svelte-8194ou"),ds(n,"background-color",e[4]),ls(t,"class","sub_space svelte-8194ou"),v=[is(s,"click",e[12]),Zn(r=pr.call(null,s,e[5])),Zn(f=pr.call(null,p,e[5])),is(p,"click",e[13])]},m(e,r){es(e,t,r),Qn(t,n),Qn(n,s),Qn(n,a),Qn(n,o),Qn(o,i),Qn(o,l),Qn(o,c),Qn(o,u),Qn(o,d),Qn(n,h),Qn(n,p),Qn(t,g),b&&b.m(t,null),m=!0},p(e,[t]){r&&Un(r.update)&&32&t&&r.update.call(null,e[5]),(!m||32&t)&&$!==($=`~~${e[5]}~~`+"")&&cs(i,$),(!m||2&t)&&w!==(w=e[1]+1+"")&&cs(c,w),(!m||4&t)&&y!==(y=e[2].length+"")&&cs(d,y),f&&Un(f.update)&&32&t&&f.update.call(null,e[5]),(!m||16&t)&&ds(n,"background-color",e[4]),b&&b.p&&1024&t&&b.p(Xn(_,e,e[10],null),Kn(_,e[10],t,null))},i(e){m||(js(b,e),m=!0)},o(e){As(b,e),m=!1},d(e){e&&ts(t),b&&b.d(e),Bn(v)}}}function mr(e,t,n){let s,r,a,o=Pn,i=()=>(o(),o=Gn(u,e=>n(2,s=e)),u),l=Pn;Yn(e,B,e=>n(4,r=e)),e.$$.on_destroy.push(()=>o()),e.$$.on_destroy.push(()=>l());let{weave:c}=t,{birds:u=$([])}=t;i();let{set_bird:d}=t,h=0,p=!1,{$$slots:f={},$$scope:g}=t;let m,v;return e.$set=e=>{"weave"in e&&n(6,c=e.weave),"birds"in e&&i(n(0,u=e.birds)),"set_bird"in e&&n(7,d=e.set_bird),"$$scope"in e&&n(10,g=e.$$scope)},e.$$.update=()=>{70&e.$$.dirty&&n(9,m=c.get_id(s[h])),966&e.$$.dirty&&(!1===p&&n(8,p=m),m&&m!==p&&(n(9,m.birdex=h,m),d(m),n(8,p=m)),m||requestAnimationFrame(()=>{n(9,m=c.get_id(s[h]))})),512&e.$$.dirty&&(n(3,v=m?m.name():$("")),l(),l=Gn(v,e=>n(5,a=e)))},[u,h,s,v,r,a,c,d,p,m,g,f,()=>{let e=h-1;e<0&&(e=s.length-1),void 0===s.length&&(e=0),n(1,h=e)},()=>{let e=h+1;void 0===s.length&&(e=0),e>=s.length&&(e=0),n(1,h=e)}]}class vr extends Ws{constructor(e){super(),Rs(this,e,mr,gr,Hn,{weave:6,birds:0,set_bird:7})}}function $r(e){let t,n,s,r,a;return{c(){t=ns("div"),n=ns("div"),ls(n,"class","cursor svelte-prlsd3"),ds(n,"transform","translate("+e[2]+"px,"+e[3]+"px)"),ls(t,"class","edit svelte-prlsd3"),ls(t,"style",s=[`background-image: url('${e[6]}');`,`background-color: ${e[7]};`,`border: 1rem solid ${e[8]};`].join("")),a=[Zn(r=e[12].call(null,t)),is(t,"click",e[24]),is(t,"mousemove",e[9])]},m(s,r){es(s,t,r),Qn(t,n),e[23](t)},p(e,r){12&r&&ds(n,"transform","translate("+e[2]+"px,"+e[3]+"px)"),448&r&&s!==(s=[`background-image: url('${e[6]}');`,`background-color: ${e[7]};`,`border: 1rem solid ${e[8]};`].join(""))&&ls(t,"style",s)},d(n){n&&ts(t),e[23](null),Bn(a)}}}function wr(e){let t;const n=new nr({props:{width:1,height:1,data:JSON.stringify(e[5])}});return{c(){Ls(n.$$.fragment)},m(e,s){Ts(n,e,s),t=!0},p(e,t){const s={};32&t&&(s.data=JSON.stringify(e[5])),n.$set(s)},i(e){t||(js(n.$$.fragment,e),t=!0)},o(e){As(n.$$.fragment,e),t=!1},d(e){Fs(n,e)}}}function yr(e){let t,n,s,r,a=e[0]&&$r(e),o=e[1]&&wr(e);return{c(){a&&a.c(),t=as(),n=ns("div"),o&&o.c(),ls(n,"class","tile svelte-prlsd3"),r=[is(window,"click",e[11]),is(n,"click",e[25])]},m(e,r){a&&a.m(e,r),es(e,t,r),es(e,n,r),o&&o.m(n,null),s=!0},p(e,[s]){e[0]?a?a.p(e,s):(a=$r(e),a.c(),a.m(t.parentNode,t)):a&&(a.d(1),a=null),e[1]?o?(o.p(e,s),js(o,1)):(o=wr(e),o.c(),js(o,1),o.m(n,null)):o&&(Os(),As(o,1,1,()=>{o=null}),Ss())},i(e){s||(js(o),s=!0)},o(e){As(o),s=!1},d(e){a&&a.d(e),e&&ts(t),e&&ts(n),o&&o.d(),Bn(r)}}}function _r(e,t,n){let s,r,a,o,i,l,c=Pn,u=()=>(c(),c=Gn(h,e=>n(5,s=e)),h);Yn(e,R,e=>n(18,r=e)),Yn(e,Sn,e=>n(19,a=e)),Yn(e,S,e=>n(6,o=e)),Yn(e,D,e=>n(7,i=e)),Yn(e,B,e=>n(8,l=e)),e.$$.on_destroy.push(()=>c());let{back:d=!1}=t,{value:h}=t;u();let{editing:p=!1}=t;let f,g=s%r,m=Math.floor(s/r),v=0,$=0;const w=(e,t)=>{const n=Math.round((e-t)/t);return Math.max(0,Math.min(n,r-1))},y=e=>{const[t,n]=[e.target.clientWidth/2,e.target.clientHeight/2];return[e.layerX+t,e.layerY+n]},_=e=>{n(2,[v,$]=y(e),v,n(3,$)),b()},b=()=>{h.set(w(v,f)+w($,f)*r),n(0,p=!1)};let x;return e.$set=e=>{"back"in e&&n(13,d=e.back),"value"in e&&u(n(1,h=e.value)),"editing"in e&&n(0,p=e.editing)},[p,h,v,$,x,s,o,i,l,e=>{f=x.clientWidth/r;const[t,s]=y(e);g=w(t,f),n(2,v=g*f),m=w(s,f),n(3,$=m*f)},_,()=>{p&&n(0,p=!1)},()=>{const e=fe.listen(()=>{x&&(f=x.clientWidth/r,0===v&&0===$&&(n(2,v=g*f),n(3,$=m*f))),void 0!==f&&(a.left&&n(2,v=(0===g?r-1:g--)*f),a.right&&n(2,v=(g===r-1?0:g++)*f),a.up&&n(3,$=(0===m?r-1:m--)*f),a.down&&n(3,$=(m===r-1?0:m++)*f))});return{destroy(){e()}}},d,()=>(b(),d),g,m,f,r,a,w,y,b,function(e){vs[e?"unshift":"push"](()=>{n(4,x=e)})},e=>{e.preventDefault(),e.stopPropagation(),_(e)},e=>{e.preventDefault(),e.stopPropagation(),n(0,p=!p)}]}class br extends Ws{constructor(e){super(),Rs(this,e,_r,yr,Hn,{back:13,value:1,editing:0,click:14})}get click(){return this.$$.ctx[14]}}function xr(e){let t,n;return{c(){t=ns("div"),ls(t,"class","dopick svelte-e0axn4"),ds(t,"background-color",e[3](e[2])),n=[is(t,"click",e[7]),is(t,"mousemove",e[5])]},m(e,n){es(e,t,n)},p(e,n){4&n&&ds(t,"background-color",e[3](e[2]))},d(e){e&&ts(t),Bn(n)}}}function kr(e){let t,n,s,r=e[0]&&xr(e);return{c(){r&&r.c(),t=as(),n=ns("div"),ls(n,"type","color"),ds(n,"background-color",e[3](e[2])),ls(n,"class","picker svelte-e0axn4"),s=[is(window,"click",e[6]),is(n,"click",e[4])]},m(e,s){r&&r.m(e,s),es(e,t,s),es(e,n,s)},p(e,[s]){e[0]?r?r.p(e,s):(r=xr(e),r.c(),r.m(t.parentNode,t)):r&&(r.d(1),r=null),4&s&&ds(n,"background-color",e[3](e[2]))},i:Pn,o:Pn,d(e){r&&r.d(e),e&&ts(t),e&&ts(n),Bn(s)}}}function Er(t,n,s){let r,a=Pn,o=()=>(a(),a=Gn(i,e=>s(2,r=e)),i);t.$$.on_destroy.push(()=>a());let{value:i}=n;o();let{editing:l=!1}=n;return t.$set=e=>{"value"in e&&o(s(1,i=e.value)),"editing"in e&&s(0,l=e.editing)},[l,i,r,t=>e([t>>16&255,t>>8&255,255&t]).toCSS(),e=>{e.preventDefault(),e.stopPropagation(),s(0,l=!0)},({x:t,y:n,target:s})=>{const{top:r,left:a,width:o,height:i}=s.getBoundingClientRect(),l=(t-a)/o,c=(n-r)/i,{red:u,green:d,blue:h}=e({hue:l,lightness:c,saturation:1}).toRGB(),p=[u,d,h].map(e=>Math.round(255*e));console.log(p)},()=>{l&&s(0,l=!1)},e=>{e.preventDefault(),e.stopPropagation(),s(0,l=!1)}]}class zr extends Ws{constructor(e){super(),Rs(this,e,Er,kr,Hn,{value:1,editing:0})}}function Or(e){let t,n,s,r;return{c(){t=ns("textarea"),ls(t,"spellcheck","false"),ls(t,"class","edit svelte-18o22ik"),ls(t,"type","text"),ls(t,"style",n=`background-color: ${e[3]}; border:0.5rem solid ${e[4]};`),r=[Zn(s=e[5].call(null,t)),is(t,"input",e[10]),is(t,"click",Sr),is(t,"keydown",e[11]),is(t,"blur",e[12])]},m(n,s){es(n,t,s),us(t,e[0])},p(e,[s]){24&s&&n!==(n=`background-color: ${e[3]}; border:0.5rem solid ${e[4]};`)&&ls(t,"style",n),1&s&&us(t,e[0])},i:Pn,o:Pn,d(e){e&&ts(t),Bn(r)}}}const Sr=e=>e.stopPropagation();function jr(e,t,n){let s,r;Yn(e,D,e=>n(3,s=e)),Yn(e,B,e=>n(4,r=e));let{code:a}=t,{weave:o}=t,{address:i}=t,{right:l}=t,{ondone:c=(()=>{})}=t;let u=!0;const d=()=>{u&&(n(2,u=!1),oe({code:a,weave:o,address:i,right:l}),c())};return e.$set=e=>{"code"in e&&n(0,a=e.code),"weave"in e&&n(7,o=e.weave),"address"in e&&n(8,i=e.address),"right"in e&&n(9,l=e.right),"ondone"in e&&n(1,c=e.ondone)},[a,c,u,s,r,e=>requestAnimationFrame(()=>e.focus()),d,o,i,l,function(){a=this.value,n(0,a)},e=>{if("end"===e.key.toLowerCase())return e.preventDefault(),e.stopPropagation(),n(2,u=!1),void c();e.ctrlKey&&13===e.which&&(d(),e.preventDefault(),e.stopPropagation())},e=>{d()}]}class Ar extends Ws{constructor(e){super(),Rs(this,e,jr,Or,Hn,{code:0,weave:7,address:8,right:9,ondone:1})}}function Mr(e){let t,n;return{c(){t=ns("div"),n=rs(e[4]),ls(t,"data:type",e[5]),ls(t,"class","pad svelte-1mgajz0")},m(e,s){es(e,t,s),Qn(t,n)},p(e,s){16&s&&cs(n,e[4]),32&s&&ls(t,"data:type",e[5])},i:Pn,o:Pn,d(e){e&&ts(t)}}}function Nr(e){let t,n;var s=e[6][e[5]];function r(e){return{props:{value:e[1].value}}}if(s)var a=new s(r(e));return{c(){a&&Ls(a.$$.fragment),t=os()},m(e,s){a&&Ts(a,e,s),es(e,t,s),n=!0},p(e,n){const o={};if(2&n&&(o.value=e[1].value),s!==(s=e[6][e[5]])){if(a){Os();const e=a;As(e.$$.fragment,1,0,()=>{Fs(e,1)}),Ss()}s?(Ls((a=new s(r(e))).$$.fragment),js(a.$$.fragment,1),Ts(a,t.parentNode,t)):a=null}else s&&a.$set(o)},i(e){n||(a&&js(a.$$.fragment,e),n=!0)},o(e){a&&As(a.$$.fragment,e),n=!1},d(e){e&&ts(t),a&&Fs(a,e)}}}function Cr(e){let t,n,s,r,a,o;const i=[Nr,Mr],l=[];function c(e,t){return e[6][e[5]]?0:1}return n=c(e),s=l[n]=i[n](e),{c(){t=ns("div"),s.c(),ls(t,"class","warp svelte-1mgajz0"),hs(t,"changed",e[0]),o=Zn(r=e[7].call(null,t,e[2]))},m(e,s){es(e,t,s),l[n].m(t,null),a=!0},p(e,[a]){let o=n;n=c(e),n===o?l[n].p(e,a):(Os(),As(l[o],1,1,()=>{l[o]=null}),Ss(),s=l[n],s||(s=l[n]=i[n](e),s.c()),js(s,1),s.m(t,null)),r&&Un(r.update)&&4&a&&r.update.call(null,e[2]),1&a&&hs(t,"changed",e[0])},i(e){a||(js(s),a=!0)},o(e){As(s),a=!1},d(e){e&&ts(t),l[n].d(),o()}}}function Lr(e,t,n){let s,r,a=Pn,o=Pn;e.$$.on_destroy.push(()=>a()),e.$$.on_destroy.push(()=>o());let{id:i}=t,{weave:l}=t;const c={sprite:br,color:zr};let u=!1;let d,h,p,f;return e.$set=e=>{"id"in e&&n(8,i=e.id),"weave"in e&&n(9,l=e.weave)},e.$$.update=()=>{768&e.$$.dirty&&n(1,d=l.get_id(i)),2&e.$$.dirty&&(n(2,h=d&&d.value||$("unknown")),a(),a=Gn(h,e=>n(10,s=e))),2&e.$$.dirty&&(n(3,p=d&&d.type||$("unknown")),o(),o=Gn(p,e=>n(5,r=e))),1792&e.$$.dirty&&n(4,f=le(i,l))},[u,d,h,p,f,r,c,(e,t)=>({destroy:t.listen(()=>{n(0,u=!0),setTimeout(()=>{n(0,u=!1)},250)})}),i,l]}class Tr extends Ws{constructor(e){super(),Rs(this,e,Lr,Cr,Hn,{id:8,weave:9})}}function Fr(e,t,n){const s=e.slice();return s[21]=t[n],s}function Ir(e){let t;const n=new Ar({props:{code:e[6],ondone:e[11],weave:e[0],address:e[7],right:e[2]}});return{c(){Ls(n.$$.fragment)},m(e,s){Ts(n,e,s),t=!0},p(e,t){const s={};64&t&&(s.code=e[6]),1&t&&(s.weave=e[0]),128&t&&(s.address=e[7]),4&t&&(s.right=e[2]),n.$set(s)},i(e){t||(js(n.$$.fragment,e),t=!0)},o(e){As(n.$$.fragment,e),t=!1},d(e){Fs(n,e)}}}function Rr(e){let t,n,s,r,a=e[5].length>0&&Dr(e);function o(e,t){return e[5].length>0?Jr:qr}let i=o(e),l=i(e);return{c(){a&&a.c(),t=as(),n=ns("div"),l.c(),ls(n,"class","cap svelte-1j3z045"),r=is(n,"click",e[3])},m(e,r){a&&a.m(e,r),es(e,t,r),es(e,n,r),l.m(n,null),s=!0},p(e,s){e[5].length>0?a?(a.p(e,s),js(a,1)):(a=Dr(e),a.c(),js(a,1),a.m(t.parentNode,t)):a&&(Os(),As(a,1,1,()=>{a=null}),Ss()),i===(i=o(e))&&l?l.p(e,s):(l.d(1),l=i(e),l&&(l.c(),l.m(n,null)))},i(e){s||(js(a),s=!0)},o(e){As(a),s=!1},d(e){a&&a.d(e),e&&ts(t),e&&ts(n),l.d(),r()}}}function Wr(e){let t;function n(e,t){return e[5].length>0?Ur:Br}let s=n(e),r=s(e);return{c(){t=ns("div"),r.c(),ls(t,"class","cap svelte-1j3z045"),hs(t,"nothread",e[1])},m(e,n){es(e,t,n),r.m(t,null)},p(e,a){s===(s=n(e))&&r?r.p(e,a):(r.d(1),r=s(e),r&&(r.c(),r.m(t,null))),2&a&&hs(t,"nothread",e[1])},i:Pn,o:Pn,d(e){e&&ts(t),r.d()}}}function Dr(e){let t,n,s,r=e[5],a=[];for(let t=0;t<r.length;t+=1)a[t]=Pr(Fr(e,r,t));const o=e=>As(a[e],1,1,()=>{a[e]=null});return{c(){t=ns("div");for(let e=0;e<a.length;e+=1)a[e].c();ls(t,"class","spot svelte-1j3z045"),hs(t,"right",e[2]),s=is(t,"click",e[3])},m(e,s){es(e,t,s);for(let e=0;e<a.length;e+=1)a[e].m(t,null);n=!0},p(e,n){if(1569&n){let s;for(r=e[5],s=0;s<r.length;s+=1){const o=Fr(e,r,s);a[s]?(a[s].p(o,n),js(a[s],1)):(a[s]=Pr(o),a[s].c(),js(a[s],1),a[s].m(t,null))}for(Os(),s=r.length;s<a.length;s+=1)o(s);Ss()}4&n&&hs(t,"right",e[2])},i(e){if(!n){for(let e=0;e<r.length;e+=1)js(a[e]);n=!0}},o(e){a=a.filter(Boolean);for(let e=0;e<a.length;e+=1)As(a[e]);n=!1},d(e){e&&ts(t),function(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}(a,e),s()}}}function Pr(e){let t,n,s,r,a,o,i;const l=new Tr({props:{weave:e[0],id:e[21]}});return{c(){t=ns("div"),Ls(l.$$.fragment),s=as(),r=ns("div"),a=rs(">\r\n\t\t\t"),ls(t,"class","thread svelte-1j3z045"),ls(t,"style",e[9]),hs(t,"active",e[10]),ls(r,"class","after-thread svelte-1j3z045"),ls(r,"style",e[9]),hs(r,"active",e[10]),i=Zn(n=pr.call(null,t,le(e[21],e[0])))},m(e,n){es(e,t,n),Ts(l,t,null),es(e,s,n),es(e,r,n),Qn(r,a),o=!0},p(s,a){e=s;const i={};1&a&&(i.weave=e[0]),32&a&&(i.id=e[21]),l.$set(i),(!o||512&a)&&ls(t,"style",e[9]),n&&Un(n.update)&&33&a&&n.update.call(null,le(e[21],e[0])),1024&a&&hs(t,"active",e[10]),(!o||512&a)&&ls(r,"style",e[9]),1024&a&&hs(r,"active",e[10])},i(e){o||(js(l.$$.fragment,e),o=!0)},o(e){As(l.$$.fragment,e),o=!1},d(e){e&&ts(t),Fs(l),e&&ts(s),e&&ts(r),i()}}}function qr(e){let t;return{c(){t=rs("")},m(e,n){es(e,t,n)},p:Pn,d(e){e&&ts(t)}}}function Jr(e){let t,n=e[5].length+"";return{c(){t=rs(n)},m(e,n){es(e,t,n)},p(e,s){32&s&&n!==(n=e[5].length+"")&&cs(t,n)},d(e){e&&ts(t)}}}function Br(e){let t;return{c(){t=rs("")},m(e,n){es(e,t,n)},p:Pn,d(e){e&&ts(t)}}}function Ur(e){let t,n=e[5].length+"";return{c(){t=rs(n)},m(e,n){es(e,t,n)},p(e,s){32&s&&n!==(n=e[5].length+"")&&cs(t,n)},d(e){e&&ts(t)}}}function Hr(e){let t,n,s,r,a,o=e[4]&&Ir(e);const i=[Wr,Rr],l=[];function c(e,t){return e[1]?0:1}return n=c(e),s=l[n]=i[n](e),{c(){o&&o.c(),t=as(),s.c(),r=os()},m(e,s){o&&o.m(e,s),es(e,t,s),l[n].m(e,s),es(e,r,s),a=!0},p(e,[a]){e[4]?o?(o.p(e,a),js(o,1)):(o=Ir(e),o.c(),js(o,1),o.m(t.parentNode,t)):o&&(Os(),As(o,1,1,()=>{o=null}),Ss());let u=n;n=c(e),n===u?l[n].p(e,a):(Os(),As(l[u],1,1,()=>{l[u]=null}),Ss(),s=l[n],s||(s=l[n]=i[n](e),s.c()),js(s,1),s.m(r.parentNode,r))},i(e){a||(js(o),js(s),a=!0)},o(e){As(o),As(s),a=!1},d(e){o&&o.d(e),e&&ts(t),l[n].d(e),e&&ts(r)}}}function Gr(e,t,n){let s,r,a,o=Pn;Yn(e,fe,e=>n(17,r=e)),Yn(e,D,e=>n(18,a=e)),e.$$.on_destroy.push(()=>o());let i,{channel:l}=t,{space:c}=t,{weave:u}=t,{nothread:d}=t,{right:h=!1}=t,p=!1;const f=()=>h?u.chain(v,h).slice(0,-1):u.chain(v).slice(0,-1),g=()=>{n(5,i=f())};let m="";let v,$,w,y,_;return e.$set=e=>{"channel"in e&&n(12,l=e.channel),"space"in e&&n(13,c=e.space),"weave"in e&&n(0,u=e.weave),"nothread"in e&&n(1,d=e.nothread),"right"in e&&n(2,h=e.right)},e.$$.update=()=>{12288&e.$$.dirty&&n(7,v=`${c.id.get()}/${l[0]}`),4096&e.$$.dirty&&(n(8,$=l[1]),o(),o=Gn($,e=>n(14,s=e))),16384&e.$$.dirty&&g(),33&e.$$.dirty&&(w=i.map(e=>ae(e,u)).join(" => ")),e.$$.dirty,262144&e.$$.dirty&&n(9,y=[`background-color: ${a};`].join(""))},n(10,_=!1),[u,d,h,e=>{e&&(e.preventDefault(),e.stopPropagation()),u.name.get()!==Wheel.SYSTEM&&(p||(n(4,p=!0),n(6,m=ie(h?f().map(e=>ae(e,u)).reverse().join(" => "):f().map(e=>ae(e,u)).join(" => ")))))},p,i,m,v,$,y,!1,()=>{p&&(n(4,p=!1),g())},l,c]}class Yr extends Ws{constructor(e){super(),Rs(this,e,Gr,Hr,Hn,{channel:12,space:13,weave:0,nothread:1,right:2,do_edit:3})}get do_edit(){return this.$$.ctx[3]}}function Vr(e){let t,n,s;return{c(){t=ns("input"),ls(t,"class","edit svelte-ugahxz"),ls(t,"type","text"),ls(t,"placeholder","JSON PLZ"),s=[Zn(n=e[21].call(null,t)),is(t,"input",e[31]),is(t,"keydown",e[32]),is(t,"blur",e[33])]},m(n,s){es(n,t,s),us(t,e[7])},p(e,n){128&n[0]&&t.value!==e[7]&&us(t,e[7])},i:Pn,o:Pn,d(e){e&&ts(t),Bn(s)}}}function Xr(e){let t,n,s,r,a,o,i;const l=[ea,Qr,Zr],c=[];function u(e,t){return"sprite"===e[13]?0:"color"===e[13]?1:2}return a=u(e),o=c[a]=l[a](e),{c(){t=ns("div"),n=ns("div"),s=rs(e[13]),r=as(),o.c(),ls(n,"class","key svelte-ugahxz"),ls(t,"class","dataset svelte-ugahxz")},m(e,o){es(e,t,o),Qn(t,n),Qn(n,s),Qn(t,r),c[a].m(t,null),i=!0},p(e,n){(!i||8192&n[0])&&cs(s,e[13]);let r=a;a=u(e),a===r?c[a].p(e,n):(Os(),As(c[r],1,1,()=>{c[r]=null}),Ss(),o=c[a],o||(o=c[a]=l[a](e),o.c()),js(o,1),o.m(t,null))},i(e){i||(js(o),i=!0)},o(e){As(o),i=!1},d(e){e&&ts(t),c[a].d()}}}function Kr(e){let t,n;return{c(){t=ns("input"),ls(t,"type","text"),ls(t,"class","edit svelte-ugahxz"),t.autofocus=!0,n=[is(t,"input",e[27]),is(t,"keydown",e[28]),is(t,"blur",e[29])]},m(n,s){es(n,t,s),us(t,e[12]),t.focus()},p(e,n){4096&n[0]&&t.value!==e[12]&&us(t,e[12])},i:Pn,o:Pn,d(e){e&&ts(t),Bn(n)}}}function Zr(e){let t,n,s=JSON.stringify(e[15])+"";return{c(){t=ns("div"),n=rs(s),ls(t,"class","value svelte-ugahxz")},m(e,s){es(e,t,s),Qn(t,n)},p(e,t){32768&t[0]&&s!==(s=JSON.stringify(e[15])+"")&&cs(n,s)},i:Pn,o:Pn,d(e){e&&ts(t)}}}function Qr(e){let t,n,s;const r=new zr({props:{value:e[14],editing:na}});return{c(){Ls(r.$$.fragment),t=as(),n=ns("div"),ls(n,"class","flex svelte-ugahxz")},m(e,a){Ts(r,e,a),es(e,t,a),es(e,n,a),s=!0},p(e,t){const n={};16384&t[0]&&(n.value=e[14]),r.$set(n)},i(e){s||(js(r.$$.fragment,e),s=!0)},o(e){As(r.$$.fragment,e),s=!1},d(e){Fs(r,e),e&&ts(t),e&&ts(n)}}}function ea(e){let t,n,s,r={value:e[14],back:e[18],editing:e[8]};const a=new br({props:r});return e[30](a),{c(){Ls(a.$$.fragment),t=as(),n=ns("div"),ls(n,"class","flex svelte-ugahxz")},m(e,r){Ts(a,e,r),es(e,t,r),es(e,n,r),s=!0},p(e,t){const n={};16384&t[0]&&(n.value=e[14]),262144&t[0]&&(n.back=e[18]),256&t[0]&&(n.editing=e[8]),a.$set(n)},i(e){s||(js(a.$$.fragment,e),s=!0)},o(e){As(a.$$.fragment,e),s=!1},d(s){e[30](null),Fs(a,s),s&&ts(t),s&&ts(n)}}}function ta(e){let t,n,s,r,a,o,i,l,c,u,d={channel:e[3],space:e[0],weave:e[2],nothread:e[1]};const h=new Yr({props:d});e[26](h);const p=[Kr,Xr,Vr],f=[];function g(e,t){return e[6]?0:e[17]?2:1}s=g(e),r=f[s]=p[s](e);let m={channel:e[3],space:e[0],weave:e[2],nothread:e[1],right:!0};const v=new Yr({props:m});return e[34](v),{c(){t=ns("div"),Ls(h.$$.fragment),n=as(),r.c(),a=as(),Ls(v.$$.fragment),ls(t,"class",o="channel "+e[4]+" svelte-ugahxz"),u=[Zn(i=pr.call(null,t,e[0].name().get())),Zn(l=Gs.call(null,t,{...e[5],left:e[35],right:e[36],insert:e[37],del:e[38]})),is(t,"click",e[39])]},m(e,r){es(e,t,r),Ts(h,t,null),Qn(t,n),f[s].m(t,null),Qn(t,a),Ts(v,t,null),c=!0},p(e,n){const u={};8&n[0]&&(u.channel=e[3]),1&n[0]&&(u.space=e[0]),4&n[0]&&(u.weave=e[2]),2&n[0]&&(u.nothread=e[1]),h.$set(u);let d=s;s=g(e),s===d?f[s].p(e,n):(Os(),As(f[d],1,1,()=>{f[d]=null}),Ss(),r=f[s],r||(r=f[s]=p[s](e),r.c()),js(r,1),r.m(t,a));const m={};8&n[0]&&(m.channel=e[3]),1&n[0]&&(m.space=e[0]),4&n[0]&&(m.weave=e[2]),2&n[0]&&(m.nothread=e[1]),v.$set(m),(!c||16&n[0]&&o!==(o="channel "+e[4]+" svelte-ugahxz"))&&ls(t,"class",o),i&&Un(i.update)&&1&n[0]&&i.update.call(null,e[0].name().get()),l&&Un(l.update)&&9825&n[0]&&l.update.call(null,{...e[5],left:e[35],right:e[36],insert:e[37],del:e[38]})},i(e){c||(js(h.$$.fragment,e),js(r),js(v.$$.fragment,e),c=!0)},o(e){As(h.$$.fragment,e),As(r),As(v.$$.fragment,e),c=!1},d(n){n&&ts(t),e[26](null),Fs(h),f[s].d(),e[34](null),Fs(v),Bn(u)}}}const na=!1;function sa(e,t,n){let s,r,a=Pn;Yn(e,qs,e=>n(25,r=e)),e.$$.on_destroy.push(()=>a());let{space:o}=t,{nothread:i}=t,{weave:l}=t,{channel:c}=t,{side:u="in"}=t,{focus:d=!1}=t,{executed:h=(()=>{})}=t,{navi:p}=t,f=!1,g="";const m=()=>{n(17,O=!1),n(7,g="")},v=()=>{n(17,O=!1);try{E.set(Ye(g));const e=`${l.name.get()}/${E.get()}/!name`;"!name"===k&&r.id===S&&requestAnimationFrame(()=>{Ps(e)})}catch(e){}n(7,g=""),h()};let $,w,y,_,b=!1;const x=()=>{n(6,f=!1),""!==_&&(o.remove(k),o.write({[_]:E.get()}),requestAnimationFrame(()=>{Ps(`${o.address()}/${_}`),n(12,_="")}))};let k,E,z,O,S;return e.$set=e=>{"space"in e&&n(0,o=e.space),"nothread"in e&&n(1,i=e.nothread),"weave"in e&&n(2,l=e.weave),"channel"in e&&n(3,c=e.channel),"side"in e&&n(4,u=e.side),"focus"in e&&n(23,d=e.focus),"executed"in e&&n(24,h=e.executed),"navi"in e&&n(5,p=e.navi)},e.$$.update=()=>{8&e.$$.dirty[0]&&n(13,[k,E]=c,k,(n(14,E),a(),a=Gn(E,e=>n(16,s=e)),E)),65536&e.$$.dirty[0]&&n(15,z=s),8388608&e.$$.dirty[0]&&n(17,O=d),8193&e.$$.dirty[0]&&n(18,S=`${o.address()}/${k}`)},[o,i,l,c,u,p,f,g,b,$,w,y,_,k,E,z,s,O,S,m,v,e=>{requestAnimationFrame(()=>e.focus())},x,d,h,r,function(e){vs[e?"unshift":"push"](()=>{n(9,$=e)})},function(){_=this.value,n(12,_)},({which:e,code:t})=>{"End"!==t?13!==e&&"ControlRight"!==t||x():n(6,f=!1)},()=>{n(6,f=!1)},function(e){vs[e?"unshift":"push"](()=>{n(11,y=e)})},function(){g=this.value,n(7,g)},({which:e,code:t})=>{if("End"===t)return m();13!==e&&"ControlRight"!==t||v()},()=>{v()},function(e){vs[e?"unshift":"push"](()=>{n(10,w=e)})},()=>{$.do_edit()},()=>{w.do_edit()},()=>{n(6,f=!0)},()=>{"!name"!==k&&(o.remove(k),Ps("/"===p.down?p.up:p.down))},e=>{if("sprite"===k)return n(8,b=!0),void requestAnimationFrame(()=>{qs.set(y)});n(17,O=!0),n(7,g=JSON.stringify(s))}]}class ra extends Ws{constructor(e){super(),Rs(this,e,sa,ta,Hn,{space:0,nothread:1,weave:2,channel:3,side:4,focus:23,executed:24,navi:5},[-1,-1])}}function aa(e,t,n){const s=e.slice();return s[26]=t[n],s[4]=n,s}function oa(e){let t,n,s,r,a,o,i,l,c;const u=new ar({props:{address:`/${e[15]}/${e[14]}`}});return{c(){t=ns("div"),n=ns("div"),Ls(u.$$.fragment),s=as(),r=ns("div"),a=rs(e[14]),ls(n,"class","postage svelte-oq6z61"),ls(r,"class","name svelte-oq6z61"),ls(t,"class","space svelte-oq6z61"),hs(t,"open",ha),hs(t,"zero",0===e[4]),c=[is(n,"click",e[18]),Zn(o=pr.call(null,t,e[14])),Zn(i=Gs.call(null,t,{id:e[0].address(),up:e[3].up,left:e[18],down:e[11].length>0?`${e[0].address()}/${e[11][0][0]}`:e[3].down,page_up:e[3].page_up,page_down:e[3].down,del:e[23],insert:e[24]}))]},m(e,o){es(e,t,o),Qn(t,n),Ts(u,n,null),Qn(t,s),Qn(t,r),Qn(r,a),l=!0},p(e,n){const s={};49152&n&&(s.address=`/${e[15]}/${e[14]}`),u.$set(s),(!l||16384&n)&&cs(a,e[14]),o&&Un(o.update)&&16384&n&&o.update.call(null,e[14]),i&&Un(i.update)&&10251&n&&i.update.call(null,{id:e[0].address(),up:e[3].up,left:e[18],down:e[11].length>0?`${e[0].address()}/${e[11][0][0]}`:e[3].down,page_up:e[3].page_up,page_down:e[3].down,del:e[23],insert:e[24]}),0&n&&hs(t,"open",ha),16&n&&hs(t,"zero",0===e[4])},i(e){l||(js(u.$$.fragment,e),l=!0)},o(e){As(u.$$.fragment,e),l=!1},d(e){e&&ts(t),Fs(u),Bn(c)}}}function ia(e,t){let n,s;const r=new ra({props:{channel:t[26],space:t[0],weave:t[1],nothread:t[2],navi:t[17](t[4])}});return{key:e,first:null,c(){n=os(),Ls(r.$$.fragment),this.first=n},m(e,t){es(e,n,t),Ts(r,e,t),s=!0},p(e,t){const n={};2048&t&&(n.channel=e[26]),1&t&&(n.space=e[0]),2&t&&(n.weave=e[1]),4&t&&(n.nothread=e[2]),2048&t&&(n.navi=e[17](e[4])),r.$set(n)},i(e){s||(js(r.$$.fragment,e),s=!0)},o(e){As(r.$$.fragment,e),s=!1},d(e){e&&ts(n),Fs(r,e)}}}function la(e){let t;const n=new vr({props:{birds:e[10],weave:e[1],set_bird:e[25],$$slots:{default:[ua]},$$scope:{ctx:e}}});return{c(){Ls(n.$$.fragment)},m(e,s){Ts(n,e,s),t=!0},p(e,t){const s={};1024&t&&(s.birds=e[10]),2&t&&(s.weave=e[1]),268500994&t&&(s.$$scope={dirty:t,ctx:e}),n.$set(s)},i(e){t||(js(n.$$.fragment,e),t=!0)},o(e){As(n.$$.fragment,e),t=!1},d(e){Fs(n,e)}}}function ca(e){let t;const n=new fa({props:{weave:e[1],space:e[16],is_bird:!0}});return{c(){Ls(n.$$.fragment)},m(e,s){Ts(n,e,s),t=!0},p(e,t){const s={};2&t&&(s.weave=e[1]),65536&t&&(s.space=e[16]),n.$set(s)},i(e){t||(js(n.$$.fragment,e),t=!0)},o(e){As(n.$$.fragment,e),t=!1},d(e){Fs(n,e)}}}function ua(e){let t,n,s=e[16]&&ca(e);return{c(){s&&s.c(),t=os()},m(e,r){s&&s.m(e,r),es(e,t,r),n=!0},p(e,n){e[16]?s?(s.p(e,n),js(s,1)):(s=ca(e),s.c(),js(s,1),s.m(t.parentNode,t)):s&&(Os(),As(s,1,1,()=>{s=null}),Ss())},i(e){n||(js(s),n=!0)},o(e){As(s),n=!1},d(e){s&&s.d(e),e&&ts(t)}}}function da(e){let t,n,s,r,a=!e[2]&&oa(e),o=function(e){let t,n,s=[],r=new Map,a=e[11];const o=e=>e[26][0];for(let t=0;t<a.length;t+=1){let n=aa(e,a,t),i=o(n);r.set(i,s[t]=ia(i,n))}return{c(){t=ns("div");for(let e=0;e<s.length;e+=1)s[e].c();ls(t,"class","chans svelte-oq6z61")},m(e,r){es(e,t,r);for(let e=0;e<s.length;e+=1)s[e].m(t,null);n=!0},p(e,n){const a=e[11];Os(),s=Cs(s,n,o,1,e,a,r,t,Ns,ia,null,aa),Ss()},i(e){if(!n){for(let e=0;e<a.length;e+=1)js(s[e]);n=!0}},o(e){for(let e=0;e<s.length;e+=1)As(s[e]);n=!1},d(e){e&&ts(t);for(let e=0;e<s.length;e+=1)s[e].d()}}}(e),i=e[10]&&e[12]&&la(e);return{c(){a&&a.c(),t=as(),o&&o.c(),n=as(),i&&i.c(),s=os()},m(e,l){a&&a.m(e,l),es(e,t,l),o&&o.m(e,l),es(e,n,l),i&&i.m(e,l),es(e,s,l),r=!0},p(e,[n]){e[2]?a&&(Os(),As(a,1,1,()=>{a=null}),Ss()):a?(a.p(e,n),js(a,1)):(a=oa(e),a.c(),js(a,1),a.m(t.parentNode,t)),o.p(e,n),e[10]&&e[12]?i?(i.p(e,n),js(i,1)):(i=la(e),i.c(),js(i,1),i.m(s.parentNode,s)):i&&(Os(),As(i,1,1,()=>{i=null}),Ss())},i(e){r||(js(a),js(o),js(i),r=!0)},o(e){As(a),As(o),As(i),r=!1},d(e){a&&a.d(e),e&&ts(t),o&&o.d(e),e&&ts(n),i&&i.d(e),e&&ts(s)}}}const ha=!0;function pa(e,t,n){let s,r,a,o,i,l,c=Pn,u=Pn,d=Pn,h=Pn,p=Pn;e.$$.on_destroy.push(()=>c()),e.$$.on_destroy.push(()=>u()),e.$$.on_destroy.push(()=>d()),e.$$.on_destroy.push(()=>h()),e.$$.on_destroy.push(()=>p());let{space:f}=t,{weave:g}=t,{is_bird:m=!1}=t,{navi:v={}}=t,{i:w}=t;const _=y(!1);Yn(e,_,e=>n(16,l=e));let b,x,k,E,z,O,S,j,A;return e.$set=e=>{"space"in e&&n(0,f=e.space),"weave"in e&&n(1,g=e.weave),"is_bird"in e&&n(2,m=e.is_bird),"navi"in e&&n(3,v=e.navi),"i"in e&&n(4,w=e.i)},e.$$.update=()=>{2&e.$$.dirty&&(n(5,b=g.name),p(),p=Gn(b,e=>n(15,i=e))),2&e.$$.dirty&&(n(6,x=g.rezed),u(),u=Gn(x,e=>n(22,r=e))),1&e.$$.dirty&&(n(7,k=f?f.value:$({"!name":$(""),"!birds":$([])})),c(),c=Gn(k,e=>n(20,s=e))),1048576&e.$$.dirty&&(n(8,E=s["!name"]||$("")),h(),h=Gn(E,e=>n(14,o=e))),1&e.$$.dirty&&(n(9,z=f.id),d(),d=Gn(z,e=>n(13,a=e))),1048576&e.$$.dirty&&n(10,O=s["!birds"]),1048576&e.$$.dirty&&(S=s["!bird"]),1048576&e.$$.dirty&&n(11,j=Object.entries(s).sort(([e],[t])=>e>t?1:t>e?-1:0)),4202496&e.$$.dirty&&n(12,A=r[a])},[f,g,m,v,w,b,x,k,E,z,O,j,A,a,o,i,l,e=>{const t=j[e][0],n=j[e+1]?`${f.address()}/${j[e+1][0]}`:v.down,s=j[e-1]?`${f.address()}/${j[e-1][0]}`:f.address();return{id:`${f.address()}/${t}`,down:n,up:s,page_up:f.address(),page_down:v.down,home:f.address()}},e=>{e&&(e.preventDefault(),e.stopPropagation());const t=f.id.get();A?g.derez(t):g.rez(t)},_,s,S,r,()=>(g.remove(a),"/"===v.down?v.up:v.down),()=>{f.write({"":""}),requestAnimationFrame(()=>{Ps(`${f.address()}/`),qs.get().insert()})},e=>{_.set(e)}]}class fa extends Ws{constructor(e){super(),Rs(this,e,pa,da,Hn,{space:0,weave:1,is_bird:2,navi:3,i:4})}}function ga(e,t,n){const s=e.slice();return s[19]=t[n][0],s[20]=t[n][1],s[22]=n,s}function ma(e){let t,n;return{c(){t=ns("div"),n=rs(e[6]),ls(t,"class","namezor svelte-967sk2")},m(e,s){es(e,t,s),Qn(t,n)},p(e,t){64&t&&cs(n,e[6])},d(e){e&&ts(t)}}}function va(e,t){let n,s;const r=new fa({props:{space:t[20],weave:t[0],i:t[22],navi:{up:0===t[22]?t[6]:t[7](t[22]),page_up:0===t[22]?t[6]:`${t[6]}/${t[5][t[22]-1][0]}`,down:t[22]===t[5].length-1?t[1].down:`${t[6]}/${t[5][t[22]+1][0]}`}}});return{key:e,first:null,c(){n=os(),Ls(r.$$.fragment),this.first=n},m(e,t){es(e,n,t),Ts(r,e,t),s=!0},p(e,t){const n={};32&t&&(n.space=e[20]),1&t&&(n.weave=e[0]),32&t&&(n.i=e[22]),98&t&&(n.navi={up:0===e[22]?e[6]:e[7](e[22]),page_up:0===e[22]?e[6]:`${e[6]}/${e[5][e[22]-1][0]}`,down:e[22]===e[5].length-1?e[1].down:`${e[6]}/${e[5][e[22]+1][0]}`}),r.$set(n)},i(e){s||(js(r.$$.fragment,e),s=!0)},o(e){As(r.$$.fragment,e),s=!1},d(e){e&&ts(n),Fs(r,e)}}}function $a(e){let t,n,s,r,a,o,i,l,c,u,d=[],h=new Map,p={weave:e[0],$$slots:{default:[ma]},$$scope:{ctx:e}};const f=new hr({props:p});e[10](f);let g=e[5];const m=e=>e[19];for(let t=0;t<g.length;t+=1){let n=ga(e,g,t),s=m(n);h.set(s,d[t]=va(s,n))}return{c(){t=ns("div"),Ls(f.$$.fragment),r=as(),a=ns("div");for(let e=0;e<d.length;e+=1)d[e].c();o=as(),i=ns("div"),ls(t,"class","weave svelte-967sk2"),ls(a,"class","spaces"),ls(i,"class","fakespace svelte-967sk2"),u=[Zn(n=fr.call(null,t,e[6])),Zn(s=Gs.call(null,t,{id:e[6],up:e[11],down:e[12],page_down:e[13],page_up:e[14],origin:"sys"===e[6],left:e[15],right:e[16],insert:e[17],del:e[18]})),Zn(l=fr.call(null,i,e[6]))]},m(e,n){es(e,t,n),Ts(f,t,null),es(e,r,n),es(e,a,n);for(let e=0;e<d.length;e+=1)d[e].m(a,null);es(e,o,n),es(e,i,n),c=!0},p(e,[t]){const r={};1&t&&(r.weave=e[0]),8388672&t&&(r.$$scope={dirty:t,ctx:e}),f.$set(r),n&&Un(n.update)&&64&t&&n.update.call(null,e[6]),s&&Un(s.update)&&103&t&&s.update.call(null,{id:e[6],up:e[11],down:e[12],page_down:e[13],page_up:e[14],origin:"sys"===e[6],left:e[15],right:e[16],insert:e[17],del:e[18]});const o=e[5];Os(),d=Cs(d,t,m,1,e,o,h,a,Ns,va,null,ga),Ss(),l&&Un(l.update)&&64&t&&l.update.call(null,e[6])},i(e){if(!c){js(f.$$.fragment,e);for(let e=0;e<g.length;e+=1)js(d[e]);c=!0}},o(e){As(f.$$.fragment,e);for(let e=0;e<d.length;e+=1)As(d[e]);c=!1},d(n){n&&ts(t),e[10](null),Fs(f),n&&ts(r),n&&ts(a);for(let e=0;e<d.length;e+=1)d[e].d();n&&ts(o),n&&ts(i),Bn(u)}}}function wa(e,n,s){let r,a,o=Pn,i=Pn;e.$$.on_destroy.push(()=>o()),e.$$.on_destroy.push(()=>i());let{weave:l}=n,{navi:c={}}=n;let u;let d,h,p,f;return e.$set=e=>{"weave"in e&&s(0,l=e.weave),"navi"in e&&s(1,c=e.navi)},e.$$.update=()=>{1&e.$$.dirty&&(s(3,d=l.name),i(),i=Gn(d,e=>s(6,a=e))),1&e.$$.dirty&&(s(4,h=l.names),o(),o=Gn(h,e=>s(8,r=e))),256&e.$$.dirty&&s(5,p=Object.entries(r).sort(([e],[t])=>e>t?1:t>e?-1:0)),1&e.$$.dirty&&(f=l.warps)},[l,c,u,d,h,p,a,e=>{const[t,n]=p[e-1],s=Object.keys(n.value.get()).sort();return s.length>0?`${a}/${t}/${s[s.length-1]}`:`${a}/${t}`},r,f,function(e){vs[e?"unshift":"push"](()=>{s(2,u=e)})},()=>c.up,()=>p.length>0?`${a}/${p[0][0]}`:c.down,()=>p.length>0?`${a}/${p[0][0]}`:c.down,()=>c.up,()=>{u.toggle()},()=>{u.save_it()},()=>{const e=X(2);l.write({[t()]:{type:"space",value:{"!name":e}}}),requestAnimationFrame(()=>{Ps(`${a}/${e}/!name`),qs.get().click()})},()=>(Wheel.del([a]),c.down)]}class ya extends Ws{constructor(e){super(),Rs(this,e,wa,$a,Hn,{weave:0,navi:1})}}function _a(e){let t,n,s,r;return{c(){t=ss("svg"),n=ss("path"),s=ss("path"),r=ss("path"),ls(n,"class","bg svelte-op8pzp"),ls(n,"d","M0 0l115 115h15l12 27 108 108V0z"),ls(n,"fill","#fff"),ls(s,"class","octo-arm svelte-op8pzp"),ls(s,"d","M128 109c-15-9-9-19-9-19 3-7 2-11 2-11-1-7 3-2 3-2 4 5 2 11 2 11-3 10 5 15 9 16"),ds(s,"-webkit-transform-origin","130px 106px"),ds(s,"transform-origin","130px 106px"),ls(r,"class","octo-body svelte-op8pzp"),ls(r,"d","M115 115s4 2 5 0l14-14c3-2 6-3 8-3-8-11-15-24 2-41 5-5 10-7 16-7 1-2 3-7 12-11 0 0 5 3 7 16 4 2 8 5 12 9s7 8 9 12c14 3 17 7 17 7-4 8-9 11-11 11 0 6-2 11-7 16-16 16-30 10-41 2 0 3-1 7-5 11l-12 11c-1 1 1 5 1 5z"),ls(t,"id","github"),ls(t,"xmlns","http://www.w3.org/2000/svg"),ls(t,"width","80"),ls(t,"height","80"),ls(t,"viewBox","0 0 250 250"),ls(t,"fill","#151513"),ds(t,"position","absolute"),ds(t,"top","0"),ds(t,"right","0"),ls(t,"class","svelte-op8pzp")},m(e,a){es(e,t,a),Qn(t,n),Qn(t,s),Qn(t,r)},p:Pn,i:Pn,o:Pn,d(e){e&&ts(t)}}}class ba extends Ws{constructor(e){super(),Rs(this,e,null,_a,Hn,{})}}function xa(e){let t,n,s,r,a,o,i,l,c,u,d,h,p,f,g={ctx:e,current:null,token:null,pending:za,then:Ea,catch:ka,value:19};return Ms(a=Pe(e[2]),g),{c(){t=ns("div"),n=ns("h2"),n.textContent="Name It!",s=as(),r=ns("div"),g.block.c(),o=as(),i=ns("input"),l=as(),c=ns("div"),u=ns("div"),u.textContent="Cancel",d=as(),h=ns("div"),h.textContent="Plant",ls(r,"class","spirit svelte-vktjrt"),ls(i,"class","nameit svelte-vktjrt"),i.autofocus=!0,ls(i,"type","text"),ls(i,"placeholder","Name it"),ls(u,"class","false svelte-vktjrt"),ls(h,"class","true svelte-vktjrt"),ls(c,"class","controls svelte-vktjrt"),ls(t,"class","nameprompt svelte-vktjrt"),f=[is(i,"keydown",e[14]),is(i,"input",e[15]),is(u,"click",e[16]),is(h,"click",e[5]),Zn(p=pr.call(null,t,`/${e[2]}`))]},m(a,p){es(a,t,p),Qn(t,n),Qn(t,s),Qn(t,r),g.block.m(r,g.anchor=null),g.mount=()=>r,g.anchor=null,Qn(t,o),Qn(t,i),us(i,e[2]),Qn(t,l),Qn(t,c),Qn(c,u),Qn(c,d),Qn(c,h),i.focus()},p(t,n){if(e=t,g.ctx=e,4&n&&a!==(a=Pe(e[2]))&&Ms(a,g));else{const t=e.slice();t[19]=g.resolved,g.block.p(t,n)}4&n&&i.value!==e[2]&&us(i,e[2]),p&&Un(p.update)&&4&n&&p.update.call(null,`/${e[2]}`)},d(e){e&&ts(t),g.block.d(),g.token=null,g=null,Bn(f)}}}function ka(e){return{c:Pn,m:Pn,p:Pn,d:Pn}}function Ea(e){let t,n;return{c(){t=ns("img"),ls(t,"class","flex svelte-vktjrt"),t.src!==(n=e[19])&&ls(t,"src",n),ls(t,"alt","fileicon")},m(e,n){es(e,t,n)},p(e,s){4&s&&t.src!==(n=e[19])&&ls(t,"src",n)},d(e){e&&ts(t)}}}function za(e){return{c:Pn,m:Pn,p:Pn,d:Pn}}function Oa(e){let t,n,s,r,a,o,i=e[0]&&xa(e);const l=e[13].default,c=Vn(l,e,e[12],null);return{c(){i&&i.c(),t=as(),n=ns("div"),c&&c.c(),s=as(),r=ns("input"),ls(n,"class","picker svelte-vktjrt"),ls(r,"type","file"),ls(r,"class","file svelte-vktjrt"),r.multiple="multiple",o=[is(n,"drop",e[3]),is(n,"dragover",e[4](!0)),is(n,"dragleave",e[4](!1)),is(r,"change",e[18])]},m(o,l){i&&i.m(o,l),es(o,t,l),es(o,n,l),c&&c.m(n,null),es(o,s,l),es(o,r,l),e[17](r),a=!0},p(e,[n]){e[0]?i?i.p(e,n):(i=xa(e),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null),c&&c.p&&4096&n&&c.p(Xn(l,e,e[12],null),Kn(l,e[12],n,null))},i(e){a||(js(c,e),a=!0)},o(e){As(c,e),a=!1},d(a){i&&i.d(a),a&&ts(t),a&&ts(n),c&&c.d(a),a&&ts(s),a&&ts(r),e[17](null),Bn(o)}}}function Sa(e,t,n){let s;Yn(e,qs,e=>n(11,s=e));let r,a={},{nameit:o=!1}=t;const i=()=>{delete o.id,Wheel.spawn({[l]:o}),Wheel.get(l).write({"!info":{type:"space",value:{from:a.name,"save last":a.lastModified,size:a.size}}}),n(0,o=!1)};let l,{$$slots:c={},$$scope:u}=t;let d;return e.$set=e=>{"nameit"in e&&n(0,o=e.nameit),"$$scope"in e&&n(12,u=e.$$scope)},e.$$.update=()=>{2049&e.$$.dirty&&!1===o&&s&&"/picker"===s.id&&Ps("/")},d=Object.entries(gt),[o,r,l,e=>{e.preventDefault(),e.stopPropagation();const t=e.dataTransfer.files;for(let e=0;e<t.length;e++){const s=new FileReader;s.onloadend=s=>{a=t[e],n(0,o=Fe(s.target.result)),o&&n(2,l=`${o.name}`)},s.readAsDataURL(t[e])}},e=>e=>{e.dataTransfer.dropEffect="copy",e.preventDefault(),e.stopPropagation()},i,"/picker",()=>{n(0,o=!1)},()=>{i()},a,d,s,u,c,e=>{"end"!==e.key.toLowerCase()?13===e.which&&i():n(0,o=!1)},function(){l=this.value,n(2,l)},()=>{n(0,o=!1)},function(e){vs[e?"unshift":"push"](()=>{n(1,r=e)})},e=>{console.log(e.dataTransfer,e.target)}]}class ja extends Ws{constructor(e){super(),Rs(this,e,Sa,Oa,Hn,{nameit:0,id:6,cancel:7,click:8})}get id(){return this.$$.ctx[6]}get cancel(){return this.$$.ctx[7]}get click(){return this.$$.ctx[8]}}function Aa(e){let t,n,s,r;return{c(){t=ns("div"),ls(t,"class","main svelte-jdwyal"),hs(t,"full",e[0]),hs(t,"hidden",!e[1]),r=[Zn(n=e[3].call(null,t)),Zn(s=e[4].call(null,t)),is(t,"click",e[2])]},m(e,n){es(e,t,n)},p(e,[n]){1&n&&hs(t,"full",e[0]),2&n&&hs(t,"hidden",!e[1])},i:Pn,o:Pn,d(e){e&&ts(t),Bn(r)}}}function Ma(e,t,n){let{full:s=!1}=t,{hidden:r}=t;let a;return e.$set=e=>{"full"in e&&n(0,s=e.full),"hidden"in e&&n(1,r=e.hidden)},[s,r,()=>{n(0,s=!s)},e=>({destroy:sn.subscribe(t=>{if(t&&t.style){for(a=t;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(t)}})}),e=>({destroy:tn.listen(([e,t])=>{a&&(a.width=e,a.height=t)})})]}class Na extends Ws{constructor(e){super(),Rs(this,e,Ma,Aa,Hn,{full:0,hidden:1})}}function Ca(e,t,n){const s=e.slice();return s[12]=t[n],s[14]=n,s}function La(e){let t,n,s,r,a,o,i,l,c,u,d,h,p,f,g=[],m=new Map;const v=new ba({}),$=new Xs({props:{command:e[7]}});let w=e[4];const y=e=>e[12].id.get();for(let t=0;t<w.length;t+=1){let n=Ca(e,w,t),s=y(n);m.set(s,g[t]=Ta(s,n))}return{c(){t=ns("div"),n=ns("a"),Ls(v.$$.fragment),s=as(),r=ns("div"),a=ns("div"),o=ns("a"),i=rs("[ I S E K A I ]"),c=as(),u=ns("div"),Ls($.$$.fragment),d=as(),h=ns("div");for(let e=0;e<g.length;e+=1)g[e].c();ls(n,"href","https://github.com/agoblinking/earthrock"),ls(n,"target","_new"),ls(t,"class","github svelte-14p6qu8"),ls(o,"class","logo svelte-14p6qu8"),ls(o,"style",e[6]),ls(o,"href","https://www.patreon.com/earthrock"),ls(o,"target","_new"),ls(u,"class","events svelte-14p6qu8"),ls(h,"class","weaves svelte-14p6qu8"),ls(a,"class","partial svelte-14p6qu8"),ls(r,"class","explore svelte-14p6qu8"),ds(r,"color",e[5]),f=Zn(l=Gs.call(null,o,{id:"/",up:e[8],down:"sys",page_up:e[4][e[4].length-1].name.get(),page_down:"sys",insert:e[10]}))},m(e,l){es(e,t,l),Qn(t,n),Ts(v,n,null),es(e,s,l),es(e,r,l),Qn(r,a),Qn(a,o),Qn(o,i),Qn(a,c),Qn(a,u),Ts($,u,null),Qn(a,d),Qn(a,h);for(let e=0;e<g.length;e+=1)g[e].m(h,null);p=!0},p(e,t){(!p||64&t)&&ls(o,"style",e[6]),l&&Un(l.update)&&22&t&&l.update.call(null,{id:"/",up:e[8],down:"sys",page_up:e[4][e[4].length-1].name.get(),page_down:"sys",insert:e[10]});const n=e[4];Os(),g=Cs(g,t,y,1,e,n,m,h,Ns,Ta,null,Ca),Ss(),(!p||32&t)&&ds(r,"color",e[5])},i(e){if(!p){js(v.$$.fragment,e),js($.$$.fragment,e);for(let e=0;e<w.length;e+=1)js(g[e]);p=!0}},o(e){As(v.$$.fragment,e),As($.$$.fragment,e);for(let e=0;e<g.length;e+=1)As(g[e]);p=!1},d(e){e&&ts(t),Fs(v),e&&ts(s),e&&ts(r),Fs($);for(let e=0;e<g.length;e+=1)g[e].d();f()}}}function Ta(e,t){let n,s;const r=new ya({props:{weave:t[12],navi:{up:t[4][t[14]-1]?t[4][t[14]-1].name.get():"/",down:t[4][t[14]+1]?t[4][t[14]+1].name.get():"/"}}});return{key:e,first:null,c(){n=os(),Ls(r.$$.fragment),this.first=n},m(e,t){es(e,n,t),Ts(r,e,t),s=!0},p(e,t){const n={};16&t&&(n.weave=e[12]),16&t&&(n.navi={up:e[4][e[14]-1]?e[4][e[14]-1].name.get():"/",down:e[4][e[14]+1]?e[4][e[14]+1].name.get():"/"}),r.$set(n)},i(e){s||(js(r.$$.fragment,e),s=!0)},o(e){As(r.$$.fragment,e),s=!1},d(e){e&&ts(n),Fs(r,e)}}}function Fa(e){let t,n,s=!e[0]&&La(e);return{c(){s&&s.c(),t=os()},m(e,r){s&&s.m(e,r),es(e,t,r),n=!0},p(e,n){e[0]?s&&(Os(),As(s,1,1,()=>{s=null}),Ss()):s?(s.p(e,n),js(s,1)):(s=La(e),s.c(),js(s,1),s.m(t.parentNode,t))},i(e){n||(js(s),n=!0)},o(e){As(s),n=!1},d(e){s&&s.d(e),e&&ts(t)}}}function Ia(e){let t,n;const s=new Na({props:{hidden:e[0]}});let r={nameit:e[1],$$slots:{default:[Fa]},$$scope:{ctx:e}};const a=new ja({props:r});return e[11](a),{c(){Ls(s.$$.fragment),t=as(),Ls(a.$$.fragment)},m(e,r){Ts(s,e,r),es(e,t,r),Ts(a,e,r),n=!0},p(e,[t]){const n={};1&t&&(n.hidden=e[0]),s.$set(n);const r={};2&t&&(r.nameit=e[1]),32887&t&&(r.$$scope={dirty:t,ctx:e}),a.$set(r)},i(e){n||(js(s.$$.fragment,e),js(a.$$.fragment,e),n=!0)},o(e){As(s.$$.fragment,e),As(a.$$.fragment,e),n=!1},d(n){Fs(s,n),n&&ts(t),e[11](null),Fs(a,n)}}}function Ra(e,t,n){let s,r,a,o=Pn;Yn(e,W,e=>n(5,r=e)),Yn(e,U,e=>n(6,a=e)),e.$$.on_destroy.push(()=>o()),an.listen(e=>{"`"===e&&n(0,i=!i)}),fn.listen(e=>{"select"===e&&n(0,i=!i)});let{hidden:i=-1===window.location.hash.indexOf("dev")}=t,l=!1;let c;let u,d;return e.$set=e=>{"hidden"in e&&n(0,i=e.hidden)},e.$$.update=()=>{512&e.$$.dirty&&n(4,d=Object.values(s).sort(({name:e},{name:t})=>{const n=e.get(),s=t.get();return n>s?1:s>n?-1:0}))},n(3,u=Wheel.weaves),o(),o=Gn(u,e=>n(9,s=e)),[i,l,c,u,d,r,a,([e,...t],n)=>{switch(e){case"-":return void Wheel.del({[t[0]]:!0});case"+":1===t.length&&Wheel.spawn({[t[0]]:{}}),3===t.length&&qe(t).then(e=>{n(`Added ${e} from Github. `)}).catch(e=>{n(`Couldn't add ${t.join("/")}. `)})}},()=>{const e=d[d.length-1];if(!e)return;const t=e.names.get(),n=Object.keys(t);if(n.length<1)return e.name.get();const s=n[n.length-1],r=Object.keys(t[s].value.get()).sort();return r.length<1?`${e.name.get()}/${s}`:`${e.name.get()}/${s}/${r[r.length-1]}`},s,()=>{n(1,l={}),qs.set(c)},function(e){vs[e?"unshift":"push"](()=>{n(2,c=e)})}]}class Wa extends Ws{constructor(e){super(),Rs(this,e,Ra,Ia,Hn,{hidden:0})}}function Da(e){let t;const n=new Wa({});return{c(){Ls(n.$$.fragment)},m(e,s){Ts(n,e,s),t=!0},p:Pn,i(e){t||(js(n.$$.fragment,e),t=!0)},o(e){As(n.$$.fragment,e),t=!1},d(e){Fs(n,e)}}}return Wheel.weaves.get()[Wheel.SYSTEM]=Dn,new class extends Ws{constructor(e){super(),Rs(this,e,null,Da,Hn,{})}}({target:document.body})}(Color,cuid,scribble,Tone,EXT.piexifjs,exprEval,twgl);
